# מדריך הסבת נתונים (Data Seeding)

## קבצי Seed זמינים

### 1. `seed-infrastructure.ts` - נתוני תשתית
יוצר את כל הנתונים הבסיסיים הדרושים למערכת:

- ✅ 6 אמצעי תשלום (מזומן, צ'ק, כרטיס אשראי וכו')
- ✅ 4 סוגי כתובות (בית, שטיבלך, עבודה, נופש)
- ✅ 10 אירועים (יום הולדת, יארצייטים וכו')
- ✅ 10 סוגי הערות
- ✅ 9 ארגונים
- ✅ 6 משתמשים (כולל אדמין)
- ✅ 81 בנקים
- ✅ 20 כותרות מכתבים (6 פתיחה + 14 סיום)
- ✅ 31 מדינות עם מטבעות

**הרצה:**
```bash
npm run seed-infrastructure
```

**הערה חשובה:** הרץ את זה **קודם** לפני seed-data!

---

### 2. `seed-data.ts` - נתונים מהמערכת הישנה
יבוא מלא של כל הנתונים מקבצי Excel:

**📊 סטטיסטיקה:**
- 754 תורמים
- 241 אנשי קשר (טלפונים ואימיילים)
- 748 כתובות/מיקומים
- 748 קישורי תורם-מיקום
- 10 קמפיינים
- 685 תרומות

**מקור הנתונים:**
- `src/assets/excels/טבלת שמות ופרטים.xlsx`
- `src/assets/excels/טבלת תרומות.xlsx`

**הרצה:**
```bash
npm run seed-data
```

**💡 יתרונות:**
- כל הנתונים מעובדים מראש - **אין קריאת Excel בזמן ריצה**
- קובץ בן **~28,000 שורות** עם כל הרשומות hard-coded
- ריצה מהירה וללא תלות בקבצים חיצוניים

---

## סדר ההרצה המומלץ

```bash
# 1. הסבת תשתית (חובה - פעם ראשונה)
npm run seed-infrastructure

# 2. הסבת נתונים ישנים (אופציונלי)
npm run seed-data
```

---

## מבנה הנתונים שנקלטים

### תורמים (Donors)
- שמות עברית + אנגלית
- תארים וסיומות
- דגל "אנ"ש"
- תאריכי רישום מקוריים
- העדפות (רוצה עדכונים, קבלות מס)

### אנשי קשר (DonorContacts)
- טלפונים (ראשי + נוסף)
- אימיילים
- קידומות מדינה

### מיקומים (Places + DonorPlaces)
- כתובת מלאה
- עיר ושכונה
- מיקוד
- קישור למדינה (רובם USA)

### קמפיינים (Campaigns)
- שמות (תשעו, תשעז, תשעח וכו')
- סוג: דינר
- סכומים שנאספו

### תרומות (Donations)
- סכומים במטבעות שונים (דולר, ליש"ט)
- תאריכים מדויקים מהמערכת הישנה
- קישור לתורם וקמפיין
- דגלונים (תרומה חריגה, חדר תה, קבלה הוצאה)

---

## פתרון בעיות

### שגיאת חיבור ל-DB
ודא ש-`.env` מכיל:
```
DATABASE_URL='postgres://postgres:password@localhost/donation'
DEV_MODE='DEV'
```

### שגיאת "Admin user not found"
הרץ קודם:
```bash
npm run seed-infrastructure
```

### התקלה "Cannot find module"
הרץ:
```bash
npm install
npm run build
```

---

## הערות טכניות

- כל הסקריפטים משתמשים ב-`withRemult` לחיבור ישיר ל-DB
- התאמה ל-Remult עם PostgreSQL
- תמיכה בסביבות DEV ו-PROD
- המרות אוטומטיות:
  - תאריכים מ-Excel serial dates
  - מטבעות (דולר, ליש"ט, שקל וכו')
  - מספרי טלפון (ניקוי)
  - אימיילים (הסרת mailto: ו-#)

---

## תחזוקה

### עדכון נתוני תשתית
ערוך את `src/server/seed-infrastructure.ts`

### עדכון נתונים מהאקסל
1. עדכן את הקבצים ב-`src/assets/excels/`
2. הרץ: `node src/server/generate-seed-data.js`
3. זה ייצור `seed-data.ts` חדש

---

**תאריך יצירה:** 2025-11-02
**גרסה:** 1.0

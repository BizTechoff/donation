<div style="height: 100%; display: flex; flex-direction: column">
  <mat-toolbar color="primary" style="flex-shrink: 0">
    <button mat-button class="sidenav-toggle" (click)="sidenav.toggle()">
      <mat-icon>menu</mat-icon>
    </button>
    <span class="toolbar-title">{{ getCurrentTitleObservable() | async }}</span>

    <div class="toolbar-actions">
      <!-- Quick Actions -->
      <app-quick-actions *ngIf="remult.authenticated()"></app-quick-actions>

      <!-- Global Filters -->
      <app-global-filters *ngIf="remult.authenticated()"></app-global-filters>

      <!-- Reminder Bell Notification -->
      <button mat-icon-button class="reminder-bell" [class.reminders-active]="(activeRemindersCount$ | async) || 0 > 0"
        *ngIf="remult.authenticated()" (click)="navigateToReminders()">
        <mat-icon>notifications</mat-icon>
        <span *ngIf="(activeRemindersCount$ | async) as count" [class.reminder-count]="count > 0">{{ count }}</span>
      </button>

      <!-- Language Switcher -->
      <app-language-switcher></app-language-switcher>

      <ng-container *ngIf="!remult.authenticated()">
        <button mat-stroked-button class="toolbar-button" (click)="signIn()">
          {{ (i18n.terms$ | async)?.signIn }}
        </button>
      </ng-container>
      <ng-container *ngIf="remult.authenticated()">
        <button mat-stroked-button class="toolbar-button" [matMenuTriggerFor]="menu">
          <div style="display: flex; flex-direction: column;">
            <span>{{ remult.user!.name }}</span>
          </div>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="updateInfo()">
            {{ (i18n.terms$ | async)?.updateInfo }}
          </button>
          <button mat-menu-item (click)="changePassword()">
            {{ (i18n.terms$ | async)?.changePassword }}
          </button>
          <button mat-menu-item (click)="signOut()">{{ (i18n.terms$ | async)?.signOut }}</button>
        </mat-menu>
      </ng-container>
      <span style="display: flex; position: absolute; bottom: 0; right: 0; font-size: x-small;">{{ 'כ"ג חשון התשפ"ו'
        }}</span>
    </div>
  </mat-toolbar>
  <mat-sidenav-container class="app-sidenav-container" [dir]="i18n.lang.RTL ? 'rtl' : 'ltr'">
    <mat-sidenav #sidenav class="app-sidenav mat-elevation-z10 no-print"
      [opened]="!uiService.isScreenSmall() && remult.authenticated()"
      [mode]="uiService.isScreenSmall() ? 'over' : 'side'">

      <!-- Sidenav Header with Logo and User -->
      <div class="sidenav-header" *ngIf="remult.authenticated()">
        <div class="user-profile">
          <div class="user-avatar" (click)="sidenav.toggle()" style="cursor: pointer;">
            <img src="./assets/yyg.logo.png" alt="Logo" class="avatar-logo">
          </div>
          <!-- <div class="user-info">
            <div class="user-name">{{ (i18n.terms$ | async)?.hello }} {{ remult.user!.name }}</div>
            <div class="user-greeting">{{ (i18n.terms$ | async)?.hello }}</div>
          </div> -->
        </div>
      </div>

      <mat-nav-list role="list">
        <ng-container *ngFor="let m of router.config; let i = index">
          <mat-divider style="opacity: .2; color: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"
            *ngIf="shouldDisplayRoute(m) && [terms.userAccounts, terms.reminders, terms.certificates].includes(m.path)"></mat-divider>
          <a mat-list-item *ngIf="shouldDisplayRoute(m)" routerLinkActive="active-route" [routerLink]="m.path"
            (click)="routeClicked()">
            {{ getRouteNameObservable(m) | async }}
          </a>
        </ng-container>
      </mat-nav-list>
    </mat-sidenav>
    <div class="app-sidenav-content">
      <div class="wrapper" style="height: 100%">
        <router-outlet></router-outlet>
      </div>
    </div>
  </mat-sidenav-container>

  <div class="biztechoff">
    <!-- <ngx-marquee> -->
    <span (click)="this.openBizTechoff()"><i>Biz</i>Techoff™v{{ this.version }}</span>
    <!-- </ngx-marquee> -->
  </div>

  <!-- Global Search Component - Always available -->
  <app-global-search *ngIf="remult.authenticated()"></app-global-search>
</div>
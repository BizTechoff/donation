<div class="photo-capture-step">
  @if (!previewUrl) {
    <!-- Camera Button -->
    <label class="capture-btn" for="cameraInput">
      <mat-icon class="camera-icon">photo_camera</mat-icon>
      <span class="capture-label">צלם צ'ק / קבלה</span>
      <span class="capture-hint">לחץ לפתיחת המצלמה</span>
    </label>
    <input
      type="file"
      id="cameraInput"
      accept="image/*"
      capture="environment"
      (change)="onFileSelected($event)"
      hidden>
  } @else {
    <!-- Preview -->
    <div class="preview-container">
      <img [src]="previewUrl" alt="תמונת צ'ק" class="preview-image">

      @if (uploading) {
        <div class="upload-overlay">
          <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
          <span class="progress-text">{{ uploadProgress }}%</span>
        </div>
      }

      @if (uploaded) {
        <div class="upload-success">
          <mat-icon>check_circle</mat-icon>
          <span>הועלה בהצלחה</span>
        </div>
      }
    </div>

    @if (!uploading) {
      <button class="retake-btn" (click)="retake()">
        <mat-icon>refresh</mat-icon>
        צלם שוב
      </button>
    }
  }

  @if (errorMessage) {
    <div class="error-message">{{ errorMessage }}</div>
  }

  <!-- Bottom Bar -->
  <div class="bottom-bar">
    <button class="btn-secondary" (click)="back.emit()">
      <mat-icon>arrow_forward</mat-icon>
      חזור
    </button>
    <button class="btn-outline" (click)="photoSkipped.emit()">
      דלג
    </button>
    @if (uploaded) {
      <button class="btn-primary" (click)="photoComplete.emit()">
        המשך
      </button>
    }
  </div>
</div>

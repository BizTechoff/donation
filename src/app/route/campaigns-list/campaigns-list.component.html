<div class="module-container">

  <!-- HEADER: Sticky top - ×›×•×ª×¨×ª + ×›×¤×ª×•×¨ ×”×•×¡×¤×” + ×¤×™×œ×˜×¨×™× -->
  <div class="module-header">
    <div class="header-top">
      <h1>{{ (i18n.terms$ | async)?.campaignsManagement }}</h1>
      <button class="btn btn-primary add-campaign-btn" (click)="createCampaign()">
        {{ (i18n.terms$ | async)?.newCampaign }}
      </button>
    </div>

    <!-- ×›×¨×˜×™×¡×™ ×¡×™×›×•× -->
    <div class="summary-cards">
      <div class="summary-card active-campaigns">
        <div class="card-icon">ğŸ¯</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.activeCampaignsCard }}</h3>
          <span class="count">{{activeCampaigns}}</span>
        </div>
      </div>
      <div class="summary-card target-amount">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.totalTargetAmountCard }}</h3>
          <span class="amount">{{formatCurrency(totalTargetAmount)}}</span>
        </div>
      </div>
      <div class="summary-card raised-amount">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.collectedSoFar }}</h3>
          <span class="amount">{{formatCurrency(totalRaisedAmount)}}</span>
        </div>
      </div>
      <div class="summary-card success-rate">
        <div class="card-icon">ğŸ“ˆ</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.successRate }}</h3>
          <span class="percentage">{{totalTargetAmount > 0 ? ((totalRaisedAmount / totalTargetAmount) * 100).toFixed(1) : 0}}%</span>
        </div>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-row">
        <div class="filter-group">
          <label>{{ (i18n.terms$ | async)?.campaignName }}</label>
          <input type="text" class="form-control"
                 [(ngModel)]="filterName"
                 (ngModelChange)="applyFilters()"
                 [placeholder]="(i18n.terms$ | async)?.searchByName">
        </div>

        <div class="filter-group">
          <label>{{ (i18n.terms$ | async)?.activeInactive }}</label>
          <select class="form-control"
                  [(ngModel)]="filterActive"
                  (ngModelChange)="applyFilters()">
            <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
            <option value="true">{{ (i18n.terms$ | async)?.activeStatus }}</option>
            <option value="false">{{ (i18n.terms$ | async)?.inactiveStatus }}</option>
          </select>
        </div>

        <div class="filter-actions">
          <button class="btn btn-secondary" (click)="clearFilters()">{{ (i18n.terms$ | async)?.clearFilters }}</button>
          <button class="btn btn-info" (click)="loadData()" [disabled]="loading">{{ (i18n.terms$ | async)?.refresh }}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CONTENT: ××–×•×¨ ×”×ª×•×›×Ÿ ×”××¨×›×–×™ -->
  <div class="module-content">

    <!-- Table Header: Sticky top ×©×œ ×”×˜×‘×œ×” -->
    <div class="table-header">
      <div class="grid-col">{{ (i18n.terms$ | async)?.campaignName }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.financialTarget }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.collected }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.progressPercentage }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.startDate }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.endDate }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.actions }}</div>
    </div>

    <!-- Table Body: ×”×—×œ×§ ×”×™×—×™×“ ×©× ×’×œ×œ -->
    <div class="table-body">
      <div class="loading-overlay" *ngIf="loading">
        <div class="spinner">{{ (i18n.terms$ | async)?.loadingCampaigns }}</div>
      </div>

      <div class="grid-row" *ngFor="let campaign of campaigns" [class.inactive]="!campaign.isActive">
        <div class="grid-col campaign-name-col">
          <div class="campaign-info">
            <strong>{{campaign.name}}</strong>
            <small *ngIf="campaign.description">{{campaign.description}}</small>
          </div>
        </div>
        <div class="grid-col amount-col">
          <span class="amount">{{formatCurrency(campaign.targetAmount)}}</span>
        </div>
        <div class="grid-col amount-col">
          <span class="amount raised">{{formatCurrency(campaign.raisedAmount)}}</span>
        </div>
        <div class="grid-col progress-col">
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="campaign.progressPercentage"></div>
            </div>
            <span class="progress-text">{{campaign.progressPercentage}}%</span>
          </div>
        </div>
        <div class="grid-col">{{formatDate(campaign.startDate)}}</div>
        <div class="grid-col">{{formatDate(campaign.endDate)}}</div>
        <div class="grid-col actions">
          <button class="btn-icon btn-edit" [title]="(i18n.terms$ | async)?.edit" (click)="editCampaign(campaign)">âœ</button>
          <button class="btn-icon btn-delete" [title]="(i18n.terms$ | async)?.delete" (click)="deleteCampaign(campaign)">ğŸ—‘</button>
        </div>
      </div>

      <div class="no-data" *ngIf="!loading && campaigns.length === 0">
        <div class="no-campaigns-icon">ğŸ¯</div>
        <h3>{{ (i18n.terms$ | async)?.noCampaigns }}</h3>
        <p>{{ (i18n.terms$ | async)?.noCampaignsMatchingCriteria }}</p>
        <button class="btn btn-primary" (click)="createCampaign()">{{ (i18n.terms$ | async)?.createFirstCampaign }}</button>
      </div>
    </div>

    <!-- Table Footer: Sticky bottom - Pagination -->
    <div class="table-footer">
      <div class="pagination-controls">
        <button
          class="btn-page"
          (click)="firstPage()"
          [disabled]="currentPage === 1 || loading">
          â® {{ (i18n.terms$ | async)?.first }}
        </button>

        <button
          class="btn-page"
          (click)="previousPage()"
          [disabled]="currentPage === 1 || loading">
          â† {{ (i18n.terms$ | async)?.previous }}
        </button>

        <div class="page-numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            class="btn-page-number"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
            [disabled]="loading">
            {{page}}
          </button>
        </div>

        <button
          class="btn-page"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages || loading">
          {{ (i18n.terms$ | async)?.next }} â†’
        </button>

        <button
          class="btn-page"
          (click)="lastPage()"
          [disabled]="currentPage === totalPages || loading">
          {{ (i18n.terms$ | async)?.last }} â­
        </button>
      </div>

      <div class="pagination-info">
        <span>{{ (i18n.terms$ | async)?.showing }} {{(currentPage - 1) * pageSize + 1}} - {{Math.min(currentPage * pageSize, totalCount)}} {{ (i18n.terms$ | async)?.of }} {{totalCount}}</span>
      </div>
    </div>

  </div>

  <!-- FOOTER: Sticky bottom - (×¨×™×§ ×›×¨×’×¢, ×œ×¢×ª×™×“) -->
  <div class="module-footer">
    <!-- ××§×•× ×œ×¡×™×›×•××™×, ×¡×˜×˜×™×¡×˜×™×§×•×ª, ×•×›×•' -->
  </div>

</div>

<div class="modal-overlay" *ngIf="showAddCampaignModal">
  <div class="modal-content campaign-modal">
    <div class="modal-header">
      <h2>{{editingCampaign?._?.isNew() ? ((i18n.terms$ | async)?.newCampaign) : ((i18n.terms$ | async)?.editCampaign)}}</h2>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.campaignName }} *</label>
          <input type="text" class="form-control"
                 [(ngModel)]="editingCampaign!.name"
                 [placeholder]="(i18n.terms$ | async)?.enterCampaignName">
        </div>

        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.financialTarget }} *</label>
          <input type="number" class="form-control"
                 [(ngModel)]="editingCampaign!.targetAmount"
                 placeholder="0">
        </div>

        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.currency }}</label>
          <select class="form-control" [(ngModel)]="editingCampaign!.currency" (change)="onLocationChange()">
            <option value="ILS">{{ (i18n.terms$ | async)?.shekelOption }}</option>
            <option value="USD">{{ (i18n.terms$ | async)?.dollarOption }}</option>
            <option value="EUR">{{ (i18n.terms$ | async)?.euroOption }}</option>
          </select>
        </div>

        <!-- New fields -->
        <div class="form-group">
          <label>××™×§×•× ×”××™×¨×•×¢</label>
          <input type="text" class="form-control"
                 [(ngModel)]="editingCampaign!.eventLocation"
                 (ngModelChange)="onLocationChange()"
                 placeholder="××™×§×•× ×”××™×¨×•×¢">
        </div>

        <div class="form-group">
          <label>×¡×•×’ ×§××¤×™×™×Ÿ</label>
          <select class="form-control" [(ngModel)]="editingCampaign!.campaignType" (change)="onCampaignTypeChange()">
            <option value="×¨×’×™×œ">×¨×’×™×œ</option>
            <option value="×“×™× ×¢×¨">×“×™× ×¢×¨</option>
          </select>
        </div>

        <!-- Start Date with Hebrew-Gregorian picker -->
        <div class="form-group full-width">
          <app-modern-dual-date-picker
            [(ngModel)]="editingCampaign!.startDate"
            [label]="'×ª××¨×™×š ×”×ª×—×œ×”'"
            (dateChange)="onStartDateChange($event)">
          </app-modern-dual-date-picker>
        </div>

        <!-- End Date with Hebrew-Gregorian picker -->
        <div class="form-group full-width">
          <app-modern-dual-date-picker
            [(ngModel)]="editingCampaign!.endDate"
            [label]="'×ª××¨×™×š ×¡×™×•×'"
            (dateChange)="onEndDateChange($event)">
          </app-modern-dual-date-picker>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="editingCampaign!.isActive"> {{ (i18n.terms$ | async)?.activeCampaign }}
          </label>
        </div>

        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.imageLink }}</label>
          <input type="url" class="form-control"
                 [(ngModel)]="editingCampaign!.imageUrl"
                 [placeholder]="(i18n.terms$ | async)?.imageLinkPlaceholder">
        </div>

        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.pageLink }}</label>
          <input type="url" class="form-control"
                 [(ngModel)]="editingCampaign!.websiteUrl"
                 [placeholder]="(i18n.terms$ | async)?.pageLinkPlaceholder">
        </div>

        <div class="form-group full-width">
          <label>{{ (i18n.terms$ | async)?.campaignDescription }}</label>
          <textarea class="form-control" rows="3"
                    [(ngModel)]="editingCampaign!.description"
                    [placeholder]="(i18n.terms$ | async)?.describeCampaignGoals"></textarea>
        </div>

        <div class="form-group full-width">
          <label>{{ (i18n.terms$ | async)?.internalNotes }}</label>
          <textarea class="form-control" rows="2"
                    [(ngModel)]="editingCampaign!.internalNotes"
                    [placeholder]="(i18n.terms$ | async)?.notesForTeam"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <!-- Action buttons for dinner campaigns -->
      <div class="action-buttons" *ngIf="editingCampaign?.campaignType === '×“×™× ×¢×¨' && editingCampaign && !editingCampaign._.isNew()">
        <button class="btn btn-info" (click)="openBlessingsBook()" title="×¡×¤×¨ ×‘×¨×›×•×ª">
          ğŸ“– ×¡×¤×¨ ×‘×¨×›×•×ª
        </button>
      </div>

      <!-- Regular action buttons -->
      <div class="action-buttons" *ngIf="editingCampaign && !editingCampaign._.isNew()">
        <button class="btn btn-outline-primary" (click)="openDonors()" title="×ª×•×¨××™×">
          ğŸ‘¥ ×ª×•×¨××™×
        </button>
        <button class="btn btn-outline-success" (click)="openContacts()" title="×× ×©×™ ×§×©×¨ ×•×¤×¢×™×œ×™×">
          ğŸ“ ×× ×©×™ ×§×©×¨ ×•×¤×¢×™×œ×™×
        </button>
      </div>

      <div class="main-buttons">
        <button class="btn btn-secondary" (click)="closeModal()">{{ (i18n.terms$ | async)?.cancel }}</button>
        <button class="btn btn-primary" (click)="saveCampaign()">{{ (i18n.terms$ | async)?.saveCampaign }}</button>
      </div>
    </div>
  </div>
</div>

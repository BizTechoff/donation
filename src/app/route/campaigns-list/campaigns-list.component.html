<div class="campaigns-container">
  <div class="page-header">
    <h1>{{ (i18n.terms$ | async)?.campaignsManagement }}</h1>
    <button class="btn btn-primary add-campaign-btn" (click)="createCampaign()">{{ (i18n.terms$ | async)?.newCampaign }}</button>
  </div>

  <!-- ×›×¨×˜×™×¡×™ ×¡×™×›×•× -->
  <div class="summary-cards">
    <div class="summary-card active-campaigns">
      <div class="card-icon">ğŸ¯</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.activeCampaignsCard }}</h3>
        <span class="count">{{activeCampaigns}}</span>
      </div>
    </div>
    <div class="summary-card target-amount">
      <div class="card-icon">ğŸ’°</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.totalTargetAmountCard }}</h3>
        <span class="amount">{{formatCurrency(totalTargetAmount)}}</span>
      </div>
    </div>
    <div class="summary-card raised-amount">
      <div class="card-icon">ğŸ“Š</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.collectedSoFar }}</h3>
        <span class="amount">{{formatCurrency(totalRaisedAmount)}}</span>
      </div>
    </div>
    <div class="summary-card success-rate">
      <div class="card-icon">ğŸ“ˆ</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.successRate }}</h3>
        <span class="percentage">{{totalTargetAmount > 0 ? ((totalRaisedAmount / totalTargetAmount) * 100).toFixed(1) : 0}}%</span>
      </div>
    </div>
  </div>

  <!-- ××¤×™×™× ×™× -->
  <div class="filters-section">
    <div class="filter-row">
      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.campaignName }}</label>
        <input type="text" class="form-control" 
               [(ngModel)]="filterName" 
               (ngModelChange)="applyFilters()"
               [placeholder]="(i18n.terms$ | async)?.searchByName">
      </div>
      
      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.statusFilter }}</label>
        <select class="form-control" 
                [(ngModel)]="filterStatus" 
                (ngModelChange)="applyFilters()">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option value="draft">{{ (i18n.terms$ | async)?.draft }}</option>
          <option value="active">{{ (i18n.terms$ | async)?.activeStatus }}</option>
          <option value="completed">{{ (i18n.terms$ | async)?.completedStatus }}</option>
          <option value="cancelled">{{ (i18n.terms$ | async)?.cancelledStatus }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label>×§×˜×’×•×¨×™×”</label>
        <input type="text" class="form-control" 
               [(ngModel)]="filterCategory" 
               (ngModelChange)="applyFilters()"
               placeholder="×§×˜×’×•×¨×™×”...">
      </div>

      <div class="filter-group">
        <label>×¤×¢×™×œ/×œ× ×¤×¢×™×œ</label>
        <select class="form-control" 
                [(ngModel)]="filterActive" 
                (ngModelChange)="applyFilters()">
          <option value="">×”×›×œ</option>
          <option value="true">×¤×¢×™×œ</option>
          <option value="false">×œ× ×¤×¢×™×œ</option>
        </select>
      </div>

      <div class="filter-actions">
        <button class="btn btn-secondary" (click)="clearFilters()">× ×§×” ××¤×™×™× ×™×</button>
        <button class="btn btn-info" (click)="loadData()" [disabled]="loading">×¨×¢× ×Ÿ</button>
      </div>
    </div>
  </div>

  <!-- ×˜×‘×œ×ª ×§××¤×™×™× ×™× -->
  <div class="campaigns-table-container">
    <div *ngIf="loading" class="loading-overlay">
      <div class="loading-spinner">×˜×•×¢×Ÿ ×§××¤×™×™× ×™×...</div>
    </div>
    
    <table class="campaigns-table">
      <thead>
        <tr>
          <th>×©× ×”×§××¤×™×™×Ÿ</th>
          <th>×§×˜×’×•×¨×™×”</th>
          <th>×™×¢×“ ×›×¡×¤×™</th>
          <th>× ××¡×£</th>
          <th>××—×•×– ×”×ª×§×“××•×ª</th>
          <th>×ª××¨×™×š ×”×ª×—×œ×”</th>
          <th>×ª××¨×™×š ×¡×™×•×</th>
          <th>×¡×˜×˜×•×¡</th>
          <th>××—×¨××™</th>
          <th>×¤×¢×•×œ×•×ª</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let campaign of campaigns" [class.inactive]="!campaign.isActive">
          <td class="campaign-name-col">
            <div class="campaign-info">
              <strong>{{campaign.name}}</strong>
              <small *ngIf="campaign.description">{{campaign.description}}</small>
            </div>
          </td>
          <td>{{campaign.category || '×œ× ×¦×•×™×Ÿ'}}</td>
          <td class="amount-col">
            <span class="amount">{{formatCurrency(campaign.targetAmount)}}</span>
          </td>
          <td class="amount-col">
            <span class="amount raised">{{formatCurrency(campaign.raisedAmount)}}</span>
          </td>
          <td class="progress-col">
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="campaign.progressPercentage"></div>
              </div>
              <span class="progress-text">{{campaign.progressPercentage}}%</span>
            </div>
          </td>
          <td>{{formatDate(campaign.startDate)}}</td>
          <td>{{formatDate(campaign.endDate)}}</td>
          <td>
            <span class="status-badge" [class]="getStatusBadgeClass(campaign.status)">
              {{getStatusText(campaign.status)}}
            </span>
          </td>
          <td>{{campaign.manager?.name || '×œ× ×¦×•×™×Ÿ'}}</td>
          <td class="actions">
            <button class="btn-icon btn-view" title="×”×¦×’ ×¤×¨×˜×™×" (click)="editCampaign(campaign)">ğŸ‘</button>
            <button class="btn-icon btn-edit" title="×¢×¨×•×š" (click)="editCampaign(campaign)">âœ</button>
            <button class="btn-icon btn-activate" title="×”×¤×¢×œ" (click)="activateCampaign(campaign)" 
                    *ngIf="campaign.status === 'draft'">â–¶</button>
            <button class="btn-icon btn-complete" title="×¡××Ÿ ×›×”×•×©×œ×" (click)="completeCampaign(campaign)" 
                    *ngIf="campaign.status === 'active'">âœ…</button>
            <button class="btn-icon btn-cancel" title="×‘×˜×œ" (click)="cancelCampaign(campaign)" 
                    *ngIf="campaign.status === 'active' || campaign.status === 'draft'">âŒ</button>
            <button class="btn-icon btn-delete" title="××—×§" (click)="deleteCampaign(campaign)">ğŸ—‘</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ××™×Ÿ ×§××¤×™×™× ×™× -->
  <div *ngIf="!loading && campaigns.length === 0" class="no-campaigns">
    <div class="no-campaigns-icon">ğŸ¯</div>
    <h3>××™×Ÿ ×§××¤×™×™× ×™×</h3>
    <p>×œ× × ××¦××• ×§××¤×™×™× ×™× ×”×¢×•× ×™× ×¢×œ ×”×§×¨×™×˜×¨×™×•× ×™×</p>
    <button class="btn btn-primary" (click)="createCampaign()">×¦×•×¨ ×§××¤×™×™×Ÿ ×¨××©×•×Ÿ</button>
  </div>
</div>

<!-- ××•×“×œ ×”×•×¡×¤×ª/×¢×¨×™×›×ª ×§××¤×™×™×Ÿ -->
<div class="modal-overlay" *ngIf="showAddCampaignModal">
  <div class="modal-content campaign-modal">
    <div class="modal-header">
      <h2>{{editingCampaign?._?.isNew() ? '×§××¤×™×™×Ÿ ×—×“×©' : '×¢×¨×™×›×ª ×§××¤×™×™×Ÿ'}}</h2>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>×©× ×”×§××¤×™×™×Ÿ *</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="editingCampaign!.name" 
                 placeholder="×”×›× ×¡ ×©× ×§××¤×™×™×Ÿ">
        </div>
        
        <div class="form-group">
          <label>×§×˜×’×•×¨×™×”</label>
          <input type="text" class="form-control" 
                 [(ngModel)]="editingCampaign!.category" 
                 placeholder="×§×˜×’×•×¨×™×™×ª ×”×§××¤×™×™×Ÿ">
        </div>
        
        <div class="form-group">
          <label>×™×¢×“ ×›×¡×¤×™ *</label>
          <input type="number" class="form-control" 
                 [(ngModel)]="editingCampaign!.targetAmount" 
                 placeholder="0">
        </div>
        
        <div class="form-group">
          <label>××˜×‘×¢</label>
          <select class="form-control" [(ngModel)]="editingCampaign!.currency">
            <option value="ILS">×©×§×œ (â‚ª)</option>
            <option value="USD">×“×•×œ×¨ ($)</option>
            <option value="EUR">×™×•×¨×• (â‚¬)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>×ª××¨×™×š ×”×ª×—×œ×” *</label>
          <input type="date" class="form-control" 
                 [(ngModel)]="editingCampaign!.startDate">
        </div>
        
        <div class="form-group">
          <label>×ª××¨×™×š ×¡×™×•×</label>
          <input type="date" class="form-control" 
                 [(ngModel)]="editingCampaign!.endDate">
        </div>
        
        <div class="form-group">
          <label>×¡×˜×˜×•×¡</label>
          <select class="form-control" [(ngModel)]="editingCampaign!.status">
            <option value="draft">×˜×™×•×˜×”</option>
            <option value="active">×¤×¢×™×œ</option>
            <option value="completed">×”×•×©×œ×</option>
            <option value="cancelled">×‘×•×˜×œ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>××—×¨××™ ×§××¤×™×™×Ÿ</label>
          <select class="form-control" [(ngModel)]="editingCampaign!.managerId">
            <option value="">×‘×—×¨ ××—×¨××™...</option>
            <option *ngFor="let user of users" [value]="user.id">{{user.name}}</option>
          </select>
        </div>
        
        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="editingCampaign!.isActive"> ×§××¤×™×™×Ÿ ×¤×¢×™×œ
          </label>
        </div>
        
        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="editingCampaign!.isPublic"> ××•×¦×’ ×‘××ª×¨
          </label>
        </div>
        
        <div class="form-group">
          <label>×§×™×©×•×¨ ×œ×ª××•× ×”</label>
          <input type="url" class="form-control" 
                 [(ngModel)]="editingCampaign!.imageUrl" 
                 placeholder="https://example.com/image.jpg">
        </div>
        
        <div class="form-group">
          <label>×§×™×©×•×¨ ×œ×¢××•×“</label>
          <input type="url" class="form-control" 
                 [(ngModel)]="editingCampaign!.websiteUrl" 
                 placeholder="https://example.com">
        </div>
        
        <div class="form-group full-width">
          <label>×ª×™××•×¨ ×”×§××¤×™×™×Ÿ</label>
          <textarea class="form-control" rows="3" 
                    [(ngModel)]="editingCampaign!.description" 
                    placeholder="×ª××¨ ××ª ××˜×¨×•×ª ×”×§××¤×™×™×Ÿ..."></textarea>
        </div>
        
        <div class="form-group full-width">
          <label>×”×¢×¨×•×ª ×¤× ×™××™×•×ª</label>
          <textarea class="form-control" rows="2" 
                    [(ngModel)]="editingCampaign!.internalNotes" 
                    placeholder="×”×¢×¨×•×ª ×œ×¦×•×•×ª..."></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">×‘×™×˜×•×œ</button>
      <button class="btn btn-primary" (click)="saveCampaign()">×©××•×¨ ×§××¤×™×™×Ÿ</button>
    </div>
  </div>
</div>

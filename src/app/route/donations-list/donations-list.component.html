<div class="donations-container">
  <div class="page-header">
    <h1>{{ (i18n.terms$ | async)?.donationRecording }}</h1>
    <button class="btn btn-primary add-donation-btn" (click)="createDonation()">{{ (i18n.terms$ |
      async)?.recordNewDonation }}</button>
  </div>

  <div class="filters-section">
    <div class="filter-row">
      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.donorSearchFilter }}</label>
        <input type="text" class="form-control"
               [(ngModel)]="donorSearchText"
               (ngModelChange)="onDonorSearchChange($event)"
               [placeholder]="(i18n.terms$ | async)?.donorNamePlaceholder">
      </div>

      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.dateFromFilter }}</label>
        <input type="date" class="form-control">
      </div>

      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.dateToFilter }}</label>
        <input type="date" class="form-control">
      </div>

      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.donationMethodFilter }}</label>
        <select class="form-control">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option value="cash">{{ (i18n.terms$ | async)?.cash }}</option>
          <option value="check">{{ (i18n.terms$ | async)?.check }}</option>
          <option value="credit">{{ (i18n.terms$ | async)?.creditCard }}</option>
          <option value="transfer">{{ (i18n.terms$ | async)?.bankTransfer }}</option>
          <option value="standing">{{ (i18n.terms$ | async)?.standingOrderMethod }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.amountFromFilter }}</label>
        <input type="number" class="form-control" placeholder="0">
      </div>

      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.campaignFilter }}</label>
        <select class="form-control">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option *ngFor="let campaign of campaigns" [value]="campaign.id">{{ campaign.name }}</option>
        </select>
      </div>
    </div>
  </div>

  <div class="summary-cards">
    <div class="summary-card total">
      <div class="card-icon">💰</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.totalDonationsSum }}</h3>
        <span class="amount">₪{{ totalAmount | number }}</span>
      </div>
    </div>
    <div class="summary-card monthly">
      <div class="card-icon">📅</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.pendingApprovalAmount }}</h3>
        <span class="amount">₪{{ pendingAmount | number }}</span>
      </div>
    </div>
    <div class="summary-card donors">
      <div class="card-icon">👥</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.numberOfDonations }}</h3>
        <span class="count">{{ donations.length }}</span>
      </div>
    </div>
    <div class="summary-card avg">
      <div class="card-icon">📊</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.completedDonationsCount }}</h3>
        <span class="count">{{ completedDonationsCount }}</span>
      </div>
    </div>
  </div>

  <div class="donations-grid">
    <div class="grid-header">
      <div class="grid-col">{{ (i18n.terms$ | async)?.dateColumn }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.donorColumn }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.amountColumn }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.currencyColumn }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.methodColumn }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.campaign }}</div>
      <div class="grid-col">{{ (i18n.terms$ | async)?.fundraiserColumn }}</div>
      <!-- <div class="grid-col">{{ (i18n.terms$ | async)?.thankYouLetterColumn }}</div> -->
      <!-- <div class="grid-col">{{ (i18n.terms$ | async)?.proofColumn }}</div> -->
      <div class="grid-col">{{ (i18n.terms$ | async)?.actionsColumn }}</div>
    </div>

    <div class="grid-row" *ngFor="let donation of donationsWithCampaign">
      <div class="grid-col date-col">
        <div class="date-display">
          <span class="hebrew-date">{{ donation.donationDate | date:'dd/MM/yyyy' }}</span>
          <!-- <span class="secular-date">{{ donation.donationDate | date:'dd/MM/yyyy' }}</span> -->
        </div>
      </div>
      <div class="grid-col donor-col">
        <strong>{{ getDonorName(donation) }}</strong>
      </div>
      <div class="grid-col amount-col">
        <span class="amount">₪{{donation.amount | number}}</span>
      </div>
      <div class="grid-col">{{donation.currency}}</div>
      <div class="grid-col">
        <span class="method-badge method-{{donation.donationMethod?.type}}">{{ getMethodName(donation) }}</span>
      </div>
      <div class="grid-col">{{ getCampaignName(donation) }}</div>
      <div class="grid-col">{{ donation.fundraiserId || (i18n.terms$ | async)?.createdByUnknown }}</div>
      <!-- <div class="grid-col">
        <span class="status-badge" [class]="'status-' + donation.status">
          {{ getStatusText(donation.status) }}
        </span>
      </div> -->
      <!-- <div class="grid-col">
        <span class="proof-indicator" [class]="donation.receiptIssued ? 'has-proof' : 'no-proof'">
          {{donation.receiptIssued ? '✓' : '✗'}}
        </span>
      </div> -->
      <div class="grid-col actions">
        <button class="btn-icon btn-view" (click)="editDonation(donation)"
          [title]="(i18n.terms$ | async)?.viewDetails">👁</button>
        <button class="btn-icon btn-edit" (click)="editDonation(donation)"
          [title]="(i18n.terms$ | async)?.edit">✏</button>
        <button class="btn-icon btn-receipt" (click)="issueReceipt(donation)" [disabled]="donation.receiptIssued"
          [title]="(i18n.terms$ | async)?.receiptAction">🧾</button>
        <button class="btn-icon btn-delete" (click)="deleteDonation(donation)"
          [title]="(i18n.terms$ | async)?.delete">🗑</button>
        <button class="btn-icon btn-cancel" (click)="cancelDonation(donation)"
          [disabled]="donation.status === 'cancelled'" [title]="(i18n.terms$ | async)?.cancelDonation">❌</button>
      </div>
    </div>
  </div>

  <div class="pagination">
    <button class="btn-page">{{ (i18n.terms$ | async)?.previousPage }}</button>
    <span class="page-info">{{ (i18n.terms$ | async)?.pageOf?.replace('{current}', '1')?.replace('{total}', '15')
      }}</span>
    <button class="btn-page">{{ (i18n.terms$ | async)?.nextPage }}</button>
  </div>
</div>
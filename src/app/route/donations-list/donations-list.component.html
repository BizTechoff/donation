<div class="donations-container">
  <div class="page-header">
    <h1>×¨×™×©×•× ×ª×¨×•××•×ª</h1>
    <button class="btn btn-primary add-donation-btn" (click)="createDonation()">×¨×™×©×•× ×ª×¨×•××” ×—×“×©×”</button>
  </div>

  <div class="filters-section">
    <div class="filter-row">
      <div class="filter-group">
        <label>×—×™×¤×•×© ×ª×•×¨×</label>
        <input type="text" class="form-control" placeholder="×©× ×ª×•×¨×...">
      </div>
      
      <div class="filter-group">
        <label>×ª××¨×™×š ×-</label>
        <input type="date" class="form-control">
      </div>

      <div class="filter-group">
        <label>×ª××¨×™×š ×¢×“</label>
        <input type="date" class="form-control">
      </div>

      <div class="filter-group">
        <label>××•×¤×Ÿ ×ª×¨×•××”</label>
        <select class="form-control">
          <option value="">×”×›×œ</option>
          <option value="cash">××–×•××Ÿ</option>
          <option value="check">×¦'×§</option>
          <option value="credit">×›×¨×˜×™×¡ ××©×¨××™</option>
          <option value="transfer">×”×¢×‘×¨×” ×‘× ×§××™×ª</option>
          <option value="standing">×”×•×¨××ª ×§×‘×¢</option>
        </select>
      </div>

      <div class="filter-group">
        <label>×¡×›×•× ×-</label>
        <input type="number" class="form-control" placeholder="0">
      </div>

      <div class="filter-group">
        <label>××•×¦×¨</label>
        <select class="form-control">
          <option value="">×”×›×œ</option>
          <option value="general">×›×œ×œ×™</option>
          <option value="torah">×œ×™××•×“ ×ª×•×¨×”</option>
          <option value="charity">×¦×“×§×”</option>
          <option value="building">×‘× ×™×™×Ÿ</option>
        </select>
      </div>
    </div>
  </div>

  <div class="summary-cards">
    <div class="summary-card total">
      <div class="card-icon">ğŸ’°</div>
      <div class="card-content">
        <h3>×¡×”"×› ×ª×¨×•××•×ª</h3>
        <span class="amount">â‚ª{{ totalAmount | number }}</span>
      </div>
    </div>
    <div class="summary-card monthly">
      <div class="card-icon">ğŸ“…</div>
      <div class="card-content">
        <h3>×××ª×™×Ÿ ×œ××™×©×•×¨</h3>
        <span class="amount">â‚ª{{ pendingAmount | number }}</span>
      </div>
    </div>
    <div class="summary-card donors">
      <div class="card-icon">ğŸ‘¥</div>
      <div class="card-content">
        <h3>××¡' ×ª×¨×•××•×ª</h3>
        <span class="count">{{ donations.length }}</span>
      </div>
    </div>
    <div class="summary-card avg">
      <div class="card-icon">ğŸ“Š</div>
      <div class="card-content">
        <h3>×ª×¨×•××•×ª ×©×”×•×©×œ××•</h3>
        <span class="count">{{ completedDonationsCount }}</span>
      </div>
    </div>
  </div>

  <div class="donations-grid">
    <div class="grid-header">
      <div class="grid-col">×ª××¨×™×š</div>
      <div class="grid-col">×ª×•×¨×</div>
      <div class="grid-col">×¡×›×•×</div>
      <div class="grid-col">××˜×‘×¢</div>
      <div class="grid-col">××•×¤×Ÿ ×ª×¨×•××”</div>
      <div class="grid-col">××•×¦×¨</div>
      <div class="grid-col">××ª×¨×™×</div>
      <div class="grid-col">××›×ª×‘ ×ª×•×“×”</div>
      <div class="grid-col">×”×•×›×—×”</div>
      <div class="grid-col">×¤×¢×•×œ×•×ª</div>
    </div>

    <div class="grid-row" *ngFor="let donation of donations">
      <div class="grid-col date-col">
        <div class="date-display">
          <span class="hebrew-date">{{ donation.donationDate | date:'dd/MM/yyyy' }}</span>
          <span class="secular-date">{{ donation.donationDate | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>
      <div class="grid-col donor-col">
        <strong>{{ getDonorName(donation) }}</strong>
      </div>
      <div class="grid-col amount-col">
        <span class="amount">â‚ª{{donation.amount | number}}</span>
      </div>
      <div class="grid-col">{{donation.currency}}</div>
      <div class="grid-col">
        <span class="method-badge method-{{donation.donationMethod?.type}}">{{ getMethodName(donation) }}</span>
      </div>
      <div class="grid-col">{{ getCampaignName(donation) }}</div>
      <div class="grid-col">{{ donation.createdBy?.name || '×œ× ×™×“×•×¢' }}</div>
      <div class="grid-col">
        <span class="status-badge" [class]="'status-' + donation.status">
          {{ getStatusText(donation.status) }}
        </span>
      </div>
      <div class="grid-col">
        <span class="proof-indicator" [class]="donation.receiptIssued ? 'has-proof' : 'no-proof'">
          {{donation.receiptIssued ? 'âœ“' : 'âœ—'}}
        </span>
      </div>
      <div class="grid-col actions">
        <button class="btn-icon btn-view" (click)="editDonation(donation)" title="×”×¦×’ ×¤×¨×˜×™×">ğŸ‘</button>
        <button class="btn-icon btn-edit" (click)="editDonation(donation)" title="×¢×¨×™×›×”">âœ</button>
        <button class="btn-icon btn-receipt" (click)="issueReceipt(donation)" [disabled]="donation.receiptIssued" title="×”×“×¤×¡ ×§×‘×œ×”">ğŸ§¾</button>
        <button class="btn-icon btn-delete" (click)="deleteDonation(donation)" title="××—×§">ğŸ—‘</button>
        <button class="btn-icon btn-cancel" (click)="cancelDonation(donation)" [disabled]="donation.status === 'cancelled'" title="×‘×™×˜×•×œ">âŒ</button>
      </div>
    </div>
  </div>

  <div class="pagination">
    <button class="btn-page">×”×§×•×“×</button>
    <span class="page-info">×¢××•×“ 1 ××ª×•×š 15</span>
    <button class="btn-page">×”×‘×</button>
  </div>
</div>

<!-- ××•×“×œ ×¨×™×©×•× ×ª×¨×•××” ×—×“×©×” -->
<div class="modal-overlay" *ngIf="showAddDonationModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>×¨×™×©×•× ×ª×¨×•××” ×—×“×©×”</h2>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group" *ngIf="editingDonation">
          <label>×ª×•×¨×</label>
          <select class="form-control" [(ngModel)]="editingDonation!.donorId">
            <option value="">×‘×—×¨ ×ª×•×¨×...</option>
            <option *ngFor="let donor of donors" [value]="donor.id">{{ donor.displayName }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>×ª××¨×™×š ×œ×•×¢×–×™</label>
          <input type="date" class="form-control" [(ngModel)]="donationDateForInput">
        </div>
        <div class="form-group">
          <label>×ª××¨×™×š ×¢×‘×¨×™</label>
          <input type="text" class="form-control" placeholder="××•×˜×•××˜×™" [(ngModel)]="hebrewDate">
        </div>
        <div class="form-group" *ngIf="editingDonation">
          <label>×¡×›×•×</label>
          <input type="number" class="form-control" placeholder="0" [(ngModel)]="editingDonation!.amount">
        </div>
        <div class="form-group" *ngIf="editingDonation">
          <label>××˜×‘×¢</label>
          <select class="form-control" [(ngModel)]="editingDonation!.currency">
            <option value="ILS">×©×§×œ</option>
            <option value="USD">×“×•×œ×¨</option>
            <option value="EUR">×™×•×¨×•</option>
          </select>
        </div>
        <div class="form-group" *ngIf="editingDonation">
          <label>××•×¤×Ÿ ×ª×¨×•××”</label>
          <select class="form-control" [(ngModel)]="editingDonation!.donationMethodId">
            <option value="">×‘×—×¨ ××•×¤×Ÿ ×ª×¨×•××”...</option>
            <option *ngFor="let method of donationMethods" [value]="method.id">{{ method.name }}</option>
          </select>
        </div>
        <div class="form-group" *ngIf="editingDonation">
          <label>××•×¦×¨</label>
          <select class="form-control" [(ngModel)]="editingDonation!.campaignId">
            <option value="">×‘×—×¨ ××•×¦×¨...</option>
            <option *ngFor="let campaign of campaigns" [value]="campaign.id">{{ campaign.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>××ª×¨×™×</label>
          <input type="text" class="form-control" placeholder="×©× ×”××ª×¨×™×" [(ngModel)]="fundraiserName">
        </div>
        <div class="form-group full-width" *ngIf="editingDonation">
          <label>×¡×™×‘×” / ×”×¢×¨×•×ª</label>
          <textarea class="form-control" rows="3" placeholder="×”×›× ×¡ ×”×¢×¨×•×ª..." [(ngModel)]="editingDonation!.notes"></textarea>
        </div>
      </div>

      <!-- ×ª×¦×•×’×” ××§×“×™××” -->
      <div class="preview-section" *ngIf="showPreview">
        <h3>×ª×¦×•×’×” ××§×“×™××”</h3>
        <div class="preview-card">
          <div class="preview-row">
            <strong>×ª×•×¨×:</strong>
            <span>{{ getSelectedDonorName() || '×œ× × ×‘×—×¨' }}</span>
          </div>
          <div class="preview-row">
            <strong>×ª××¨×™×š ×œ×•×¢×–×™:</strong>
            <span>{{ editingDonation?.donationDate ? (editingDonation!.donationDate | date:'dd/MM/yyyy') : '×œ× × ×‘×—×¨' }}</span>
          </div>
          <div class="preview-row">
            <strong>×ª××¨×™×š ×¢×‘×¨×™:</strong>
            <span>{{ hebrewDate || '××•×˜×•××˜×™' }}</span>
          </div>
          <div class="preview-row">
            <strong>×¡×›×•×:</strong>
            <span>{{ getCurrencySymbol() }}{{ editingDonation?.amount || '0' | number }}</span>
          </div>
          <div class="preview-row">
            <strong>××•×¤×Ÿ ×ª×¨×•××”:</strong>
            <span>{{ getSelectedMethodName() }}</span>
          </div>
          <div class="preview-row">
            <strong>××•×¦×¨:</strong>
            <span>{{ getSelectedCampaignName() }}</span>
          </div>
          <div class="preview-row">
            <strong>××ª×¨×™×:</strong>
            <span>{{ fundraiserName || '×œ× ×¦×•×™×Ÿ' }}</span>
          </div>
          <div class="preview-row" *ngIf="editingDonation?.notes">
            <strong>×”×¢×¨×•×ª:</strong>
            <span>{{ editingDonation!.notes }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">×‘×™×˜×•×œ</button>
      <button class="btn btn-info" (click)="togglePreview()">{{ showPreview ? '×”×¡×ª×¨ ×ª×¦×•×’×” ××§×“×™××”' : '×ª×¦×•×’×” ××§×“×™××”' }}</button>
      <button class="btn btn-success" (click)="saveDonationAndExit()">×©××•×¨ ×•×™×¦×</button>
      <button class="btn btn-primary" (click)="saveDonation()">×©××•×¨ ×ª×¨×•××”</button>
    </div>
  </div>
</div>
<div class="module-container">

  <!-- HEADER: Sticky top - ×¤×™×œ×˜×¨×™× + ×›×¤×ª×•×¨ ×”×•×¡×¤×” -->
  <div class="module-header">
    <div class="filters-section">
      <div class="filter-row">
        <div class="filter-group search-group">
          <!-- <label>{{ (i18n.terms$ | async)?.generalSearch }}</label> -->
          <input
            type="text"
            class="form-control"
            [placeholder]="(i18n.terms$ | async)?.searchNameAddressPhone"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onLocalFilterChange()">
        </div>
        <button class="btn btn-primary add-donor-btn" (click)="createDonor()">
          {{ (i18n.terms$ | async)?.addNewDonor }}
        </button>
      </div>
    </div>
  </div>

  <!-- CONTENT: ××–×•×¨ ×”×ª×•×›×Ÿ ×”××¨×›×–×™ -->
  <div class="module-content">

    <!-- Table Body: Scrollable area -->
    <div class="table-body">
      <div class="loading-overlay" *ngIf="loading">
        <div class="spinner">×˜×•×¢×Ÿ...</div>
      </div>

      <table class="data-table">
      <thead>
        <tr>
          <th class="sortable" [class.sorted]="isSorted('fullName')" (click)="toggleSort('fullName', $event)">
            {{ (i18n.terms$ | async)?.name }}
            <span class="sort-icon" *ngIf="getSortIcon('fullName')">{{ getSortIcon('fullName') }}</span>
          </th>
          <th class="sortable" [class.sorted]="isSorted('address')" (click)="toggleSort('address', $event)">
            {{ (i18n.terms$ | async)?.address }}
            <span class="sort-icon" *ngIf="getSortIcon('address')">{{ getSortIcon('address') }}</span>
          </th>
          <th class="sortable" [class.sorted]="isSorted('phone')" (click)="toggleSort('phone', $event)">
            {{ (i18n.terms$ | async)?.phone }}
            <span class="sort-icon" *ngIf="getSortIcon('phone')">{{ getSortIcon('phone') }}</span>
          </th>
          <th class="sortable" [class.sorted]="isSorted('email')" (click)="toggleSort('email', $event)">
            {{ (i18n.terms$ | async)?.email }}
            <span class="sort-icon" *ngIf="getSortIcon('email')">{{ getSortIcon('email') }}</span>
          </th>
          <th class="sortable" [class.sorted]="isSorted('lastDonationDate')" (click)="toggleSort('lastDonationDate', $event)">
            {{ (i18n.terms$ | async)?.lastDonation }}
            <span class="sort-icon" *ngIf="getSortIcon('lastDonationDate')">{{ getSortIcon('lastDonationDate') }}</span>
          </th>
          <!-- <th class="sortable" [class.sorted]="isSorted('averageDonation')" (click)="toggleSort('averageDonation', $event)">
            <div>{{ (i18n.terms$ | async)?.averageDonation }}</div>
            <small>({{ (i18n.terms$ | async)?.inLast12Months }})</small>
            <span class="sort-icon" *ngIf="getSortIcon('averageDonation')">{{ getSortIcon('averageDonation') }}</span>
          </th> -->
          <th class="actions-header">
            <div class="actions-header-content">
              <span>{{ (i18n.terms$ | async)?.actions }}</span>
              <div class="header-buttons">
                <button class="btn-icon-header" (click)="refreshData()" [title]="'×¨×¢× ×•×Ÿ'">
                  <mat-icon>refresh</mat-icon>
                </button>
                <button class="btn-icon-header" (click)="onPrint()" [title]="'×”×“×¤×¡×”'">
                  <mat-icon>print</mat-icon>
                </button>
                <button class="btn-icon-header btn-excel" (click)="onExport()" [title]="'×™×™×¦×•× ×œ××§×¡×œ'">
                  <span class="excel-x">X</span>
                </button>
              </div>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let donor of this.donors" class="clickable-row" (dblclick)="openDonorDonations(donor)">
          <td>
            <div class="donor-name">
              <strong>{{donor.lastAndFirstName}}</strong>
              <!-- <small *ngIf="donor.idNumber">({{ (i18n.terms$ | async)?.idNumberShort }}: {{donor.idNumber}})</small> -->
            </div>
          </td>
          <td class="donor-address">{{getDonorAddress(donor.id)}}</td>
          <td>{{getDonorPhone(donor.id)}}</td>
          <td>{{getDonorEmail(donor.id)}}</td>
          <td>
            <div>{{ formatHebrewDate(getDonorLastDonationDate(donor.id)) }}</div>
            <small *ngIf="getDonorLastDonationAmount(donor.id)">{{getDonorLastDonationCurrencySymbol(donor.id)}}{{getDonorLastDonationAmount(donor.id) | number:'1.0-0'}}{{isDonorLastDonationAsPartner(donor.id) ? ' - ×©×•×ª×£' : ''}}</small>
            <small *ngIf="getDonorLastDonationReason(donor.id) && getDonorLastDonationReason(donor.id) !== '-'"> - {{getDonorLastDonationReason(donor.id)}}</small>
          </td>
          <!-- <td>
            <div>{{getDonorAverageDonationCurrencySymbol(donor.id)}}{{getDonorAverageDonation(donor.id) | number:'1.2-2'}}</div>
            <small *ngIf="getDonorDonationsCount(donor.id) === 1">×ª×¨×•××” ××—×ª</small>
            <small *ngIf="getDonorDonationsCount(donor.id) > 1">{{getDonorDonationsCount(donor.id)}} ×ª×¨×•××•×ª</small>
          </td> -->
          <td class="actions">
            <button class="btn-icon btn-donations" (click)="openDonorDonations(donor); $event.stopPropagation()" [title]="(i18n.terms$ | async)?.donations || '×ª×¨×•××•×ª'">ğŸ’°</button>
            <button class="btn-icon btn-gifts" (click)="openDonorGifts(donor); $event.stopPropagation()" [title]="(i18n.terms$ | async)?.gifts || '××ª× ×•×ª'">ğŸ</button>
            <button class="btn-icon btn-edit" (click)="editDonor(donor); $event.stopPropagation()" [title]="(i18n.terms$ | async)?.edit">âœ</button>
            <button class="btn-icon btn-delete" (click)="deleteDonor(donor); $event.stopPropagation()" [title]="(i18n.terms$ | async)?.delete">ğŸ—‘</button>
          </td>
        </tr>
        <tr *ngIf="!loading && this.donors.length === 0">
          <td colspan="7" class="no-data">
            <p>{{ (i18n.terms$ | async)?.noDataFound }}</p>
          </td>
        </tr>
      </tbody>
    </table>
    </div>

    <!-- Table Footer: Sticky bottom - Pagination -->
    <div class="table-footer">
      <div class="pagination-controls">
        <button
          class="btn-page"
          (click)="firstPage()"
          [disabled]="currentPage === 1 || loading">
          â® {{ (i18n.terms$ | async)?.first }}
        </button>

        <button
          class="btn-page"
          (click)="previousPage()"
          [disabled]="currentPage === 1 || loading">
          â† {{ (i18n.terms$ | async)?.previous }}
        </button>

        <div class="page-numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            class="btn-page-number"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
            [disabled]="loading">
            {{page}}
          </button>
        </div>

        <button
          class="btn-page"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages || loading">
          {{ (i18n.terms$ | async)?.next }} â†’
        </button>

        <button
          class="btn-page"
          (click)="lastPage()"
          [disabled]="currentPage === totalPages || loading">
          {{ (i18n.terms$ | async)?.last }} â­
        </button>
      </div>

      <div class="pagination-info">
        <span>{{ (i18n.terms$ | async)?.showing }} {{(currentPage - 1) * pageSize + 1}} - {{Math.min(currentPage * pageSize, totalCount)}} {{ (i18n.terms$ | async)?.of }} {{totalCount}}</span>
      </div>
    </div>
  </div>

  <!-- FOOTER: Sticky bottom - (×¨×™×§ ×›×¨×’×¢, ×œ×¢×ª×™×“) -->
  <div class="module-footer">
    <!-- ××§×•× ×œ×¡×™×›×•××™×, ×¡×˜×˜×™×¡×˜×™×§×•×ª, ×•×›×•' -->
  </div>

</div>

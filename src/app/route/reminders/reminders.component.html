<div class="module-container">

  <!-- HEADER: Sticky top -->
  <div class="module-header">
    <div class="header-top">
      <h1>{{ (i18n.terms$ | async)?.remindersAndTracking }}</h1>
      <button class="btn btn-primary add-reminder-btn" (click)="createReminder()">{{ (i18n.terms$ | async)?.addReminder
        }}</button>
    </div>

    <div class="summary-cards">
      <div class="summary-card today">
        <div class="card-icon">ğŸ””</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.todayReminders }}</h3>
          <span class="count urgent">{{todayReminders.length}}</span>
        </div>
      </div>
      <div class="summary-card this-week">
        <div class="card-icon">ğŸ“…</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.thisWeekReminders }}</h3>
          <span class="count">{{pendingReminders.length}}</span>
        </div>
      </div>
      <div class="summary-card overdue">
        <div class="card-icon">âš ï¸</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.overdueReminders }}</h3>
          <span class="count urgent">{{overdueReminders.length}}</span>
        </div>
      </div>
      <!-- <div class="summary-card completed">
        <div class="card-icon">âœ…</div>
        <div class="card-content">
          <h3>{{ (i18n.terms$ | async)?.completedThisMonth }}</h3>
          <span class="count">{{completedRemindersCount}}</span>
        </div>
      </div> -->
    </div>

    <div class="filters-section">
      <div class="filter-row">
        <div class="filter-group">
          <label>{{ (i18n.terms$ | async)?.reminderTypeFilter }}</label>
          <select class="form-control" [(ngModel)]="filterReminderType" (ngModelChange)="loadReminders()">
            <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
            <option value="donation">{{ (i18n.terms$ | async)?.donationReminder }}</option>
            <option value="contact">{{ (i18n.terms$ | async)?.contactReminder }}</option>
            <option value="birthday">{{ (i18n.terms$ | async)?.birthdayReminder }}</option>
            <option value="memorial">{{ (i18n.terms$ | async)?.memorialReminder }}</option>
            <option value="meeting">{{ (i18n.terms$ | async)?.meetingReminder }}</option>
            <option value="follow-up">{{ (i18n.terms$ | async)?.followUpReminder }}</option>
          </select>
        </div>

        <!-- <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.reminderStatusFilter }}</label>
        <select class="form-control">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option value="pending">{{ (i18n.terms$ | async)?.pendingStatus }}</option>
          <option value="completed">{{ (i18n.terms$ | async)?.completedStatusReminder }}</option>
          <option value="overdue">{{ (i18n.terms$ | async)?.overdueStatus }}</option>
          <option value="cancelled">{{ (i18n.terms$ | async)?.cancelledStatusReminder }}</option>
        </select>
      </div> -->

        <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.dateFromFilter }}</label>
          <app-modern-dual-date-picker
            [(ngModel)]="filterDateFrom"
            [label]="(i18n.terms$ | async)?.dateFromReminder || ''"
            [compact]="true"
            [showOnlyHebrew]="true"
            (dateChange)="loadReminders()">
          </app-modern-dual-date-picker>
        </div>

        <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.dateToFilter }}</label>
          <app-modern-dual-date-picker
            [(ngModel)]="filterDateTo"
            [label]="(i18n.terms$ | async)?.dateToReminder || ''"
            [compact]="true"
            [showOnlyHebrew]="true"
            (dateChange)="loadReminders()">
          </app-modern-dual-date-picker>
        </div>

        <div class="filter-group">
          <label>{{ (i18n.terms$ | async)?.donorSearchReminder }}</label>
          <input type="text" class="form-control"
                 [(ngModel)]="filterDonorSearch"
                 (ngModelChange)="loadReminders()"
                 [placeholder]="(i18n.terms$ | async)?.donorNamePlaceholder">
        </div>

        <!-- <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.regionFilter }}</label>
        <select class="form-control">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option value="center">{{ (i18n.terms$ | async)?.centerRegion }}</option>
          <option value="north">{{ (i18n.terms$ | async)?.northRegion }}</option>
          <option value="south">{{ (i18n.terms$ | async)?.southRegion }}</option>
          <option value="jerusalem">{{ (i18n.terms$ | async)?.jerusalemRegion }}</option>
        </select>
      </div> -->

        <!-- <div class="filter-group">
          <label>{{ (i18n.terms$ | async)?.parashaLabel }}</label>
          <select class="form-control" [(ngModel)]="fromParasha" (change)="applyParashaFilter()">
            <option value="">{{ (i18n.terms$ | async)?.selectParashaPlaceholder }}</option>
            <option *ngFor="let parasha of torahPortions; let i = index" [value]="i">{{parasha}}</option>
          </select>
        </div> -->

        <!-- <div class="filter-group">
        <label>×¢×“ ×¤×¨×©×”</label>
        <select class="form-control" [(ngModel)]="toParasha" (change)="applyParashaFilter()">
          <option value="">{{ (i18n.terms$ | async)?.selectParashaOption }}</option>
          <option *ngFor="let parasha of torahPortions; let i = index" [value]="i">{{parasha}} ({{i}})</option>
        </select>
      </div> -->
      </div>
    </div>
  </div>

  <!-- CONTENT: Main scrollable area -->
  <div class="module-content">

    <!-- <div class="reminders-tabs">
      <button class="tab-btn" [class.active]="activeTab === 'today'" (click)="switchTab('today')">
        {{ (i18n.terms$ | async)?.todayTab }} ({{todayReminders.length}})
      </button>
      <button class="tab-btn" [class.active]="activeTab === 'week'" (click)="switchTab('week')">
        {{ (i18n.terms$ | async)?.weekTab }} ({{thisWeekReminders.length}})
      </button>
      <button class="tab-btn" [class.active]="activeTab === 'overdue'" (click)="switchTab('overdue')">
        {{ (i18n.terms$ | async)?.overdueTab }} ({{overdueReminders.length}})
      </button>
      <button class="tab-btn" [class.active]="activeTab === 'all'" (click)="switchTab('all')">
        {{ (i18n.terms$ | async)?.allTab }}
      </button>
    </div> -->

    <div class="reminders-table-container">
      <table class="reminders-table">
        <thead>
          <tr>
            <th class="sortable" [class.sorted]="isSorted('dueDate')" (click)="toggleSort('dueDate', $event)">
              {{ (i18n.terms$ | async)?.reminderDateHeader }}
              <span class="sort-icon">{{ getSortIcon('dueDate') }}</span>
            </th>
            <th class="sortable" [class.sorted]="isSorted('type')" (click)="toggleSort('type', $event)">
              {{ (i18n.terms$ | async)?.typeHeader }}
              <span class="sort-icon">{{ getSortIcon('type') }}</span>
            </th>
            <th>××§×•×¨</th>
            <th>{{ (i18n.terms$ | async)?.donorHeader }}</th>
            <th class="sortable" [class.sorted]="isSorted('title')" (click)="toggleSort('title', $event)">
              {{ (i18n.terms$ | async)?.subjectHeader }}
              <span class="sort-icon">{{ getSortIcon('title') }}</span>
            </th>
            <th class="sortable" [class.sorted]="isSorted('priority')" (click)="toggleSort('priority', $event)">
              {{ (i18n.terms$ | async)?.priorityHeader }}
              <span class="sort-icon">{{ getSortIcon('priority') }}</span>
            </th>
            <!-- <th>{{ (i18n.terms$ | async)?.statusHeaderReminder }}</th> -->
            <th>{{ (i18n.terms$ | async)?.actionsHeaderReminder }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let reminder of filteredReminders" [class.overdue]="reminder.isOverdue"
            [class.today]="reminder.isDueToday" [class.completed]="reminder.isCompleted">

            <td class="date-col">
              <div class="date-display">
                <span class="reminder-date">{{ formatHebrewDate(reminder.dueDate) }}</span>
                <small class="moed-name" *ngIf="getMoedName(reminder.dueDate)">{{getMoedName(reminder.dueDate)}}</small>
              </div>
            </td>

            <td class="type-col">
              <span class="type-badge type-{{reminder.type}}">{{getTypeText(reminder.type)}}</span>
            </td>

            <td class="source-col">
              <span class="source-badge" [title]="getSourceText(reminder)">
                {{getSourceIcon(reminder)}} {{getSourceText(reminder)}}
              </span>
            </td>

            <td class="donor-col">
              <div class="donor-info">
                <strong>{{getDonorName(reminder)}}</strong>
                <small *ngIf="getReminderDonorPhone(reminder)">{{getReminderDonorPhone(reminder)}}</small>
              </div>
            </td>

            <td class="subject-col">
              <div class="subject-info">
                <span class="subject">{{reminder.title}}</span>
                <small class="notes" *ngIf="reminder.description">{{reminder.description | slice:0:50}}<span
                    *ngIf="reminder.description && reminder.description.length > 50">...</span></small>
              </div>
            </td>

            <td class="priority-col">
              <span class="priority-badge"
                [class]="getPriorityBadgeClass(reminder.priority)">{{getPriorityText(reminder.priority)}}</span>
            </td>

            <!-- <td class="status-col">
            <span class="status-badge" [class]="getStatusBadgeClass(reminder.status)">{{reminder.statusText}}</span>
          </td> -->

            <td class="actions">
              <button class="btn-icon btn-complete" [title]="(i18n.terms$ | async)?.markAsCompleted" *ngIf="!reminder.isCompleted" (click)="completeReminder(reminder)">âœ…</button>
              <button class="btn-icon btn-edit" [title]="(i18n.terms$ | async)?.editReminder"
                (click)="editReminder(reminder)">âœ</button>
              <!-- <div class="snooze-dropdown" *ngIf="!reminder.isCompleted">
                <button class="btn-icon btn-postpone" [title]="(i18n.terms$ | async)?.snoozeReminder">â°</button>
                <div class="snooze-menu">
                  <button (click)="snoozeReminder(reminder, 1)">{{ (i18n.terms$ | async)?.snoozeOneDay }}</button>
                  <button (click)="snoozeReminder(reminder, 7)">{{ (i18n.terms$ | async)?.snoozeOneWeek }}</button>
                  <button (click)="snoozeReminder(reminder, 30)">{{ (i18n.terms$ | async)?.snoozeOneMonth }}</button>
                </div>
              </div> -->
              <button class="btn-icon btn-delete" [title]="(i18n.terms$ | async)?.deleteReminder"
                (click)="deleteReminder(reminder)">ğŸ—‘</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- <div class="quick-reminders">
    <h2>{{ (i18n.terms$ | async)?.quickReminders }}</h2>
    <div class="quick-reminder-cards">
      <div class="quick-card birthdays">
        <div class="card-header">
          <span class="icon">ğŸ‚</span>
          <h3>{{ (i18n.terms$ | async)?.birthdaysThisWeek }}</h3>
        </div>
        <div class="card-body">
          <div class="birthday-item" *ngFor="let birthday of upcomingBirthdays">
            <span class="name">{{birthday.displayName}}</span>
            <span class="date">{{birthday.birthDate | date:'dd/MM'}}</span>
          </div>
        </div>
      </div>

      <div class="quick-card memorials">
        <div class="card-header">
          <span class="icon">ğŸ•¯ï¸</span>
          <h3>{{ (i18n.terms$ | async)?.yahrzeitThisWeek }}</h3>
        </div>
        <div class="card-body">
          <div class="memorial-item">
            <p>{{ (i18n.terms$ | async)?.noYahrzeitThisWeek }}</p>
          </div>
        </div>
      </div>

      <div class="quick-card donations">
        <div class="card-header">
          <span class="icon">ğŸ’°</span>
          <h3>{{ (i18n.terms$ | async)?.donationCandidates }}</h3>
        </div>
        <div class="card-body">
          <div class="donation-candidate" *ngFor="let candidate of donationCandidates">
            <span class="name">{{candidate.displayName}}</span>
            <span class="last-donation">{{ (i18n.terms$ | async)?.donationCandidate }}</span>
          </div>
          <p *ngIf="donationCandidates.length === 0">{{ (i18n.terms$ | async)?.noCandidatesAvailable }}</p>
        </div>
      </div>

      <div class="quick-card meetings">
        <div class="card-header">
          <span class="icon">ğŸ¤</span>
          <h3>{{ (i18n.terms$ | async)?.meetingsThisWeek }}</h3>
        </div>
        <div class="card-body">
          <div class="meeting-item" *ngFor="let meeting of upcomingMeetings">
            <span class="name">{{getDonorName(meeting)}}</span>
            <span class="purpose">{{meeting.title}}</span>
            <span class="datetime">{{meeting.dueDate | date:'dd/MM'}}</span>
          </div>
          <p *ngIf="upcomingMeetings.length === 0">{{ (i18n.terms$ | async)?.noMeetingsThisWeek }}</p>
        </div>
      </div>
    </div>
  </div> -->

  </div>

  <!-- FOOTER: Sticky bottom -->
  <div class="module-footer">
    <div class="pagination-controls">
      <button
        class="btn-page"
        (click)="firstPage()"
        [disabled]="currentPage === 1 || loading">
        â® {{ (i18n.terms$ | async)?.first }}
      </button>

      <button
        class="btn-page"
        (click)="previousPage()"
        [disabled]="currentPage === 1 || loading">
        â† {{ (i18n.terms$ | async)?.previous }}
      </button>

      <div class="page-numbers">
        <button
          *ngFor="let page of getPageNumbers()"
          class="btn-page-number"
          [class.active]="page === currentPage"
          [disabled]="page === -1"
          (click)="page !== -1 && goToPage(page)">
          {{ page === -1 ? '...' : page }}
        </button>
      </div>

      <button
        class="btn-page"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages || loading">
        {{ (i18n.terms$ | async)?.next }} â†’
      </button>

      <button
        class="btn-page"
        (click)="lastPage()"
        [disabled]="currentPage === totalPages || loading">
        {{ (i18n.terms$ | async)?.last }} â­
      </button>
    </div>

    <div class="pagination-info">
      <span>{{ (i18n.terms$ | async)?.showing }} {{(currentPage - 1) * pageSize + 1}} - {{Math.min(currentPage * pageSize, totalCount)}} {{ (i18n.terms$ | async)?.of }} {{totalCount}}</span>
    </div>
  </div>

</div>
<div class="standing-orders-container">
  <div class="page-header">
    <h1>{{ (i18n.terms$ | async)?.standingOrdersTitle }}</h1>
    <button class="btn btn-primary add-order-btn" (click)="createOrder()">{{ (i18n.terms$ | async)?.addStandingOrder }}</button>
  </div>

  <div class="filters-section">
    <div class="filter-row">
      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.donorSearchStanding }}</label>
        <input type="text" class="form-control" [placeholder]="(i18n.terms$ | async)?.donorNamePlaceholder">
      </div>
      
      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.statusFilterStanding }}</label>
        <select class="form-control">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option value="active">{{ (i18n.terms$ | async)?.activeStatusStanding }}</option>
          <option value="paused">{{ (i18n.terms$ | async)?.pausedStatus }}</option>
          <option value="cancelled">{{ (i18n.terms$ | async)?.cancelledStatusStanding }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.frequencyFilter }}</label>
        <select class="form-control">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option value="monthly">{{ (i18n.terms$ | async)?.monthlyFrequency }}</option>
          <option value="quarterly">{{ (i18n.terms$ | async)?.quarterlyFrequency }}</option>
          <option value="yearly">{{ (i18n.terms$ | async)?.yearlyFrequency }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label>{{ (i18n.terms$ | async)?.bankFilter }}</label>
        <select class="form-control">
          <option value="">{{ (i18n.terms$ | async)?.everything }}</option>
          <option value="hapoalim">{{ (i18n.terms$ | async)?.hapoalimBank }}</option>
          <option value="leumi">{{ (i18n.terms$ | async)?.leumiBank }}</option>
          <option value="discount">{{ (i18n.terms$ | async)?.discountBank }}</option>
          <option value="mizrahi">{{ (i18n.terms$ | async)?.mizrahiBank }}</option>
        </select>
      </div>
    </div>
  </div>

  <div class="summary-cards">
    <div class="summary-card active-orders">
      <div class="card-icon">‚úÖ</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.activeOrdersCard }}</h3>
        <span class="count">{{activeOrdersCount}}</span>
      </div>
    </div>
    <div class="summary-card monthly-total">
      <div class="card-icon">üí∞</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.monthlyExpectedCard }}</h3>
        <span class="amount">‚Ç™{{totalMonthlyAmount | number}}</span>
      </div>
    </div>
    <div class="summary-card yearly-total">
      <div class="card-icon">üìä</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.yearlyExpectedCard }}</h3>
        <span class="amount">‚Ç™{{totalMonthlyAmount * 12 | number}}</span>
      </div>
    </div>
    <div class="summary-card next-collection">
      <div class="card-icon">‚è∞</div>
      <div class="card-content">
        <h3>{{ (i18n.terms$ | async)?.nextCollectionCard }}</h3>
        <span class="date">{{nextCollectionDate | date:'dd/MM/yyyy'}}</span>
      </div>
    </div>
  </div>

  <div class="orders-table-container">
    <table class="orders-table">
      <thead>
        <tr>
          <th>{{ (i18n.terms$ | async)?.donorColumnStanding }}</th>
          <th>{{ (i18n.terms$ | async)?.amountColumnStanding }}</th>
          <th>{{ (i18n.terms$ | async)?.frequencyColumn }}</th>
          <th>{{ (i18n.terms$ | async)?.nextDateColumn }}</th>
          <th>{{ (i18n.terms$ | async)?.paymentMethodColumn }}</th>
          <th>{{ (i18n.terms$ | async)?.statusColumnStanding }}</th>
          <th>{{ (i18n.terms$ | async)?.startDateColumn }}</th>
          <th>{{ (i18n.terms$ | async)?.lastCollectionColumn }}</th>
          <th>{{ (i18n.terms$ | async)?.actionsColumnStanding }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of standingOrders">
          <td class="donor-col">
            <div class="donor-info">
              <strong>{{getDonorName(order)}}</strong>
              <small>{{order.donor?.phone}}</small>
            </div>
          </td>
          <td class="amount-col">
            <span class="amount">‚Ç™{{order.amount | number}}</span>
          </td>
          <td>
            <span class="frequency-badge frequency-{{order.frequency}}">{{order.frequencyText}}</span>
          </td>
          <td class="next-date-col">
            <span class="next-date" [class.overdue]="order.isOverdue">{{order.nextExecutionDate | date:'dd/MM/yyyy'}}</span>
          </td>
          <td>{{getMethodName(order)}}</td>
          <td>
            <span class="status-badge" [class]="getStatusBadgeClass(order.status)">{{order.statusText}}</span>
          </td>
          <td>{{order.startDate | date:'dd/MM/yyyy'}}</td>
          <td>
            <span>
              {{order.lastExecutionDate | date:'dd/MM/yyyy'}}
            </span>
          </td>
          <td class="actions">
            <button class="btn-icon btn-view" [title]="(i18n.terms$ | async)?.showDetailsAction" (click)="editOrder(order)">üëÅ</button>
            <button class="btn-icon btn-edit" [title]="(i18n.terms$ | async)?.editStandingOrder" (click)="editOrder(order)">‚úè</button>
            <button class="btn-icon btn-collect" [title]="(i18n.terms$ | async)?.executeNow" (click)="executeOrder(order)" *ngIf="order.status === 'active'">üí≥</button>
            <button class="btn-icon btn-pause" [title]="(i18n.terms$ | async)?.pauseOrder" (click)="pauseOrder(order)" *ngIf="order.status === 'active'">‚è∏</button>
            <button class="btn-icon btn-activate" [title]="(i18n.terms$ | async)?.activateOrder" (click)="activateOrder(order)" *ngIf="order.status === 'paused'">‚ñ∂</button>
            <button class="btn-icon btn-cancel" [title]="(i18n.terms$ | async)?.cancelOrder" (click)="cancelOrder(order)">‚ùå</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Collection schedule temporarily disabled
  <div class="collection-schedule">
    <h2>{{ (i18n.terms$ | async)?.nextCollectionSchedule }}</h2>
    <div class="schedule-grid">
      <p>{{ (i18n.terms$ | async)?.collectionScheduleComingSoon }}</p>
    </div>
  </div>
  -->

  <div class="pagination">
    <button class="btn-page">{{ (i18n.terms$ | async)?.previousPage }}</button>
    <span class="page-info">{{ (i18n.terms$ | async)?.pageOf?.replace('{current}', '1')?.replace('{total}', '8') }}</span>
    <button class="btn-page">{{ (i18n.terms$ | async)?.nextPage }}</button>
  </div>
</div>

<!-- ◊û◊ï◊ì◊ú ◊î◊ï◊°◊§◊™ ◊î◊ï◊®◊ê◊™ ◊ß◊ë◊¢ -->
<div class="modal-overlay" *ngIf="showAddOrderModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>{{ (i18n.terms$ | async)?.addStandingOrderModal }}</h2>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.donorSelectStanding }}</label>
          <select class="form-control" [(ngModel)]="editingOrder!.donorId">
            <option value="">{{ (i18n.terms$ | async)?.selectDonorStanding }}</option>
            <option *ngFor="let donor of donors" [value]="donor.id">{{donor.displayName}}</option>
          </select>
        </div>
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.amountFieldStanding }}</label>
          <input type="number" class="form-control" placeholder="0" [(ngModel)]="editingOrder!.amount">
        </div>
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.frequencySelect }}</label>
          <select class="form-control" [(ngModel)]="editingOrder!.frequency">
            <option value="monthly">{{ (i18n.terms$ | async)?.monthlyOption }}</option>
            <option value="quarterly">{{ (i18n.terms$ | async)?.quarterlyOption }}</option>
            <option value="yearly">{{ (i18n.terms$ | async)?.yearlyOption }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.startDateField }}</label>
          <input type="date" class="form-control" [(ngModel)]="editingOrder!.startDate">
        </div>
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.collectionDay }}</label>
          <select class="form-control" [(ngModel)]="editingOrder!.dayOfMonth">
            <option value="1">{{ (i18n.terms$ | async)?.firstOfMonth }}</option>
            <option value="15">{{ (i18n.terms$ | async)?.fifteenthOfMonth }}</option>
            <option value="30">{{ (i18n.terms$ | async)?.lastOfMonth }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.paymentMethodSelect }}</label>
          <select class="form-control" [(ngModel)]="editingOrder!.donationMethodId">
            <option value="">{{ (i18n.terms$ | async)?.selectPaymentMethod }}</option>
            <option *ngFor="let method of donationMethods" [value]="method.id">{{method.name}}</option>
          </select>
        </div>
        <div class="form-group">
          <label>{{ (i18n.terms$ | async)?.campaignSelectStanding }}</label>
          <select class="form-control" [(ngModel)]="editingOrder!.campaignId">
            <option value="">{{ (i18n.terms$ | async)?.selectCampaignStanding }}</option>
            <option *ngFor="let campaign of campaigns" [value]="campaign.id">{{campaign.name}}</option>
          </select>
        </div>
        <div class="form-group full-width">
          <label>{{ (i18n.terms$ | async)?.standingOrderNotes }}</label>
          <textarea class="form-control" rows="3" [placeholder]="(i18n.terms$ | async)?.enterNotesStanding" [(ngModel)]="editingOrder!.notes"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">{{ (i18n.terms$ | async)?.cancel }}</button>
      <button class="btn btn-primary" (click)="saveOrder()">{{ (i18n.terms$ | async)?.saveStandingOrder }}</button>
    </div>
  </div>
</div>
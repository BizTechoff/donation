<!-- Campaign Details Modal -->
<div *ngIf="!this.loading" class="modal-overlay" (click)="closeModal($event)">
  <div class="modal-content campaign-details-modal" (click)="$event.stopPropagation()">

    <!-- Modal Header with gradient and icon -->
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>{{isNewCampaign ? 'add_circle' : 'campaign'}}</mat-icon>
        </div>
        <div class="header-text">
          <h2>{{isNewCampaign ? (i18n.terms$ | async)?.createNewCampaignTitle : (i18n.terms$ |
            async)?.campaignDetailsTitle}}</h2>
          <p class="header-subtitle" *ngIf="!isNewCampaign && campaign">
            {{campaign.name}}
          </p>
        </div>
      </div>
      <button class="modal-close" (click)="closeModal()" [matTooltip]="(i18n.terms$ | async)?.closeButton"
        [dir]="'rtl'">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="loading-spinner">{{ (i18n.terms$ | async)?.loadingData }}</div>
    </div>

    <div class="modal-body">
      <div class="details-grid" *ngIf="campaign && !loading">

        <!-- Status Display -->
        <div class="section status-section" *ngIf="!isNewCampaign">
          <h3>{{ (i18n.terms$ | async)?.campaignStatusSection }}</h3>
          <div class="status-display">
            <!-- <div class="status-badge" [class.draft]="isDraft" [class.active]="isActive" [class.completed]="isCompleted"
              [class.cancelled]="isCancelled">
              <mat-icon>{{isDraft ? 'edit' : isActive ? 'play_circle' : isCompleted ? 'check_circle' :
                'cancel'}}</mat-icon>
              <span>{{isDraft ? (i18n.terms$ | async)?.draftStatusBadge : isActive ? (i18n.terms$ |
                async)?.activeStatusBadge : isCompleted ? (i18n.terms$ | async)?.completedStatusBadge : (i18n.terms$ |
                async)?.cancelledStatusBadge}}</span>
            </div> -->
            <div class="progress-info" *ngIf="campaign.targetAmount > 0">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="campaign.progressPercentage"></div>
              </div>
              <span class="progress-text">{{campaign.progressPercentage}}% ({{campaign.raisedAmount}} /
                {{campaign.targetAmount}} {{campaign.currency}})</span>
            </div>
          </div>
        </div>

        <!-- סוג קמפיין -->
        <div class="section campaign-type-section">
          <h3>{{ (i18n.terms$ | async)?.campaignTypeSection }}</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="campaign-type-selector">
                <div class="campaign-type-option" [class.active]="campaign.campaignType === 'רגיל'">
                  <label class="campaign-type-card">
                    <input type="radio" name="campaignType" value="רגיל" [(ngModel)]="campaign.campaignType"
                      [disabled]="!canEdit" (ngModelChange)="markAsChanged()" class="campaign-type-radio">
                    <div class="campaign-type-content">
                      <mat-icon class="campaign-type-icon">campaign</mat-icon>
                      <div class="campaign-type-text">
                        <span class="campaign-type-label">{{ (i18n.terms$ | async)?.regularCampaignType }}</span>
                        <!-- <span class="campaign-type-description">קמפיין גיוס כספים סטנדרטי</span> -->
                      </div>
                    </div>
                  </label>
                </div>

                <div class="campaign-type-option" [class.active]="campaign.campaignType === 'דינער'">
                  <label class="campaign-type-card">
                    <input type="radio" name="campaignType" value="דינער" [(ngModel)]="campaign.campaignType"
                      [disabled]="!canEdit" (ngModelChange)="markAsChanged()" class="campaign-type-radio">
                    <div class="campaign-type-content">
                      <mat-icon class="campaign-type-icon">restaurant</mat-icon>
                      <div class="campaign-type-text">
                        <span class="campaign-type-label">{{ (i18n.terms$ | async)?.dinnerCampaignType }}</span>
                        <!-- <span class="campaign-type-description">אירוע גיוס כספים חגיגי</span> -->
                      </div>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Basic Campaign Information -->
        <div class="section basic-details">
          <h3>{{ (i18n.terms$ | async)?.basicCampaignInfoSection }}</h3>
          <div class="form-grid">

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">title</mat-icon>
                <label>{{ (i18n.terms$ | async)?.campaignNameLabel }}</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="campaign.name" [disabled]="!canEdit"
                [placeholder]="(i18n.terms$ | async)?.campaignNamePlaceholder" (ngModelChange)="markAsChanged()">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">place</mat-icon>
                <label>{{ (i18n.terms$ | async)?.eventLocationLabel }}</label>
              </div>
              <app-osm-address-input [label]="(i18n.terms$ | async)?.eventLocationLabel || 'מיקום האירוע'"
                [placeholder]="(i18n.terms$ | async)?.eventLocationPlaceholder || 'הקלד מיקום האירוע...'"
                countryCode="il" [disabled]="!canEdit" [(place)]="campaign.eventLocation"
                (placeChange)="onEventPlaceSelected($event)">
              </app-osm-address-input>
            </div>

          </div>

            <h4></h4>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">description</mat-icon>
                <label>{{ (i18n.terms$ | async)?.descriptionLabel }}</label>
              </div>
              <textarea class="form-control" [(ngModel)]="campaign.description" [disabled]="!canEdit"
                [placeholder]="(i18n.terms$ | async)?.descriptionPlaceholder" rows="3"
                (ngModelChange)="markAsChanged()"></textarea>
            </div>

          </div>
        </div>

        <!-- Financial Information -->
        <div class="section financial-details">
          <h3>{{ (i18n.terms$ | async)?.financialInfoSection }}</h3>
          <div class="form-grid">
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">attach_money</mat-icon>
                <label>{{ (i18n.terms$ | async)?.targetAmountLabel }}</label>
              </div>
              <input type="number" class="form-control" [(ngModel)]="campaign.targetAmount" [disabled]="!canEdit"
                [placeholder]="(i18n.terms$ | async)?.targetAmountPlaceholder" min="0" step="0.01"
                (ngModelChange)="markAsChanged()">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">monetization_on</mat-icon>
                <label>{{ (i18n.terms$ | async)?.currencyLabel }}</label>
              </div>
              <select class="form-control" [(ngModel)]="campaign.currency" [disabled]="!canEdit"
                (ngModelChange)="markAsChanged()">
                <!-- עיקריים -->
                <option value="ILS">{{ (i18n.terms$ | async)?.shekelILS }}</option>
                <option value="USD">{{ (i18n.terms$ | async)?.dollarUSD }}</option>
                <option value="EUR">{{ (i18n.terms$ | async)?.euroEUR }}</option>
                <option value="GBP">{{ (i18n.terms$ | async)?.poundGBP }}</option>
                <option value="CAD">{{ (i18n.terms$ | async)?.dollarCAD }}</option>
                <option value="AUD">{{ (i18n.terms$ | async)?.dollarAUD }}</option>

                <!-- אירופה -->
                <option value="CHF">פרנק שוויצרי (CHF)</option>
                <option value="NOK">כתר נורווגי (NOK)</option>
                <option value="SEK">כתר שוודי (SEK)</option>
                <option value="DKK">כתר דני (DKK)</option>
                <option value="ISK">כתר איסלנדי (ISK)</option>
                <option value="CZK">כתר צ'כי (CZK)</option>
                <option value="PLN">זלוטי פולני (PLN)</option>
                <option value="HUF">פורינט הונגרי (HUF)</option>
                <option value="RON">לאו רומני (RON)</option>
                <option value="BGN">לב בולגרי (BGN)</option>
                <option value="HRK">קונה קרואטית (HRK)</option>
                <option value="RSD">דינר סרבי (RSD)</option>
                <option value="BAM">מארק בוסני (BAM)</option>
                <option value="MKD">דינר מקדוני (MKD)</option>
                <option value="ALL">לק אלבני (ALL)</option>
                <option value="MDL">לאו מולדובי (MDL)</option>
                <option value="UAH">הריבניה אוקראינית (UAH)</option>
                <option value="BYN">רובל בלארוסי (BYN)</option>
                <option value="RUB">רובל רוסי (RUB)</option>
                <option value="TRY">לירה טורקית (TRY)</option>

                <!-- אסיה-פסיפיק -->
                <option value="NZD">דולר ניו-זילנדי (NZD)</option>
                <option value="JPY">ין יפני (JPY)</option>
                <option value="CNY">יואן סיני (CNY)</option>
                <option value="INR">רופי הודי (INR)</option>
                <option value="SGD">דולר סינגפורי (SGD)</option>
                <option value="HKD">דולר הונג קונגי (HKD)</option>
                <option value="MYR">רינגיט מלזי (MYR)</option>
                <option value="THB">בהט תאילנדי (THB)</option>
                <option value="IDR">רופיה אינדונזית (IDR)</option>
                <option value="PHP">פסו פיליפיני (PHP)</option>
                <option value="VND">דונג וייטנאמי (VND)</option>
                <option value="KRW">וון דרום קוריאני (KRW)</option>
                <option value="TWD">דולר טאיוואני (TWD)</option>
                <option value="PKR">רופי פקיסטני (PKR)</option>
                <option value="BDT">טקה בנגלדשי (BDT)</option>
                <option value="LKR">רופי סרי לנקי (LKR)</option>
                <option value="NPR">רופי נפאלי (NPR)</option>
                <option value="MMK">קיאט בורמזי (MMK)</option>
                <option value="KHR">ריאל קמבודי (KHR)</option>
                <option value="LAK">קיפ לאוסי (LAK)</option>
                <option value="MOP">פטקה מקאו (MOP)</option>
                <option value="BND">דולר ברוניי (BND)</option>
                <option value="KZT">טנגה קזחסטני (KZT)</option>
                <option value="UZS">סום אוזבקי (UZS)</option>
                <option value="KGS">סום קירגיזי (KGS)</option>
                <option value="TJS">סומוני טג'יקי (TJS)</option>
                <option value="TMT">מאנאט טורקמני (TMT)</option>
                <option value="MNT">טוגריק מונגולי (MNT)</option>
                <option value="GEL">לארי גאורגי (GEL)</option>
                <option value="AMD">דראם ארמני (AMD)</option>
                <option value="AZN">מאנאט אזרי (AZN)</option>

                <!-- מזרח תיכון -->
                <option value="AED">דירהם אמירויות (AED)</option>
                <option value="SAR">ריאל סעודי (SAR)</option>
                <option value="QAR">ריאל קטארי (QAR)</option>
                <option value="KWD">דינר כוויתי (KWD)</option>
                <option value="BHD">דינר בחרייני (BHD)</option>
                <option value="OMR">ריאל עומאני (OMR)</option>
                <option value="JOD">דינר ירדני (JOD)</option>
                <option value="LBP">לירה לבנונית (LBP)</option>
                <option value="IQD">דינר עיראקי (IQD)</option>
                <option value="EGP">לירה מצרית (EGP)</option>

                <!-- אפריקה -->
                <option value="ZAR">ראנד דרום אפריקאי (ZAR)</option>
                <option value="NGN">ניירה ניגרית (NGN)</option>
                <option value="KES">שילינג קנייתי (KES)</option>
                <option value="GHS">סדי גאני (GHS)</option>
                <option value="UGX">שילינג אוגנדי (UGX)</option>
                <option value="TZS">שילינג טנזני (TZS)</option>
                <option value="ETB">ביר אתיופי (ETB)</option>
                <option value="MAD">דירהם מרוקאי (MAD)</option>
                <option value="TND">דינר תוניסאי (TND)</option>
                <option value="DZD">דינר אלג'יראי (DZD)</option>
                <option value="XAF">פרנק מרכז אפריקה (XAF)</option>
                <option value="XOF">פרנק מערב אפריקה (XOF)</option>
                <option value="ZMW">קוואצ'ה זמבי (ZMW)</option>
                <option value="BWP">פולה בוצוואנית (BWP)</option>
                <option value="MUR">רופי מאוריציוס (MUR)</option>
                <option value="NAD">דולר נמיבי (NAD)</option>

                <!-- אמריקה הלטינית -->
                <option value="BRL">ריאל ברזילאי (BRL)</option>
                <option value="MXN">פסו מקסיקני (MXN)</option>
                <option value="ARS">פסו ארגנטינאי (ARS)</option>
                <option value="CLP">פסו צ'ילאני (CLP)</option>
                <option value="COP">פסו קולומביאני (COP)</option>
                <option value="PEN">סול פרואני (PEN)</option>
                <option value="UYU">פסו אורוגוואי (UYU)</option>
                <option value="PYG">גואראני פרגוואי (PYG)</option>
                <option value="BOB">בוליביאנו (BOB)</option>
                <option value="CRC">קולון קוסטה ריקה (CRC)</option>
                <option value="GTQ">קצאל גואטמלה (GTQ)</option>
                <option value="PAB">בלבואה פנמה (PAB)</option>
                <option value="HNL">למפירה הונדורס (HNL)</option>
                <option value="NIO">קורדובה ניקרגואה (NIO)</option>

                <!-- קריביים -->
                <option value="JMD">דולר ג'מייקני (JMD)</option>
                <option value="TTD">דולר טרינידד וטובגו (TTD)</option>
                <option value="BBD">דולר ברבדוס (BBD)</option>
                <option value="BSD">דולר בהאמס (BSD)</option>
                <option value="XCD">דולר קריבי מזרחי (XCD)</option>
                <option value="BZD">דולר בליז (BZD)</option>
                <option value="KYD">דולר איי קיימן (KYD)</option>
              </select>
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">payment</mat-icon>
                <label>{{ (i18n.terms$ | async)?.standardDonationLabel }}</label>
              </div>
              <input type="number" class="form-control" [(ngModel)]="campaign.defaultDonationAmount"
                [disabled]="!canEdit" [placeholder]="(i18n.terms$ | async)?.standardDonationPlaceholder" min="0"
                step="1" (ngModelChange)="markAsChanged()">
            </div>

            <!-- <div class="form-group" *ngIf="!isNewCampaign">
              <div class="field-title">
                <mat-icon class="field-icon">savings</mat-icon>
                <label>{{ (i18n.terms$ | async)?.raisedAmountLabel }}</label>
              </div>
              <input type="number" class="form-control" [value]="campaign.raisedAmount" disabled
                [placeholder]="(i18n.terms$ | async)?.raisedAmountPlaceholder" step="0.01">
            </div>

            <div class="form-group" *ngIf="!isNewCampaign">
              <div class="field-title">
                <mat-icon class="field-icon">trending_up</mat-icon>
                <label>{{ (i18n.terms$ | async)?.completionPercentageLabel }}</label>
              </div>
              <input type="text" class="form-control" [value]="campaign.progressPercentage + '%'" disabled>
            </div> -->

          </div>
        </div>

        <!-- Dates Information -->
        <div class="section dates-details">
          <h3>{{ (i18n.terms$ | async)?.datesSection }}</h3>
          <div class="form-grid">
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">event</mat-icon>
                <label>{{ (i18n.terms$ | async)?.startDateLabel }}</label>
              </div>
              <app-modern-dual-date-picker [(ngModel)]="campaign.startDate" [disabled]="!canEdit" [compact]="false"
                [calendar_open_heb_and_eng_parallel]="true" (dateChange)="markAsChanged()">
              </app-modern-dual-date-picker>
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">event_available</mat-icon>
                <label>{{ (i18n.terms$ | async)?.endDateLabel }}</label>
              </div>
              <app-modern-dual-date-picker [(ngModel)]="campaign.endDate" [disabled]="!canEdit" [compact]="false"
                [calendar_open_heb_and_eng_parallel]="true" (dateChange)="markAsChanged()">
              </app-modern-dual-date-picker>
            </div>
          </div>
        </div>

        <!-- Settings -->
        <div class="section settings-details">
          <h3>{{ (i18n.terms$ | async)?.settingsSection }}</h3>
          <div class="form-grid">

            <!-- <div class="form-group checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="campaign.isPublic"
                       [disabled]="!canEdit" (ngModelChange)="markAsChanged()">
                <mat-icon class="checkbox-icon">{{campaign.isPublic ? 'check_box' : 'check_box_outline_blank'}}</mat-icon>
                <span>{{ (i18n.terms$ | async)?.displayOnWebsiteLabel }}</span>
              </label>
            </div> -->

            <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">link</mat-icon>
                <label>{{ (i18n.terms$ | async)?.dinnerInvitationLinkLabel }}</label>
              </div>
              <input type="url" class="form-control" [(ngModel)]="campaign.websiteUrl" [disabled]="!canEdit"
                placeholder="https://example.com" (ngModelChange)="markAsChanged()">
            </div>

            <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">image</mat-icon>
                <label>{{ (i18n.terms$ | async)?.dinnerBlessingBookLinkLabel }}</label>
              </div>
              <input type="url" class="form-control" [(ngModel)]="campaign.imageUrl" [disabled]="!canEdit"
                placeholder="https://example.com/image.jpg" (ngModelChange)="markAsChanged()">
            </div>

            <!-- <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">notes</mat-icon>
                <label>{{ (i18n.terms$ | async)?.internalNotesLabel }}</label>
              </div>
              <textarea class="form-control" [(ngModel)]="campaign.internalNotes"
                        [disabled]="!canEdit" [placeholder]="(i18n.terms$ | async)?.internalNotesPlaceholder" rows="3"
                        (ngModelChange)="markAsChanged()"></textarea>
            </div> -->
          </div>
        </div>

      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      

      <div class="footer-actions-right">
        <button mat-raised-button color="primary" *ngIf="!isNewCampaign" (click)="openNewDonation()"
          class="action-button new-donation-button">
          <mat-icon>add_circle</mat-icon>
          {{ (i18n.terms$ | async)?.newDonationButton }}
        </button>

        <div class="footer-divider" *ngIf="!isNewCampaign"></div>

        <button mat-raised-button color="accent" *ngIf="campaign.campaignType === 'דינער'" (click)="openInvitedList()"
          class="action-button invited-list-button">
          <mat-icon>list_alt</mat-icon>
          {{ (i18n.terms$ | async)?.invitedListButton }}
        </button>

        <button mat-raised-button color="primary" *ngIf="campaign.campaignType === 'דינער'" (click)="openBlessingBook()"
          class="action-button blessing-book-button">
          <mat-icon>menu_book</mat-icon>
          {{ (i18n.terms$ | async)?.blessingBookButton }}
        </button>
        <!-- <div class="footer-divider" *ngIf="!isNewCampaign"></div> -->
      </div>


      <div class="footer-actions-right">
        <!-- <button mat-stroked-button color="warn" *ngIf="!isNewCampaign" (click)="deleteCampaign()" class="action-button">
          <mat-icon>delete</mat-icon>
          {{ (i18n.terms$ | async)?.deleteCampaignButton }}
        </button> -->

        <button mat-stroked-button (click)="closeModal()" class="cancel-button">
          <mat-icon>close</mat-icon>
          {{ (i18n.terms$ | async)?.cancelButton }}
        </button>
        <button mat-raised-button color="primary" (click)="saveCampaign()" class="save-button" [disabled]="loading">
          <mat-icon>save</mat-icon>
          {{ (i18n.terms$ | async)?.saveCampaignButton }}
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Don;tion Details Modal -->
<div class="donation-details-modal">

  <!-- Modal Header with gradient and icon -->
  <div class="modal-header">
    <div class="header-content">
      <div class="header-icon">
        <mat-icon>{{isNewDonation ? 'add_circle' : 'attach_money'}}</mat-icon>
      </div>
      <div class="header-text">
        <h2>{{isNewDonation ? i18n.terms.newDonation : i18n.terms.donationDetails}}</h2>
        <p class="header-subtitle" *ngIf="!isNewDonation && donation">
          {{getDonorDisplayName(selectedDonor)}}
        </p>
      </div>
    </div>
    <button class="modal-close" (click)="closeModal()" [matTooltip]="i18n.terms.close" [dir]="'rtl'">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Section Navigation -->
  <div class="section-navigation" *ngIf="!isNewDonation">
    <button class="nav-btn" (click)="scrollToSection('section-donor-payment')"
      [title]="i18n.terms.donorAndPaymentDetails || 'תורם ותשלום'">
      <mat-icon>person</mat-icon>
      <span>{{ i18n.terms.donor || 'תורם' }}</span>
    </button>
    <button class="nav-btn" (click)="scrollToSection('section-donation-type')"
      [title]="i18n.terms.donationType || 'סוג תרומה'">
      <mat-icon>category</mat-icon>
      <span>{{ i18n.terms.donationType || 'סוג' }}</span>
    </button>
    <button class="nav-btn" (click)="scrollToSection('section-basic-details')"
      [title]="i18n.terms.basicDonationDetails || 'פרטים בסיסיים'">
      <mat-icon>info</mat-icon>
      <span>{{ i18n.terms.details || 'פרטים' }}</span>
    </button>
    <button class="nav-btn" (click)="scrollToSection('section-payment-method')"
      *ngIf="donation?.donationType !== 'commitment'" [title]="i18n.terms.paymentMethod || 'אמצעי תשלום'">
      <mat-icon>payment</mat-icon>
      <span>{{ i18n.terms.payment || 'תשלום' }}</span>
    </button>
    <button class="nav-btn" (click)="scrollToSection('section-partners')"
      [title]="i18n.terms.donationPartners || 'שותפים'">
      <mat-icon>group</mat-icon>
      <span>{{ i18n.terms.partners || 'שותפים' }}</span>
    </button>
    <button class="nav-btn" (click)="scrollToSection('section-notes')" [title]="i18n.terms.notes || 'הערות'">
      <mat-icon>note</mat-icon>
      <span>{{ i18n.terms.notes || 'הערות' }}</span>
    </button>
    <button class="nav-btn" (click)="scrollToSection('section-files')" *ngIf="!isNewDonation"
      [title]="i18n.terms.attachedFiles || 'קבצים'">
      <mat-icon>attach_file</mat-icon>
      <span>{{ i18n.terms.files || 'קבצים' }}</span>
    </button>
  </div>

  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-spinner">{{i18n.terms.loadingData}}</div>
  </div>

  <div class="modal-body">
    <div class="details-grid" *ngIf="donation && !loading">



      <!-- פרטי תורם ותשלום -->
      <div id="section-donor-payment" class="section donor-payment-section">
        <h3>{{i18n.terms.donorAndPaymentDetails}}</h3>
        <div class="form-grid">
          <div class="form-group">
            <div class="field-title">
              <mat-icon class="field-icon">person</mat-icon>
              <label>{{i18n.terms.donor}} *</label>
            </div>
            <div class="input-with-icon">
              <input type="text" class="form-control"
                     [value]="selectedDonor ? getDonorDisplayName(selectedDonor) : ''"
                     [placeholder]="i18n.terms.selectDonor"
                     readonly
                     (click)="openDonorSelectionModal()">
              <button mat-icon-button class="edit-icon-btn search-icon-btn"
                (click)="openDonorSelectionModal()" [matTooltip]="'חפש תורם'"
                type="button">
                <mat-icon>search</mat-icon>
              </button>
              <button mat-icon-button class="edit-icon-btn" [class.active]="donation.donorId"
                [disabled]="!donation.donorId" (click)="openDonorDetails()" [matTooltip]="i18n.terms.openDonorDetails"
                type="button">
                <mat-icon>person</mat-icon>
              </button>
            </div>
          </div>

          <div class="form-group">
            <div class="field-title">
              <mat-icon class="field-icon">campaign</mat-icon>
              <label>{{i18n.terms.campaign}}</label>
            </div>
            <select class="form-control" [(ngModel)]="donation.campaignId" (change)="onCampaignChange()">
              <option value="">{{i18n.terms.noCampaignOption}}</option>
              <option *ngFor="let campaign of campaigns" [value]="campaign.id">
                {{ campaign.name }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- סוג תרומה -->
      <div id="section-donation-type" class="section donation-type-section">
        <h3>{{i18n.terms.donationType}}</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <div class="donation-type-selector">
              <div class="donation-type-option" [class.active]="donation.donationType === 'full'">
                <label class="donation-type-card">
                  <input type="radio" name="donationType" value="full" [(ngModel)]="donation.donationType"
                    class="donation-type-radio">
                  <div class="donation-type-content">
                    <mat-icon class="donation-type-icon">payments</mat-icon>
                    <div class="donation-type-text">
                      <span class="donation-type-label">{{i18n.terms.fullDonation}}</span>
                      <!-- <span class="donation-type-description">תשלום מלא ומיידי</span> -->
                    </div>
                  </div>
                </label>
              </div>

              <div class="donation-type-option" [class.active]="donation.donationType === 'commitment'">
                <label class="donation-type-card">
                  <input type="radio" name="donationType" value="commitment" [(ngModel)]="donation.donationType"
                    class="donation-type-radio">
                  <div class="donation-type-content">
                    <mat-icon class="donation-type-icon">handshake</mat-icon>
                    <div class="donation-type-text">
                      <span class="donation-type-label">{{i18n.terms.commitment}}</span>
                      <!-- <span class="donation-type-description">הבטחה לתשלום בעתיד</span> -->
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- פרטי תרומה בסיסיים -->
      <div id="section-basic-details" class="section basic-details">
        <h3>{{i18n.terms.basicDonationDetails}}</h3>

        <div class="form-grid">
          <div class="form-group full-width">
            <div class="field-title">
              <mat-icon class="field-icon">event</mat-icon>
              <label>{{i18n.terms.donationDateLabel}}</label>
            </div>
            <app-modern-dual-date-picker [(ngModel)]="donation.donationDate" [disabled]="false" [compact]="false"
              [calendar_open_heb_and_eng_parallel]="true" (dateChange)="changed = true">
            </app-modern-dual-date-picker>
          </div>
        </div>

        <h4></h4>

        <div class="form-grid">
          <div class="form-group">
            <div class="field-title">
              <mat-icon class="field-icon">attach_money</mat-icon>
              <label>{{i18n.terms.amount}} *</label>
            </div>
            <input type="number" class="form-control" [(ngModel)]="donation.amount"
              [placeholder]="i18n.terms.enterAmount" min="0" step="0.01">
          </div>

          <div class="form-group">
            <div class="field-title">
              <mat-icon class="field-icon">monetization_on</mat-icon>
              <label>{{i18n.terms.currency}}</label>
            </div>
            <select class="form-control" [(ngModel)]="donation.currency">
              <option *ngFor="let currency of currencyTypes" [value]="currency.id">
                {{ currency.label }}
              </option>
            </select>
          </div>



          <div class="form-group">
            <div class="field-title">
              <mat-icon class="field-icon">help</mat-icon>
              <label>{{i18n.terms.reason}}</label>
            </div>
            <input type="text" class="form-control" [(ngModel)]="donation.reason"
              [placeholder]="i18n.terms.enterReason">
          </div>

          <!-- <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">support_agent</mat-icon>
                <label>{{i18n.terms.fundraiser}}</label>
              </div>
              <select class="form-control" [(ngModel)]="donation.fundraiserId" (change)="onFundraiserChange()">
                <option value="">{{i18n.terms.selectFundraiser}}</option>
                <option *ngFor="let fundraiser of fundraisers" [value]="fundraiser.id">
                  {{ getFundraiserDisplayName(fundraiser) }}
                </option>
              </select>
            </div> -->
        </div>

        <div class="form-grid">
          <!-- <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">info</mat-icon>
                <label>סטטוס תרומה *</label>
              </div>
              <select class="form-control" [(ngModel)]="donation.status">
                <option value="pending">ממתין</option>
                <option value="completed">הושלם</option>
                <option value="cancelled">בוטל</option>
              </select>
            </div> -->

        </div>
      </div>


      <!-- אמצעי תשלום -->
      <div id="section-payment-method" class="section payment-method-section"
        *ngIf="donation.donationType !== 'commitment'">
        <h3>{{i18n.terms.paymentMethod}}</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <div class="payment-method-selector">
              <div class="payment-method-option" *ngFor="let method of donationMethods"
                [class.active]="donation.donationMethodId === method.id">
                <label class="payment-method-card">
                  <input type="radio" name="paymentMethod" [value]="method.id" [(ngModel)]="donation.donationMethodId"
                    (change)="onPaymentMethodChange()" class="payment-method-radio">
                  <div class="payment-method-content">
                    <mat-icon class="payment-method-icon">payment</mat-icon>
                    <div class="payment-method-text">
                      <span class="payment-method-label">{{ method.name }}</span>
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="payment-sep"></div>

        <!-- Standing Order Type Selection -->
        <div class="form-grid" *ngIf="isStandingOrderPayment">
          <div class="form-group full-width">
            <div class="field-title">
              <mat-icon class="field-icon">payment</mat-icon>
              <label>{{ (i18n.terms$ | async)?.standingOrderTypeLabel }}</label>
            </div>
            <div class="standing-order-type-selector">
              <label class="radio-option">
                <input type="radio" name="standingOrderType" value="bank" [(ngModel)]="donation.standingOrderType">
                <span>{{ (i18n.terms$ | async)?.bankStandingOrder }}</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="standingOrderType" value="creditCard"
                  [(ngModel)]="donation.standingOrderType">
                <span>{{ (i18n.terms$ | async)?.creditCardStandingOrder }}</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="standingOrderType" value="organization"
                  [(ngModel)]="donation.standingOrderType">
                <span>{{ (i18n.terms$ | async)?.organizationStandingOrder }}</span>
              </label>
            </div>
          </div>
        </div>

        <div class="payment-sep-half"></div>

        <div class="form-grid">

          <!-- קבועים -->

          <div class="form-group">
            <div class="field-title">
              <mat-icon class="field-icon">person</mat-icon>
              <label>שם משלם</label>
            </div>
            <select class="form-control" [(ngModel)]="donation.payerName">
              <option value="">{{ (i18n.terms$ | async)?.selectPayerOption || 'בחר משלם' }}</option>
              <option *ngFor="let option of payerOptions" [value]="option.value">{{ option.label }}</option>
            </select>
          </div>

          <div class="form-group">
            <div class="field-title">
              <mat-icon class="field-icon">receipt</mat-icon>
              <label>אסמכתא</label>
            </div>
            <input type="text" class="form-control" [(ngModel)]="donation.referenceNumber" placeholder="אסמכתא">
          </div>

          <!-- Check Payment Fields -->
          <div class="form-group" *ngIf="isCheckPayment">
            <div class="field-title">
              <mat-icon class="field-icon">tag</mat-icon>
              <label>{{i18n.terms.checkNumber}}</label>
            </div>
            <input type="text" class="form-control" [(ngModel)]="donation.checkNumber"
              [placeholder]="i18n.terms.checkNumberPlaceholder">
          </div>

          <div class="form-group" *ngIf="isOrganizationPayment || (isStandingOrderPayment && donation.standingOrderType === 'organization')">
            <div class="field-title">
              <mat-icon class="field-icon">tag</mat-icon>
              <label>{{i18n.terms.voucherNumber}}</label>
            </div>
            <input type="text" class="form-control" [(ngModel)]="donation.voucherNumber"
              [placeholder]="i18n.terms.voucherNumberPlaceholder">
          </div>

          <!-- Credit Card Fields -->
          <div class="form-group"
            *ngIf="isCreditCardPayment || (isStandingOrderPayment && donation.standingOrderType === 'creditCard')">
            <div class="field-title">
              <mat-icon class="field-icon">numbers</mat-icon>
              <label>4 ספרות אחרונות</label>
            </div>
            <input type="text" class="form-control" [(ngModel)]="donation.cardNumber" maxlength="4"
              [placeholder]="'4 ספרות אחרונות'">
          </div>

          <div class="form-group"
            *ngIf="isCreditCardPayment || (isStandingOrderPayment && donation.standingOrderType === 'creditCard')">
            <div class="field-title">
              <mat-icon class="field-icon">date_range</mat-icon>
              <label>תוקף (MM/YY)</label>
            </div>
            <input type="text" class="form-control" [(ngModel)]="donation.cardExpiry" maxlength="5" placeholder="MM/YY">
          </div>


          <div class="form-group"
            *ngIf="isOrganizationPayment || (isStandingOrderPayment && donation.standingOrderType === 'organization')">
            <div class="field-title">
              <mat-icon class="field-icon">business</mat-icon>
              <label>{{ (i18n.terms$ | async)?.selectOrganizationLabel || 'בחירת עמותה' }}</label>
              <button class="field-add-btn" *ngIf="donationOrganizations.length === 0"
                (click)="addOrganizationToDonation()" [title]="i18n.terms.addNewOrganization">
                <mat-icon>add</mat-icon>
              </button>
            </div>

            <!-- Donation Organizations List -->
            <div class="entity-list">
              <div class="entity-item" *ngFor="let donationOrganization of donationOrganizations">
                <span class="entity-name" (click)="viewOrganizationDetails(donationOrganization.organizationId)"
                  title="לחץ לצפייה בפרטי העמותה">
                  {{ donationOrganization.organization?.name || 'עמותה לא ידועה' }}
                </span>
                <button mat-icon-button class="delete-btn" (click)="removeDonationOrganization(donationOrganization)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>


          <div class="form-group"
            *ngIf="isTransferPayment || (isStandingOrderPayment && donation.standingOrderType === 'bank')">
            <div class="field-title">
              <mat-icon class="field-icon">account_balance</mat-icon>
              <label>{{ (i18n.terms$ | async)?.selectBankLabel || 'בחירת בנק' }}</label>
              <button class="field-add-btn" *ngIf="donationBanks.length === 0" (click)="addNewBank()"
                [title]="i18n.terms.addNewBank">
                <mat-icon>add</mat-icon>
              </button>
            </div>

            <div class="entity-list">
              <div class="entity-item" *ngFor="let donationBank of donationBanks">
                <span class="entity-name" (click)="viewBankDetails(donationBank.bankId)" title="לחץ לצפייה בפרטי הבנק">
                  {{ donationBank.bank?.name || 'בנק לא ידוע' }}
                </span>
                <button mat-icon-button class="delete-btn" (click)="removeDonationBank(donationBank)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>

          </div>


        </div>

        <div class="payment-sep-half"></div>

        <div class="form-grid" *ngIf="isStandingOrderPayment">

        <div *ngIf="isStandingOrderPayment" class="form-group">
          <div class="field-title">
            <mat-icon class="field-icon">schedule</mat-icon>
            <label>{{i18n.terms.frequency}}</label>
          </div>
          <select class="form-control" [(ngModel)]="donation.frequency">
            <option value="weekly">{{i18n.terms.weekly}}</option>
            <option value="monthly">{{i18n.terms.monthly}}</option>
            <!-- <option value="quarterly">{{i18n.terms.quarterly}}</option>
                  <option value="yearly">{{i18n.terms.yearly}}</option> -->
          </select>
        </div>

        <!-- Day selection based on frequency -->
          <div class="form-group" *ngIf="isStandingOrderPayment && (donation.frequency === 'monthly')">
            <div class="field-title">
              <mat-icon class="field-icon">today</mat-icon>
              <label>{{i18n.terms.dayOfMonth}}</label>
            </div>
            <select class="form-control" [(ngModel)]="donation.dayOfMonth">
              <option value="">{{i18n.terms.selectDay}}</option>
              <option *ngFor="let day of getDaysOfMonth()" [value]="day">{{ day }}</option>
            </select>
          </div>

          <div class="form-group" *ngIf="isStandingOrderPayment && donation.frequency === 'weekly'">
            <div class="field-title">
              <mat-icon class="field-icon">calendar_view_week</mat-icon>
              <label>{{i18n.terms.dayOfWeek}}</label>
            </div>
            <select class="form-control" [(ngModel)]="donation.dayOfWeek">
              <option value="">{{i18n.terms.selectDay}}</option>
              <option *ngFor="let day of getDaysOfWeek()" [value]="day.value">{{ day.name }}</option>
            </select>
          </div>
        </div>

        <div class="payment-sep-half"></div>
        
        <!-- Number of Payments Section -->
        <div class="form-grid" *ngIf="isStandingOrderPayment">
          <div class="form-group full-width">
            <div class="field-title">
              <mat-icon class="field-icon">repeat</mat-icon>
              <label>{{ (i18n.terms$ | async)?.numberOfPaymentsLabel }}</label>
            </div>
            <div class="payment-count-selector">
              <label class="checkbox-option">
                <input type="checkbox" [(ngModel)]="donation.unlimitedPayments" (change)="onUnlimitedPaymentsChange()">
                <span>{{ (i18n.terms$ | async)?.unlimitedPayments }}</span>
              </label>
              <div class="payment-count-input-wrapper">
                <div class="payment-count-input" *ngIf="!donation.unlimitedPayments">
                  <input type="number" class="form-control" [(ngModel)]="donation.numberOfPayments" min="1"
                    [placeholder]="(i18n.terms$ | async)?.paymentsCount">
                </div>
                <div class="payment-amount-display" *ngIf="getPaymentAmount()">
                  <span class="payment-amount-label">כל תשלום:</span>
                  <span class="payment-amount-value">{{ getPaymentAmount() }} {{ getCurrencySymbol(donation.currency)
                    }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ---------------------- -->

      </div>

      <!-- שותפים לתרומה -->
      <div id="section-partners" class="section partners-section">
        <h3>
          <mat-icon class="section-icon">group</mat-icon>
          {{i18n.terms.donationPartners}}
          <button class="add-btn" (click)="addNewPartner()" title="הוסף שותף">
            <mat-icon>add</mat-icon>
          </button>
        </h3>

        <!-- Selected Partners Display -->
        <div class="partners-list" *ngIf="selectedPartners.length > 0">
          <div class="partner-card" *ngFor="let partner of selectedPartners"
            style="background: white; border: 1px solid #e1e8ed; border-radius: 8px; padding: 12px 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 16px;">
            <mat-icon
              style="color: #667eea; font-size: 24px; width: 24px; height: 24px; flex-shrink: 0;">person</mat-icon>
            <div style="flex: 1; cursor: pointer;" (click)="openPartnerDonorDetails(partner, $event)"
              title="לחץ לצפייה בפרטי התורם">
              <div style="font-weight: 600; color: #667eea; font-size: 14px; text-decoration: underline;">{{
                getPartnerDisplayName(partner) }}</div>
            </div>
            <button mat-icon-button (click)="removePartner(partner)" style="color: #dc3545; flex-shrink: 0;"
              [title]="i18n.terms.removePartner">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>



      <!-- אפיון תרומה -->
      <div class="section donation-characterization">
        <h3>{{i18n.terms.donationCharacterization}}</h3>
        <div class="form-grid">
          <div class="form-group">
            <div class="donation-type-option" [class.active]="donation.isExceptional">
              <label class="donation-type-card">
                <input type="checkbox" [(ngModel)]="donation.isExceptional" class="donation-type-checkbox">
                <div class="donation-type-content">
                  <mat-icon class="donation-type-icon">priority_high</mat-icon>
                  <div class="donation-type-text">
                    <span class="donation-type-label">{{i18n.terms.exceptionalDonation}}</span>
                    <span class="donation-type-description">{{i18n.terms.exceptionalDonationDesc}}</span>
                  </div>
                </div>
              </label>
            </div>
          </div>

          <!-- <div class="form-group">
              <div class="donation-type-option" [class.active]="donation.isUrgent">
                <label class="donation-type-card">
                  <input type="checkbox" [(ngModel)]="donation.isUrgent" class="donation-type-checkbox">
                  <div class="donation-type-content">
                    <mat-icon class="donation-type-icon">flash_on</mat-icon>
                    <div class="donation-type-text">
                      <span class="donation-type-label">חדר תה</span>
                      <span class="donation-type-description">דורש טיפול מיידי</span>
                    </div>
                  </div>
                </label>
              </div>
            </div> -->
        </div>
      </div>

      <!-- הערות -->
      <div id="section-notes" class="section notes-section">
        <h3>{{i18n.terms.notes}}</h3>
        <div class="form-grid">
          <div class="form-group full-width">
            <!-- <div class="field-title">
                <mat-icon class="field-icon">note</mat-icon>
                <label>{{i18n.terms.notes}}</label>
              </div> -->
            <textarea class="form-control" rows="4" [(ngModel)]="donation.notes"
              [placeholder]="i18n.terms.enterNotes"></textarea>
          </div>

          <!-- <div class="form-group">
              <div class="anonymous-option" [class.active]="donation.isAnonymous">
                <label class="anonymous-card">
                  <input type="checkbox" [(ngModel)]="donation.isAnonymous" class="anonymous-checkbox">
                  <div class="anonymous-content">
                    <mat-icon class="anonymous-icon">visibility_off</mat-icon>
                    <span class="anonymous-label">תרומה אנונימית</span>
                  </div>
                </label>
              </div>
            </div> -->
        </div>
      </div>

      <!-- קבצים מצורפים -->
      <div id="section-files" class="section files-section" *ngIf="!isNewDonation">
        <h3>
          <mat-icon class="section-icon">attach_file</mat-icon>
          {{i18n.terms.attachedFiles || 'קבצים מצורפים'}}
          <button class="add-btn" (click)="fileUploadComponent.openFilePicker()"
            [title]="i18n.terms.uploadFile || 'העלה קובץ'">
            <mat-icon>add</mat-icon>
          </button>
        </h3>
        <app-file-upload #fileUploadComponent [donationId]="donation.id" [allowMultiple]="true"
          [acceptedTypes]="'image/*,.pdf'" [maxFileSize]="10485760">
        </app-file-upload>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <div class="footer-actions-left">
      <!-- Campaign-based Actions -->
      <!-- <div class="campaign-actions" *ngIf="selectedCampaign">
          <button mat-stroked-button class="action-button campaign-contacts-btn" (click)="openCampaignContacts()"
            title="אנשי קשר ופעילים">
            <mat-icon>contacts</mat-icon>
            אנשי קשר ופעילים
          </button>
        </div> -->

      <!-- Additional Actions -->
      <button mat-stroked-button class="action-button print-letter-btn" (click)="printLetter()"
        [title]="i18n.terms.letterGeneration">
        <mat-icon>print</mat-icon>
        {{i18n.terms.letterGeneration}}
      </button>

      <button *ngIf="hasReminderFlag" mat-stroked-button class="action-button open-reminder-btn" (click)="openReminder()"
        [title]="i18n.terms.openReminderButton">
        <mat-icon>alarm</mat-icon>
        {{i18n.terms.openReminderButton}}
      </button>

      <button *ngIf="!hasReminderFlag" mat-stroked-button class="action-button add-reminder-btn" (click)="addReminder()"
        [title]="i18n.terms.addReminderButton">
        <mat-icon>alarm_add</mat-icon>
        {{i18n.terms.addReminderButton}}
      </button>

      <button
        *ngIf="!isNewDonation && selectedPaymentMethod && selectedPaymentMethod.type === 'standing_order' && donation.donationType !== 'commitment' &&
        ((donation.standingOrderType === 'bank' && donationBanks.length) || (donation.standingOrderType === 'organization' && donationOrganizations.length))"
        mat-stroked-button class="action-button payment-list-btn" (click)="openPaymentList()" title="תנועות">
        <mat-icon>payment</mat-icon>
        תנועות
      </button>

      <!-- Divider -->
      <div class="footer-divider"></div>

      <!-- Admin Actions -->
      <button mat-stroked-button color="warn" *ngIf="!isNewDonation" (click)="deleteDonation()" class="action-button">
        <mat-icon>delete</mat-icon>
        {{i18n.terms.deleteDonation}}
      </button>
    </div>
    <div class="footer-actions-right">
      <button mat-stroked-button (click)="closeModal()" class="cancel-button">
        <mat-icon>close</mat-icon>
        {{i18n.terms.cancel}}
      </button>
      <button mat-raised-button color="primary" (click)="saveDonation()" class="save-button" [disabled]="loading">
        <mat-icon>save</mat-icon>
        {{isNewDonation ? i18n.terms.saveDonation : i18n.terms.updateDonation}}
      </button>
    </div>
  </div>
</div>
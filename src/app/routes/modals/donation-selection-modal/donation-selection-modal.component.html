<div class="module-container">
  <div class="module-header">
    <div class="header-top">
      <h2>{{ args.title || 'בחר תרומה' }}</h2>
      <div class="header-actions">
        <button *ngIf="args.multiSelect && selectedDonations.length > 0" class="btn-finish" (click)="finishMultiSelect()">סיים בחירה ({{ selectedDonations.length }})</button>
        <button class="btn-close" (click)="closeDialog()">✕</button>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-row">
        <div class="filter-group">
          <label>חיפוש</label>
          <input type="text" [(ngModel)]="filterText" (ngModelChange)="applyFilters()" placeholder="חפש תרומה (תורם, סכום, קמפיין)...">
        </div>
        <button class="btn-create" (click)="createNewDonation()">יצירת תרומה חדשה</button>
      </div>
    </div>
  </div>

  <div class="module-content">
    <div class="table-body">
      <table class="data-table">
        <thead>
          <tr>
            <th *ngIf="args.multiSelect" class="checkbox-col">בחירה</th>
            <th class="sortable" [class.sorted]="isSorted('donorName')" (click)="toggleSort('donorName', $event)">
              שם תורם
              <span class="sort-icon" *ngIf="getSortIcon('donorName')">{{getSortIcon('donorName')}}</span>
            </th>
            <th class="sortable" [class.sorted]="isSorted('amount')" (click)="toggleSort('amount', $event)">
              סכום
              <span class="sort-icon" *ngIf="getSortIcon('amount')">{{getSortIcon('amount')}}</span>
            </th>
            <th class="sortable" [class.sorted]="isSorted('date')" (click)="toggleSort('date', $event)">
              תאריך
              <span class="sort-icon" *ngIf="getSortIcon('date')">{{getSortIcon('date')}}</span>
            </th>
            <th class="sortable" [class.sorted]="isSorted('campaign')" (click)="toggleSort('campaign', $event)">
              קמפיין
              <span class="sort-icon" *ngIf="getSortIcon('campaign')">{{getSortIcon('campaign')}}</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let donation of paginatedDonations" (click)="selectDonation(donation)" [class.selected]="isDonationSelected(donation)">
            <td *ngIf="args.multiSelect" class="checkbox-col">
              <input type="checkbox" [checked]="isDonationSelected(donation)" (click)="$event.stopPropagation()">
            </td>
            <td>{{ getDonor(donation.donorId)?.fullName || 'לא ידוע' }}</td>
            <td class="amount-cell">{{ donation.amount | number }} {{ donation.currency }}</td>
            <td>{{ formatDate(donation.donationDate) }}</td>
            <td>{{ getCampaign(donation.campaignId)?.name || '-' }}</td>
          </tr>
          <tr *ngIf="paginatedDonations.length === 0">
            <td [attr.colspan]="args.multiSelect ? 5 : 4" class="no-data">לא נמצאו תרומות</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-footer">
      <div class="pagination-controls">
        <button (click)="firstPage()" [disabled]="currentPage === 1">⏮ ראשון</button>
        <button (click)="previousPage()" [disabled]="currentPage === 1">← הקודם</button>
        <div class="page-numbers">
          <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)" [class.active]="page === currentPage">{{page}}</button>
        </div>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">הבא →</button>
        <button (click)="lastPage()" [disabled]="currentPage === totalPages">אחרון ⏭</button>
      </div>
      <div class="pagination-info">
        <span>מציג {{(currentPage - 1) * pageSize + 1}} - {{Math.min(currentPage * pageSize, totalCount)}} מתוך {{totalCount}}</span>
      </div>
    </div>
  </div>
</div>

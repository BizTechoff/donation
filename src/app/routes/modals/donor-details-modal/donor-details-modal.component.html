<!-- Donor Details Modal -->
<div class="modal-overlay" (click)="closeModal($event)">
  <div class="modal-content donor-details-modal" (click)="$event.stopPropagation()">
    
    <!-- Navigation Header -->
    <app-modal-navigation-header
      title="פרטי תורם"
      [records]="allDonors"
      [currentRecordId]="donor?.id || ''"
      [filterOptions]="filterOptions"
      placeholder="חיפוש תורמים..."
      (recordSelected)="onRecordSelected($event)"
      (searchChanged)="onSearchChanged($event)"
      (filtersChanged)="onFiltersChanged($event)"
      (navigateNext)="onNavigateNext()"
      (navigatePrevious)="onNavigatePrevious()">
    </app-modal-navigation-header>
    
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>{{isNewDonor ? 'person_add' : 'person'}}</mat-icon>
        </div>
        <div class="header-text">
          <h2>{{isNewDonor ? ((i18n.terms$ | async)?.addNewDonor) : ((i18n.terms$ | async)?.donorDetails)}}</h2>
          <p class="header-subtitle" *ngIf="!isNewDonor && donor">
            {{donor.displayName}}
          </p>
        </div>
      </div>
      <button class="modal-close" (click)="closeModal()" matTooltip="{{(i18n.terms$ | async)?.close}}" [dir]="i18n.lang.RTL ? 'rtl' : 'ltr'">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="loading-spinner">{{ (i18n.terms$ | async)?.loadingData }}</div>
    </div>
    
    <div class="modal-body">
      <div class="details-grid" *ngIf="donor && !loading">
        <!-- פרטים אישיים -->
        <div class="section personal-details">
          <h3>{{ (i18n.terms$ | async)?.personalDetails }}</h3>
          <div class="form-grid">
            <!-- שורה ראשונה: תואר, שם פרטי, שם משפחה, סיומת -->
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">military_tech</mat-icon>
                <label>תואר</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.title" placeholder="תואר (כגון: רב, ד&quot;ר)">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">person</mat-icon>
                <label>{{ (i18n.terms$ | async)?.firstName }} *</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.firstName" [placeholder]="(i18n.terms$ | async)?.firstName">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">badge</mat-icon>
                <label>{{ (i18n.terms$ | async)?.lastName }} *</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.lastName" [placeholder]="(i18n.terms$ | async)?.lastName">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">title</mat-icon>
                <label>סיומת</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.suffix" placeholder="סיומת (כגון: הי&quot;ו)">
            </div>
            
            <!-- שורה שנייה: כינוי, שם באנגלית -->
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">face</mat-icon>
                <label>כינוי</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.nickname" placeholder="כינוי">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">language</mat-icon>
                <label>שם פרטי באנגלית</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.firstNameEnglish" placeholder="First Name">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">translate</mat-icon>
                <label>שם משפחה באנגלית</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.lastNameEnglish" placeholder="Last Name">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">fingerprint</mat-icon>
                <label>{{ (i18n.terms$ | async)?.idNumber }}</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.idNumber" [placeholder]="(i18n.terms$ | async)?.idNumber">
            </div>
            
            <!-- שורה שלישית: דוא&quot;ל, טלפונים -->
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">email</mat-icon>
                <label>{{ (i18n.terms$ | async)?.email }}</label>
              </div>
              <input type="email" class="form-control" [(ngModel)]="donor.email" [placeholder]="(i18n.terms$ | async)?.email">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">flag</mat-icon>
                <label>קידומת בינלאומית</label>
              </div>
              <select class="form-control" [(ngModel)]="donor.internationalPrefix">
                <option value="+972">+972 (ישראל)</option>
                <option value="+1">+1 (ארה&quot;ב/קנדה)</option>
                <option value="+44">+44 (בריטניה)</option>
                <option value="+33">+33 (צרפת)</option>
                <option value="+49">+49 (גרמניה)</option>
              </select>
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">phone</mat-icon>
                <label>{{ (i18n.terms$ | async)?.phone }}</label>
              </div>
              <input type="tel" class="form-control" [(ngModel)]="donor.phone" [placeholder]="(i18n.terms$ | async)?.phone">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">add_call</mat-icon>
                <label>טלפון נוסף</label>
              </div>
              <input type="tel" class="form-control" [(ngModel)]="donor.additionalPhone" placeholder="טלפון נוסף">
            </div>
            
            <!-- Birth Date -->
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">cake</mat-icon>
                <label>{{ (i18n.terms$ | async)?.birthDate || 'תאריך לידה' }}</label>
              </div>
              <app-modern-dual-date-picker
                [(value)]="donor.birthDate"
                [compact]="false">
              </app-modern-dual-date-picker>
            </div>
          </div>
        </div>
        
        <!-- כתובת מגורים -->
        <div class="section address-section">
          <h3>כתובת מגורים</h3>
          <div class="form-grid">
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">home</mat-icon>
                <label>רחוב 1</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.street1" placeholder="רחוב ומספר">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">apartment</mat-icon>
                <label>רחוב 2</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.street2" placeholder="כניסה/דירה">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">location_city</mat-icon>
                <label>שכונה</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.neighborhood" placeholder="שכונה">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">place</mat-icon>
                <label>{{ (i18n.terms$ | async)?.city }}</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.city" [placeholder]="(i18n.terms$ | async)?.city">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">markunread_mailbox</mat-icon>
                <label>{{ (i18n.terms$ | async)?.zipCode }}</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.zipCode" [placeholder]="(i18n.terms$ | async)?.zipCode">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">public</mat-icon>
                <label>{{ (i18n.terms$ | async)?.country }}</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.country" [placeholder]="(i18n.terms$ | async)?.country">
            </div>
          </div>
        </div>
        
        <!-- כתובת נופש -->
        <div class="section vacation-address-section">
          <h3>כתובת נופש</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">beach_access</mat-icon>
                <label>כתובת נופש</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationAddress" placeholder="כתובת מלאה">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">holiday_village</mat-icon>
                <label>עיר נופש</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationCity" placeholder="עיר">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">local_post_office</mat-icon>
                <label>מיקוד נופש</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationZipCode" placeholder="מיקוד">
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">travel_explore</mat-icon>
                <label>מדינה נופש</label>
              </div>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationCountry" placeholder="מדינה">
            </div>
          </div>
        </div>

        <!-- מידע משפחתי -->
        <div class="section family-info">
          <h3>{{ (i18n.terms$ | async)?.familyInformation }}</h3>
          
          <div class="family-info-grid">
            <!-- Basic Family Information -->
            <div class="family-basic-info">
              <div class="family-group">
                <h4 class="group-title">
                  <mat-icon>favorite</mat-icon>
                  מצב משפחתי
                </h4>
                <div class="form-grid">
                  <div class="form-group">
                    <!-- <div class="field-title">
                      <mat-icon class="field-icon">favorite</mat-icon>
                      <label>{{ (i18n.terms$ | async)?.maritalStatus }}</label>
                    </div> -->
                    <div class="marital-status-grid">
                      <div class="marital-status-option" [class.active]="donor.maritalStatus === 'married'">
                        <label class="marital-status-card">
                          <input type="radio" name="maritalStatus" value="married" [(ngModel)]="donor.maritalStatus" class="marital-status-radio">
                          <div class="marital-status-content">
                            <span class="marital-status-icon">💒</span>
                            <span class="marital-status-label">נשוי/ה</span>
                          </div>
                        </label>
                      </div>
                      
                      <div class="marital-status-option" [class.active]="donor.maritalStatus === 'single'">
                        <label class="marital-status-card">
                          <input type="radio" name="maritalStatus" value="single" [(ngModel)]="donor.maritalStatus" class="marital-status-radio">
                          <div class="marital-status-content">
                            <span class="marital-status-icon">👤</span>
                            <span class="marital-status-label">רווק/ה</span>
                          </div>
                        </label>
                      </div>
                      
                      <div class="marital-status-option" [class.active]="donor.maritalStatus === 'widowed'">
                        <label class="marital-status-card">
                          <input type="radio" name="maritalStatus" value="widowed" [(ngModel)]="donor.maritalStatus" class="marital-status-radio">
                          <div class="marital-status-content">
                            <span class="marital-status-icon">🕊️</span>
                            <span class="marital-status-label">אלמן/ה</span>
                          </div>
                        </label>
                      </div>
                      
                      <div class="marital-status-option" [class.active]="donor.maritalStatus === 'divorced'">
                        <label class="marital-status-card">
                          <input type="radio" name="maritalStatus" value="divorced" [(ngModel)]="donor.maritalStatus" class="marital-status-radio">
                          <div class="marital-status-content">
                            <span class="marital-status-icon">💔</span>
                            <span class="marital-status-label">גרוש/ה</span>
                          </div>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Spouse Information - Show only if married -->
                <div *ngIf="donor.maritalStatus === 'married'" class="spouse-info">
                  <div class="form-grid">
                    <div class="form-group">
                      <div class="field-title">
                        <mat-icon class="field-icon">person_outline</mat-icon>
                        <label>תואר בן/בת הזוג</label>
                      </div>
                      <input type="text" class="form-control" [(ngModel)]="donor.wifeTitle" placeholder="תואר">
                    </div>
                    <div class="form-group">
                      <div class="field-title">
                        <mat-icon class="field-icon">people</mat-icon>
                        <label>שם בן/בת הזוג</label>
                      </div>
                      <input type="text" class="form-control" [(ngModel)]="donor.wifeName" placeholder="שם מלא">
                    </div>
                    <div class="form-group">
                      <div class="field-title">
                        <mat-icon class="field-icon">partner_exchange</mat-icon>
                        <label>{{ (i18n.terms$ | async)?.spouseName }}</label>
                      </div>
                      <input type="text" class="form-control" [(ngModel)]="donor.spouseName" [placeholder]="(i18n.terms$ | async)?.spouseName">
                    </div>
                  </div>
                </div>
              </div>

            <!-- Family Connections & Contact -->
            <div class="family-extended-info">
              <div class="family-group">
                <h4 class="group-title">
                  <mat-icon>family_restroom</mat-icon>
                  קשרים משפחתיים
                </h4>
                <div class="form-grid">
                  <div class="form-group full-width">
                    <!-- <div class="field-title">
                      <mat-icon class="field-icon">connect_without_contact</mat-icon>
                      <label>סוג הקישור המשפחתי</label>
                    </div> -->
                    <input type="text" class="form-control" [(ngModel)]="donor.familyConnection" placeholder="אח של, דוד של, חבר של...">
                  </div>
                  <div class="form-group">
                    <div class="field-title">
                      <mat-icon class="field-icon">man</mat-icon>
                      <label>שם האב</label>
                    </div>
                    <input type="text" class="form-control" [(ngModel)]="donor.fatherName" placeholder="שם האב">
                  </div>
                  <div class="form-group" *ngIf="donor.maritalStatus === 'married'">
                    <div class="field-title">
                      <mat-icon class="field-icon">elderly</mat-icon>
                      <label>שם החותן</label>
                    </div>
                    <input type="text" class="form-control" [(ngModel)]="donor.fatherInLawName" placeholder="שם החותן">
                  </div>
                  <!-- <div class="form-group full-width">
                    <div class="field-title">
                      <mat-icon class="field-icon">notes</mat-icon>
                      <label>הערות נוספות</label>
                    </div>
                    <textarea class="form-control" [(ngModel)]="donor.familyConnectionNotes" placeholder="פרטים נוספים על הקשר" rows="2"></textarea>
                  </div> -->
                </div>
              </div>

              <div class="family-group">
                <h4 class="group-title">
                  <mat-icon>phone</mat-icon>
                  פרטי התקשרות
                </h4>
                <div class="form-grid">
                  <div class="form-group">
                    <div class="field-title">
                      <mat-icon class="field-icon">home_phone</mat-icon>
                      <label>{{ (i18n.terms$ | async)?.homePhone }}</label>
                    </div>
                    <input type="tel" class="form-control" [(ngModel)]="donor.homePhone" [placeholder]="(i18n.terms$ | async)?.homePhone">
                  </div>
                  <div class="form-group">
                    <div class="field-title">
                      <mat-icon class="field-icon">smartphone</mat-icon>
                      <label>{{ (i18n.terms$ | async)?.mobilePhone }}</label>
                    </div>
                    <input type="tel" class="form-control" [(ngModel)]="donor.mobilePhone" [placeholder]="(i18n.terms$ | async)?.mobilePhone">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- תאריכים אישיים -->
          <div class="personal-dates-section">
            <div class="section-header">
              <h4>{{ (i18n.terms$ | async)?.personalDates || 'תאריכים אישיים' }}</h4>
              <button class="mat-fab-mini" (click)="openAddDateDialog()" title="הוסף תאריך מותאם אישית">
                <span class="fab-icon">+</span>
              </button>
            </div>
            
            <div class="dates-container" [class.scrollable]="(customPersonalDates.length + 3) > 5">
              <!-- Empty state message when no personal events exist -->
              <div *ngIf="donorEvents.length === 0 && customPersonalDates.length === 0" class="empty-events-message">
                <p>לא נמצאו אירועים אישיים לתורם זה, להוספת אירוע יש ללחוץ על +</p>
              </div>
              
              <!-- Donor Events displayed with simple date inputs -->
              <div *ngFor="let donorEvent of donorEvents; trackBy: trackDonorEventById" class="form-group full-width custom-date-item">
                <label>{{donorEvent.event?.description || 'אירוע'}}</label>
                <input type="date" class="form-control" [(ngModel)]="donorEvent.hebrewDate">
                <button 
                  *ngIf="!donorEvent.event?.isRequired" 
                  class="remove-date-btn" 
                  (click)="removeDonorEvent(donorEvent)" 
                  title="הסר אירוע">
                  ×
                </button>
              </div>
              
              <!-- Custom Dates -->
              <div class="form-group full-width custom-date-item" *ngFor="let customDate of customPersonalDates; let i = index">
                <label>{{customDate.name}}</label>
                <input type="date" class="form-control" [(ngModel)]="customDate.date">
                <button class="remove-date-btn" (click)="removeCustomDate(i)" title="הסר תאריך">
                  ×
                </button>
              </div>
            </div>
          </div>

          
          <!-- Dialog for adding event or custom date -->
          <div class="custom-date-dialog" *ngIf="showAddDateDialog">
            <div class="dialog-backdrop" (click)="closeAddDateDialog()"></div>
            <div class="dialog-content events-table-dialog">
              <h4>הוסף אירוע או תאריך מותאם אישית</h4>
              
              <!-- Search Section -->
              <div class="search-section">
                <div class="search-input-group">
                  <input 
                    type="text" 
                    class="form-control search-input" 
                    [(ngModel)]="eventSearchTerm"
                    placeholder="חפש אירוע...">
                  <button *ngIf="eventSearchTerm" class="clear-search-btn" (click)="clearSearch()">×</button>
                </div>
                <button class="btn btn-success add-new-btn" (click)="toggleCreateNewEvent()">
                  {{ showCreateNewEvent ? 'ביטול' : '+ יצירת אירוע חדש' }}
                </button>
              </div>

              <!-- Create New Event Section -->
              <div class="create-event-section" *ngIf="showCreateNewEvent">
                <div class="create-event-overlay">
                  <div class="create-event-card">
                    <h5>יצירת אירוע חדש</h5>
                    <div class="new-event-form">
                      <input 
                        type="text" 
                        class="form-control" 
                        [(ngModel)]="newEventDescription"
                        placeholder="שם האירוע (לדוגמה: יום הולדת בן)"
                        (keyup.enter)="createNewEvent()">
                      <div class="form-actions">
                        <button class="btn btn-primary" (click)="createNewEvent()" [disabled]="!newEventDescription.trim()">
                          יצור ושמור
                        </button>
                        <button class="btn btn-secondary" (click)="toggleCreateNewEvent()">
                          ביטול
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Events Table -->
              <div class="events-table-section" *ngIf="!showCreateNewEvent">
                <div class="events-table-container">
                  <table class="events-table" *ngIf="getFilteredEvents().length > 0">
                    <thead>
                      <tr>
                        <th>תיאור האירוע</th>
                        <th>פעולות</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let event of getFilteredEvents()">
                        <td>{{ event.description }}</td>
                        <td>
                          <button class="btn btn-small btn-primary" (click)="addEventFromDialog(event)">
                            בחר
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  
                  <!-- Empty state when no events found -->
                  <div class="no-events-found" *ngIf="getFilteredEvents().length === 0">
                    <p *ngIf="eventSearchTerm">לא נמצאו אירועים התואמים לחיפוש "{{ eventSearchTerm }}"</p>
                    <p *ngIf="!eventSearchTerm">אין אירועים זמינים</p>
                    <button class="btn btn-primary" (click)="toggleCreateNewEvent()">יצור אירוע חדש</button>
                  </div>
                </div>
              </div>

              
              <div class="dialog-actions">
                <button class="btn btn-secondary" (click)="closeAddDateDialog()">סגור</button>
              </div>
            </div>
          </div>
        </div>

        <!-- חברות ועמותות -->
        <div class="section company-organization">
          <div class="section-header">
            <h3>חברות ועמותות</h3>
            <button class="btn btn-success btn-sm" (click)="addCompany()" title="הוסף חברה/עמותה">
              + הוסף חברה/עמותה
            </button>
          </div>
          
          <!-- Empty state message when no companies exist -->
          <div *ngIf="!donor.companies || donor.companies.length === 0" class="empty-message">
            <p>לא נמצאו חברות או עמותות לתורם זה. להוספת חברה/עמותה יש ללחוץ על הכפתור למעלה.</p>
          </div>
          
          <!-- Companies list -->
          <div *ngFor="let company of donor.companies; let i = index; trackBy: trackByCompanyId" class="company-item">
            <div class="company-header">
              <h4>חברה/עמותה {{i + 1}}</h4>
              <button class="btn btn-danger btn-sm" (click)="removeCompany(i)" title="הסר חברה">
                × הסר
              </button>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">business</mat-icon>
                  <label>שם החברה/עמותה</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.name" placeholder="שם החברה או העמותה">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">numbers</mat-icon>
                  <label>מספר חברה/עמותה</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.number" placeholder="מספר רישום">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">work</mat-icon>
                  <label>תפקיד</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.role" placeholder="תפקיד בחברה/עמותה">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">language</mat-icon>
                  <label>אתר אינטרנט</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.website" placeholder="כתובת אתר האינטרנט">
              </div>
            </div>
            
            <h5>כתובת החברה/עמותה</h5>
            <div class="form-grid">
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">business_center</mat-icon>
                  <label>רחוב 1</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.street1" placeholder="רחוב ומספר">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">domain</mat-icon>
                  <label>רחוב 2</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.street2" placeholder="כניסה/קומה/משרד">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">location_city</mat-icon>
                  <label>שכונה</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.neighborhood" placeholder="שכונה">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">place</mat-icon>
                  <label>עיר</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.city" placeholder="עיר">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">markunread_mailbox</mat-icon>
                  <label>מיקוד</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.zipCode" placeholder="מיקוד">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">public</mat-icon>
                  <label>מדינה</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="company.country" placeholder="מדינה">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">phone_in_talk</mat-icon>
                  <label>טלפון</label>
                </div>
                <input type="tel" class="form-control" [(ngModel)]="company.phone" placeholder="טלפון החברה/עמותה">
              </div>
              <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">alternate_email</mat-icon>
                  <label>דוא"ל</label>
                </div>
                <input type="email" class="form-control" [(ngModel)]="company.email" placeholder="דוא״ל החברה/עמותה">
              </div>
            </div>
          </div>
        </div>

        <!-- קטגוריות ורמות -->
        <div class="section categories-levels">
          <h3>קטגוריות ורמות</h3>
          
          <!-- Donor Level Card -->
          <div class="info-card donor-level-card">
            <div class="form-grid">
              <div class="form-group full-width">
                <div class="field-title">
                  <mat-icon class="field-icon">star</mat-icon>
                  <label>{{ (i18n.terms$ | async)?.level }}</label>
                </div>
                <div class="level-selection-grid">
                  <div class="level-option" [class.active]="donor.level === 'quarter'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="quarter" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">🔸</span>
                        <span class="level-label">רבע</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'half'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="half" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">🔹</span>
                        <span class="level-label">חצי</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'full'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="full" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">⭕</span>
                        <span class="level-label">שלם</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'bronze_lords'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="bronze_lords" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">🥉</span>
                        <span class="level-label">אדני נחושת</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'silver_stones'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="silver_stones" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">🥈</span>
                        <span class="level-label">אבני כסף</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'gold_pillars'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="gold_pillars" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">🥇</span>
                        <span class="level-label">עמודי זהב</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'sapphire_diamond'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="sapphire_diamond" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">💎</span>
                        <span class="level-label">ספיר ויהלום</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'platinum'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="platinum" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">👑</span>
                        <span class="level-label">פלטיניום</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'patron'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="patron" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">🏆</span>
                        <span class="level-label">פטרון</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'torah_holder'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="torah_holder" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">📜</span>
                        <span class="level-label">מחזיק תורה</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'supreme_level_1'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="supreme_level_1" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">🌳</span>
                        <span class="level-label">עץ חיים</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="level-option" [class.active]="donor.level === 'supreme_level_2'">
                    <label class="level-card">
                      <input type="radio" name="donorLevel" value="supreme_level_2" [(ngModel)]="donor.level" class="level-radio">
                      <div class="level-content">
                        <span class="level-icon">👑</span>
                        <span class="level-label">כתר תורה</span>
                      </div>
                    </label>
                  </div>
                </div>
              </div>
              <!-- <div class="form-group">
                <div class="field-title">
                  <mat-icon class="field-icon">group_work</mat-icon>
                  <label>{{ (i18n.terms$ | async)?.circle }}</label>
                </div>
                <input type="text" class="form-control" [(ngModel)]="donor.circle" [placeholder]="(i18n.terms$ | async)?.circle">
              </div> -->
              <div class="form-group full-width">
                <div class="field-title">
                  <mat-icon class="field-icon">translate</mat-icon>
                  <label>{{ (i18n.terms$ | async)?.preferredLanguage }}</label>
                </div>
                <div class="language-selection-grid">
                  <div class="language-option" [class.active]="donor.preferredLanguage === 'he'">
                    <label class="language-card">
                      <input type="radio" name="donorLanguage" value="he" [(ngModel)]="donor.preferredLanguage" class="language-radio">
                      <div class="language-content">
                        <span class="language-icon">🇮🇱</span>
                        <span class="language-label">{{ (i18n.terms$ | async)?.hebrew }}</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="language-option" [class.active]="donor.preferredLanguage === 'en'">
                    <label class="language-card">
                      <input type="radio" name="donorLanguage" value="en" [(ngModel)]="donor.preferredLanguage" class="language-radio">
                      <div class="language-content">
                        <span class="language-icon">🇺🇸</span>
                        <span class="language-label">{{ (i18n.terms$ | async)?.english }}</span>
                      </div>
                    </label>
                  </div>
                  
                  <div class="language-option" [class.active]="donor.preferredLanguage === 'yi'">
                    <label class="language-card">
                      <input type="radio" name="donorLanguage" value="yi" [(ngModel)]="donor.preferredLanguage" class="language-radio">
                      <div class="language-content">
                        <span class="language-icon">✡️</span>
                        <span class="language-label">{{ (i18n.terms$ | async)?.yiddish }}</span>
                      </div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Donor Type Card -->
          <div class="info-card donor-type-card">
            <div class="card-header">
              <mat-icon class="card-icon">group</mat-icon>
              <h4>אפיון תורם</h4>
            </div>
            <div class="donor-type-grid">
              <div class="type-option" [class.active]="donor.isAnash">
                <label class="type-card">
                  <input type="checkbox" [(ngModel)]="donor.isAnash" class="type-checkbox">
                  <div class="type-content">
                    <mat-icon class="type-icon">synagogue</mat-icon>
                    <span class="type-label">אנ"ש</span>
                    <small class="type-desc">חברי הקהילה</small>
                  </div>
                </label>
              </div>
              
              <div class="type-option" [class.active]="donor.isAlumni">
                <label class="type-card">
                  <input type="checkbox" [(ngModel)]="donor.isAlumni" class="type-checkbox">
                  <div class="type-content">
                    <mat-icon class="type-icon">school</mat-icon>
                    <span class="type-label">בוגר</span>
                    <small class="type-desc">בוגרי המוסד</small>
                  </div>
                </label>
              </div>
              
              <div class="type-option" [class.active]="donor.isOtherConnection">
                <label class="type-card">
                  <input type="checkbox" [(ngModel)]="donor.isOtherConnection" (change)="onOtherConnectionChange()" class="type-checkbox">
                  <div class="type-content">
                    <mat-icon class="type-icon">people_alt</mat-icon>
                    <span class="type-label">קשר אחר</span>
                    <small class="type-desc">קשר משפחתי או חברי</small>
                  </div>
                </label>
              </div>
            </div>
            
            <!-- Show relationship fields only when "קשר אחר" is checked -->
            <div class="relationship-details" *ngIf="donor.isOtherConnection">
              <div class="form-grid">
                <div class="form-group">
                  <div class="field-title">
                    <mat-icon class="field-icon">connect_without_contact</mat-icon>
                    <label>סוג הקשר</label>
                  </div>
                  <input type="text" class="form-control" [(ngModel)]="donor.relationshipType" 
                         placeholder="אבא / סבא / ידיד / אחר...">
                </div>
                <div class="form-group">
                  <div class="field-title">
                    <mat-icon class="field-icon">person_search</mat-icon>
                    <label>קשר של מי</label>
                  </div>
                  <input type="text" class="form-control" [(ngModel)]="donor.relationshipOf" 
                         placeholder="שם האדם שהתורם קשור אליו">
                </div>
              </div>
            </div>
          </div>
          
          <!-- Interests Card -->
          <div class="info-card interests-card">
            <div class="card-header">
              <mat-icon class="card-icon">interests</mat-icon>
              <h4>תחומי עניין</h4>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <div class="field-title">
                  <mat-icon class="field-icon">interests</mat-icon>
                  <label>ריגושים ונושאים מעניינים</label>
                </div>
                <textarea class="form-control interests-textarea" [(ngModel)]="donor.interests" 
                          placeholder="נושאים שמעניינים את התורם: תורה, חסידות, חינוך, קהילה..." rows="3"></textarea>
              </div>
              <div class="form-group full-width">
                <div class="field-title">
                  <mat-icon class="field-icon">sports_soccer</mat-icon>
                  <label>תחביבים ופעילויות</label>
                </div>
                <textarea class="form-control hobbies-textarea" [(ngModel)]="donor.hobbies" 
                          placeholder="תחביבים ופעילויות פנאי: ספורט, מוסיקה, קריאה, נסיעות..." rows="3"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- העדפות יצירת קשר -->
        <div class="section contact-preferences">
          <h3>{{ (i18n.terms$ | async)?.contactPreferences }}</h3>
          
          <!-- Reception Hours Card -->
          <div class="info-card reception-card">
            <div class="card-header">
              <mat-icon class="card-icon">schedule</mat-icon>
              <h4>שעות קבלה</h4>
            </div>
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">access_time</mat-icon>
                <label>{{ (i18n.terms$ | async)?.receptionHours }}</label>
              </div>
              <input type="text" class="form-control modern-input" [(ngModel)]="donor.receptionHours" 
                     placeholder="לדוגמה: 09:00-17:00 או בשעות הערב">
            </div>
          </div>
          
          <!-- Preferred Days Card -->
          <div class="info-card days-card">
            <div class="card-header">
              <mat-icon class="card-icon">calendar_month</mat-icon>
              <h4>{{ (i18n.terms$ | async)?.preferredDays }}</h4>
            </div>
            <div class="days-grid">
              <div class="day-option" [class.active]="donor.sundayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.sundayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.sunday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.mondayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.mondayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.monday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.tuesdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.tuesdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.tuesday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.wednesdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.wednesdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.wednesday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.thursdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.thursdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.thursday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.fridayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.fridayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.friday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.saturdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.saturdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.saturday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Contact Methods Card -->
          <div class="info-card contact-methods-card">
            <div class="card-header">
              <mat-icon class="card-icon">contact_phone</mat-icon>
              <h4>{{ (i18n.terms$ | async)?.preferredContactMethods }}</h4>
            </div>
            <div class="contact-methods-grid">
              <div class="contact-method" [class.active]="donor.preferPhone">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferPhone" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">phone</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.phoneContact }}</span>
                    <small class="method-desc">שיחת טלפון</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferEmail">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferEmail" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">email</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.emailContact }}</span>
                    <small class="method-desc">הודעת דוא"ל</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferSMS">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferSMS" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">sms</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.smsContact }}</span>
                    <small class="method-desc">הודעת טקסט</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferHomeVisit">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferHomeVisit" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">home</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.homeVisit }}</span>
                    <small class="method-desc">ביקור בבית</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferOfficeVisit">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferOfficeVisit" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">business</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.officeVisit }}</span>
                    <small class="method-desc">ביקור במשרד</small>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Contact Style Card -->
          <div class="info-card contact-style-card">
            <div class="card-header">
              <mat-icon class="card-icon">psychology</mat-icon>
              <h4>אופן יצירת הקשר</h4>
            </div>
            <div class="contact-style-grid">
              <div class="contact-style" [class.active]="donor.requirePhoneCoordination">
                <label class="style-card">
                  <input type="checkbox" [(ngModel)]="donor.requirePhoneCoordination" class="style-checkbox">
                  <div class="style-content">
                    <mat-icon class="style-icon">phone_callback</mat-icon>
                    <span class="style-label">בתיאום טלפוני</span>
                    <small class="style-desc">תיאום מראש</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-style" [class.active]="donor.preferSpecialTimes">
                <label class="style-card">
                  <input type="checkbox" [(ngModel)]="donor.preferSpecialTimes" class="style-checkbox">
                  <div class="style-content">
                    <mat-icon class="style-icon">celebration</mat-icon>
                    <span class="style-label">בזמנים מיוחדים</span>
                    <small class="style-desc">פסח/סוכות</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-style" [class.active]="donor.preferPublicReception">
                <label class="style-card">
                  <input type="checkbox" [(ngModel)]="donor.preferPublicReception" class="style-checkbox">
                  <div class="style-content">
                    <mat-icon class="style-icon">groups</mat-icon>
                    <span class="style-label">קבלה כללית</span>
                    <small class="style-desc">קבלת קהל</small>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Additional Preferences Card -->
          <div class="info-card additional-prefs-card">
            <div class="card-header">
              <mat-icon class="card-icon">tune</mat-icon>
              <h4>העדפות נוספות</h4>
            </div>
            <div class="additional-prefs-grid">
              <div class="pref-option" [class.active]="donor.emailOnlyCorrespondence">
                <label class="pref-card">
                  <input type="checkbox" [(ngModel)]="donor.emailOnlyCorrespondence" class="pref-checkbox">
                  <div class="pref-content">
                    <mat-icon class="pref-icon">email</mat-icon>
                    <span class="pref-label">דוא"ל בלבד</span>
                    <small class="pref-desc">שליחת מכתבים באימייל</small>
                  </div>
                </label>
              </div>
              
              <div class="pref-option" [class.active]="donor.autoAddToLocationEvents">
                <label class="pref-card">
                  <input type="checkbox" [(ngModel)]="donor.autoAddToLocationEvents" class="pref-checkbox">
                  <div class="pref-content">
                    <mat-icon class="pref-icon">location_on</mat-icon>
                    <span class="pref-label">אירועים אוטומטי</span>
                    <small class="pref-desc">הוספה לפי מיקום</small>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- העדפות כלליות -->
        <div class="section preferences">
          <h3>{{ (i18n.terms$ | async)?.notes }}</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">note</mat-icon>
                <label>{{ (i18n.terms$ | async)?.generalNotes }}</label>
              </div>
              <textarea class="form-control" rows="4" [(ngModel)]="donor.notes" [placeholder]="(i18n.terms$ | async)?.enterNotesPlaceholder"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="footer-actions-left">
        <!-- Quick Actions -->
        <button mat-stroked-button 
                class="quick-action-btn" 
                *ngIf="!isNewDonor"
                (click)="openGifts()" 
                title="מתנות">
          <mat-icon>redeem</mat-icon>
          מתנות
        </button>
        <button mat-stroked-button 
                class="quick-action-btn" 
                *ngIf="!isNewDonor"
                (click)="openDonations()" 
                title="תרומות">
          <mat-icon>attach_money</mat-icon>
          תרומות
        </button>
        <button mat-stroked-button 
                class="quick-action-btn" 
                *ngIf="!isNewDonor"
                (click)="openReceipts()" 
                title="הוצאת קבלות">
          <mat-icon>receipt_long</mat-icon>
          הו"ק
        </button>
        
        <!-- Divider -->
        <div class="footer-divider" *ngIf="!isNewDonor"></div>
        
        <!-- Admin Actions -->
        <button mat-stroked-button 
                color="warn" 
                *ngIf="!isNewDonor && donor?.isActive" 
                (click)="deactivateDonor()"
                class="action-button">
          <mat-icon>block</mat-icon>
          {{ (i18n.terms$ | async)?.deactivate }}
        </button>
        <button mat-stroked-button 
                color="primary" 
                *ngIf="!isNewDonor && !donor?.isActive" 
                (click)="activateDonor()"
                class="action-button">
          <mat-icon>check_circle</mat-icon>
          {{ (i18n.terms$ | async)?.activate }}
        </button>
        <button mat-stroked-button 
                color="warn" 
                *ngIf="!isNewDonor" 
                (click)="deleteDonor()"
                class="action-button">
          <mat-icon>delete</mat-icon>
          {{ (i18n.terms$ | async)?.delete }}
        </button>
      </div>
      <div class="footer-actions-right">
        <button mat-stroked-button 
                (click)="closeModal()"
                class="cancel-button">
          <mat-icon>close</mat-icon>
          {{ (i18n.terms$ | async)?.cancel }}
        </button>
        <button mat-raised-button 
                color="primary" 
                (click)="saveDonor()"
                class="save-button"
                [disabled]="loading">
          <mat-icon>save</mat-icon>
          {{ (i18n.terms$ | async)?.saveDonor }}
        </button>
      </div>
    </div>
  </div>
</div>
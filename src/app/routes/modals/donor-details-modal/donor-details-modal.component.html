<!-- Donor Details Modal -->
<div class="modal-overlay" (click)="closeModal($event)">
  <div class="modal-content donor-details-modal" (click)="$event.stopPropagation()">
    
    <!-- Navigation Header -->
    <app-modal-navigation-header
      title="驻专 转专"
      [records]="allDonors"
      [currentRecordId]="donor?.id || ''"
      [filterOptions]="filterOptions"
      placeholder="驻砖 转专..."
      (recordSelected)="onRecordSelected($event)"
      (searchChanged)="onSearchChanged($event)"
      (filtersChanged)="onFiltersChanged($event)"
      (navigateNext)="onNavigateNext()"
      (navigatePrevious)="onNavigatePrevious()">
    </app-modal-navigation-header>
    
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>{{isNewDonor ? 'person_add' : 'person'}}</mat-icon>
        </div>
        <div class="header-text">
          <h2>{{isNewDonor ? ((i18n.terms$ | async)?.addNewDonor) : ((i18n.terms$ | async)?.donorDetails)}}</h2>
          <p class="header-subtitle" *ngIf="!isNewDonor && donor">
            {{donor.displayName}}
          </p>
        </div>
      </div>
      <button class="modal-close" (click)="closeModal()" matTooltip="{{(i18n.terms$ | async)?.close}}" [dir]="i18n.lang.RTL ? 'rtl' : 'ltr'">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="loading-spinner">{{ (i18n.terms$ | async)?.loadingData }}</div>
    </div>
    
    <div class="modal-body">
      <div class="details-grid" *ngIf="donor && !loading">
        <!-- 驻专 砖 -->
        <div class="section personal-details">
          <h3>{{ (i18n.terms$ | async)?.personalDetails }}</h3>
          <div class="form-grid">
            <!-- 砖专 专砖: 转专, 砖 驻专, 砖 砖驻, 住转 -->
            <div class="form-group">
              <label>转专</label>
              <input type="text" class="form-control" [(ngModel)]="donor.title" placeholder="转专 (: 专, &quot;专)">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.firstName }} *</label>
              <input type="text" class="form-control" [(ngModel)]="donor.firstName" [placeholder]="(i18n.terms$ | async)?.firstName">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.lastName }} *</label>
              <input type="text" class="form-control" [(ngModel)]="donor.lastName" [placeholder]="(i18n.terms$ | async)?.lastName">
            </div>
            <div class="form-group">
              <label>住转</label>
              <input type="text" class="form-control" [(ngModel)]="donor.suffix" placeholder="住转 (: &quot;)">
            </div>
            
            <!-- 砖专 砖: , 砖 转 -->
            <div class="form-group">
              <label></label>
              <input type="text" class="form-control" [(ngModel)]="donor.nickname" placeholder="">
            </div>
            <div class="form-group">
              <label>砖 驻专 转</label>
              <input type="text" class="form-control" [(ngModel)]="donor.firstNameEnglish" placeholder="First Name">
            </div>
            <div class="form-group">
              <label>砖 砖驻 转</label>
              <input type="text" class="form-control" [(ngModel)]="donor.lastNameEnglish" placeholder="Last Name">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.idNumber }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.idNumber" [placeholder]="(i18n.terms$ | async)?.idNumber">
            </div>
            
            <!-- 砖专 砖砖转: &quot;, 驻 -->
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.email }}</label>
              <input type="email" class="form-control" [(ngModel)]="donor.email" [placeholder]="(i18n.terms$ | async)?.email">
            </div>
            <div class="form-group">
              <label>拽转 转</label>
              <select class="form-control" [(ngModel)]="donor.internationalPrefix">
                <option value="+972">+972 (砖专)</option>
                <option value="+1">+1 (专&quot;/拽)</option>
                <option value="+44">+44 (专)</option>
                <option value="+33">+33 (爪专驻转)</option>
                <option value="+49">+49 (专)</option>
              </select>
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.phone }}</label>
              <input type="tel" class="form-control" [(ngModel)]="donor.phone" [placeholder]="(i18n.terms$ | async)?.phone">
            </div>
            <div class="form-group">
              <label>驻 住祝</label>
              <input type="tel" class="form-control" [(ngModel)]="donor.additionalPhone" placeholder="驻 住祝">
            </div>
            
            <!-- Birth Date -->
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.birthDate || '转专 ' }}</label>
              <input type="date" class="form-control" [(ngModel)]="donor.birthDate">
            </div>
          </div>
        </div>
        
        <!-- 转转 专 -->
        <div class="section address-section">
          <h3>转转 专</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>专 1</label>
              <input type="text" class="form-control" [(ngModel)]="donor.street1" placeholder="专 住驻专">
            </div>
            <div class="form-group">
              <label>专 2</label>
              <input type="text" class="form-control" [(ngModel)]="donor.street2" placeholder="住/专">
            </div>
            <div class="form-group">
              <label>砖</label>
              <input type="text" class="form-control" [(ngModel)]="donor.neighborhood" placeholder="砖">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.city }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.city" [placeholder]="(i18n.terms$ | async)?.city">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.zipCode }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.zipCode" [placeholder]="(i18n.terms$ | async)?.zipCode">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.country }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.country" [placeholder]="(i18n.terms$ | async)?.country">
            </div>
          </div>
        </div>
        
        <!-- 转转 驻砖 -->
        <div class="section vacation-address-section">
          <h3>转转 驻砖</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <label>转转 驻砖</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationAddress" placeholder="转转 ">
            </div>
            <div class="form-group">
              <label>注专 驻砖</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationCity" placeholder="注专">
            </div>
            <div class="form-group">
              <label>拽 驻砖</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationZipCode" placeholder="拽">
            </div>
            <div class="form-group">
              <label> 驻砖</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationCountry" placeholder="">
            </div>
          </div>
        </div>

        <!-- 注 砖驻转 -->
        <div class="section family-info">
          <h3>{{ (i18n.terms$ | async)?.familyInformation }}</h3>
          
          <!-- Marital Status Card -->
          <div class="info-card marital-status-card">
            <div class="card-header">
              <mat-icon class="card-icon">favorite</mat-icon>
              <h4>爪 砖驻转</h4>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>{{ (i18n.terms$ | async)?.maritalStatus }}</label>
                <select class="form-control modern-select" [(ngModel)]="donor.maritalStatus">
                  <option value="">{{ (i18n.terms$ | async)?.selectOption }}</option>
                  <option value="married">{{ (i18n.terms$ | async)?.married }}</option>
                  <option value="single">{{ (i18n.terms$ | async)?.single }}</option>
                  <option value="widowed">{{ (i18n.terms$ | async)?.widowed }}</option>
                  <option value="divorced">{{ (i18n.terms$ | async)?.divorced }}</option>
                </select>
              </div>
              
              <!-- Spouse Information - Show only if married -->
              <div class="form-group" *ngIf="donor.maritalStatus === 'married'">
                <label>转专 /转 </label>
                <input type="text" class="form-control" [(ngModel)]="donor.wifeTitle" placeholder="转专 (专, 专拽, 专, ')">
              </div>
              <div class="form-group" *ngIf="donor.maritalStatus === 'married'">
                <label>砖 /转 </label>
                <input type="text" class="form-control" [(ngModel)]="donor.wifeName" placeholder="砖 ">
              </div>
              <div class="form-group" *ngIf="donor.maritalStatus === 'married'">
                <label>{{ (i18n.terms$ | async)?.spouseName }}</label>
                <input type="text" class="form-control" [(ngModel)]="donor.spouseName" [placeholder]="(i18n.terms$ | async)?.spouseName">
              </div>
            </div>
          </div>
          
          <!-- Family Tree Card -->
          <div class="info-card family-tree-card">
            <div class="card-header">
              <mat-icon class="card-icon">account_tree</mat-icon>
              <h4>注抓 砖驻</h4>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>砖 </label>
                <input type="text" class="form-control" [(ngModel)]="donor.fatherName" placeholder="砖 ">
              </div>
              <div class="form-group" *ngIf="donor.maritalStatus === 'married'">
                <label>砖 转</label>
                <input type="text" class="form-control" [(ngModel)]="donor.fatherInLawName" placeholder="砖 转">
              </div>
            </div>
          </div>
          
          <!-- Family Connection Card -->
          <div class="info-card family-connection-card">
            <div class="card-header">
              <mat-icon class="card-icon">people_outline</mat-icon>
              <h4>拽砖专 砖驻转</h4>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label>住 拽砖专 砖驻转</label>
                <input type="text" class="form-control" [(ngModel)]="donor.familyConnection" placeholder=" 砖,  砖, 专 砖, 转 砖 '">
              </div>
              <div class="form-group full-width">
                <label>注专转 住驻转 注 拽砖专 砖驻转</label>
                <textarea class="form-control" [(ngModel)]="donor.familyConnectionNotes" placeholder="驻专 住驻 注 拽砖专, 住专 砖驻转转, '" rows="3"></textarea>
              </div>
            </div>
          </div>
          
          <!-- Family Contact Card -->
          <div class="info-card family-contact-card">
            <div class="card-header">
              <mat-icon class="card-icon">phone</mat-icon>
              <h4>驻专 转拽砖专转 砖驻转</h4>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>{{ (i18n.terms$ | async)?.homePhone }}</label>
                <input type="tel" class="form-control" [(ngModel)]="donor.homePhone" [placeholder]="(i18n.terms$ | async)?.homePhone">
              </div>
              <div class="form-group">
                <label>{{ (i18n.terms$ | async)?.mobilePhone }}</label>
                <input type="tel" class="form-control" [(ngModel)]="donor.mobilePhone" [placeholder]="(i18n.terms$ | async)?.mobilePhone">
              </div>
            </div>
          </div>
          
          <!-- 转专 砖 -->
          <div class="personal-dates-section">
            <div class="section-header">
              <h4>{{ (i18n.terms$ | async)?.personalDates || '转专 砖' }}</h4>
              <button class="mat-fab-mini" (click)="openAddDateDialog()" title="住祝 转专 转 砖转">
                <span class="fab-icon">+</span>
              </button>
            </div>
            
            <div class="dates-container" [class.scrollable]="(customPersonalDates.length + 3) > 5">
              <!-- Empty state message when no personal events exist -->
              <div *ngIf="donorEvents.length === 0 && customPersonalDates.length === 0" class="empty-events-message">
                <p> 爪 专注 砖 转专 , 住驻转 专注 砖 抓 注 +</p>
              </div>
              
              <!-- Donor Events displayed with simple date inputs -->
              <div *ngFor="let donorEvent of donorEvents; trackBy: trackDonorEventById" class="form-group full-width custom-date-item">
                <label>{{donorEvent.event?.description || '专注'}}</label>
                <input type="date" class="form-control" [(ngModel)]="donorEvent.hebrewDate">
                <button 
                  *ngIf="!donorEvent.event?.isRequired" 
                  class="remove-date-btn" 
                  (click)="removeDonorEvent(donorEvent)" 
                  title="住专 专注">
                  
                </button>
              </div>
              
              <!-- Custom Dates -->
              <div class="form-group full-width custom-date-item" *ngFor="let customDate of customPersonalDates; let i = index">
                <label>{{customDate.name}}</label>
                <input type="date" class="form-control" [(ngModel)]="customDate.date">
                <button class="remove-date-btn" (click)="removeCustomDate(i)" title="住专 转专">
                  
                </button>
              </div>
            </div>
          </div>

          
          <!-- Dialog for adding event or custom date -->
          <div class="custom-date-dialog" *ngIf="showAddDateDialog">
            <div class="dialog-backdrop" (click)="closeAddDateDialog()"></div>
            <div class="dialog-content events-table-dialog">
              <h4>住祝 专注  转专 转 砖转</h4>
              
              <!-- Search Section -->
              <div class="search-section">
                <div class="search-input-group">
                  <input 
                    type="text" 
                    class="form-control search-input" 
                    [(ngModel)]="eventSearchTerm"
                    placeholder="驻砖 专注...">
                  <button *ngIf="eventSearchTerm" class="clear-search-btn" (click)="clearSearch()"></button>
                </div>
                <button class="btn btn-success add-new-btn" (click)="toggleCreateNewEvent()">
                  {{ showCreateNewEvent ? '' : '+ 爪专转 专注 砖' }}
                </button>
              </div>

              <!-- Create New Event Section -->
              <div class="create-event-section" *ngIf="showCreateNewEvent">
                <h5>爪专转 专注 砖:</h5>
                <div class="new-event-form">
                  <input 
                    type="text" 
                    class="form-control" 
                    [(ngModel)]="newEventDescription"
                    placeholder="转专 专注 砖..."
                    (keyup.enter)="createNewEvent()">
                  <button class="btn btn-primary" (click)="createNewEvent()" [disabled]="!newEventDescription.trim()">
                    爪专 砖专
                  </button>
                </div>
              </div>

              <!-- Events Table -->
              <div class="events-table-section" *ngIf="!showCreateNewEvent">
                <div class="events-table-container">
                  <table class="events-table" *ngIf="getFilteredEvents().length > 0">
                    <thead>
                      <tr>
                        <th>转专 专注</th>
                        <th>驻注转</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let event of getFilteredEvents()">
                        <td>{{ event.description }}</td>
                        <td>
                          <button class="btn btn-small btn-primary" (click)="addEventFromDialog(event)">
                            专
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  
                  <!-- Empty state when no events found -->
                  <div class="no-events-found" *ngIf="getFilteredEvents().length === 0">
                    <p *ngIf="eventSearchTerm"> 爪 专注 转 驻砖 "{{ eventSearchTerm }}"</p>
                    <p *ngIf="!eventSearchTerm"> 专注 </p>
                    <button class="btn btn-primary" (click)="toggleCreateNewEvent()">爪专 专注 砖</button>
                  </div>
                </div>
              </div>

              <!-- Legacy Custom Date Section -->
              <div class="custom-date-section" *ngIf="!showCreateNewEvent">
                <div class="divider"></div>
                <h5>住祝 转专 转 砖转:</h5>
                <input 
                  type="text" 
                  class="form-control" 
                  [(ngModel)]="newDateName" 
                  placeholder="砖 专注 (:  转 )"
                  (keyup.enter)="addCustomDate()">
                <button class="btn btn-secondary" (click)="addCustomDate()" [disabled]="!newDateName.trim()">
                  住祝 转专 转
                </button>
              </div>
              
              <div class="dialog-actions">
                <button class="btn btn-secondary" (click)="closeAddDateDialog()">住专</button>
              </div>
            </div>
          </div>
        </div>

        <!-- 专转 注转转 -->
        <div class="section company-organization">
          <div class="section-header">
            <h3>专转 注转转</h3>
            <button class="btn btn-success btn-sm" (click)="addCompany()" title="住祝 专/注转">
              + 住祝 专/注转
            </button>
          </div>
          
          <!-- Empty state message when no companies exist -->
          <div *ngIf="!donor.companies || donor.companies.length === 0" class="empty-message">
            <p> 爪 专转  注转转 转专 . 住驻转 专/注转 砖 抓 注 驻转专 注.</p>
          </div>
          
          <!-- Companies list -->
          <div *ngFor="let company of donor.companies; let i = index; trackBy: trackByCompanyId" class="company-item">
            <div class="company-header">
              <h4>专/注转 {{i + 1}}</h4>
              <button class="btn btn-danger btn-sm" (click)="removeCompany(i)" title="住专 专">
                 住专
              </button>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label>砖 专/注转</label>
                <input type="text" class="form-control" [(ngModel)]="company.name" placeholder="砖 专  注转">
              </div>
              <div class="form-group">
                <label>住驻专 专/注转</label>
                <input type="text" class="form-control" [(ngModel)]="company.number" placeholder="住驻专 专砖">
              </div>
              <div class="form-group">
                <label>转驻拽</label>
                <input type="text" class="form-control" [(ngModel)]="company.role" placeholder="转驻拽 专/注转">
              </div>
              <div class="form-group">
                <label>转专 专</label>
                <input type="text" class="form-control" [(ngModel)]="company.website" placeholder="转转 转专 专">
              </div>
            </div>
            
            <h5>转转 专/注转</h5>
            <div class="form-grid">
              <div class="form-group">
                <label>专 1</label>
                <input type="text" class="form-control" [(ngModel)]="company.street1" placeholder="专 住驻专">
              </div>
              <div class="form-group">
                <label>专 2</label>
                <input type="text" class="form-control" [(ngModel)]="company.street2" placeholder="住/拽/砖专">
              </div>
              <div class="form-group">
                <label>砖</label>
                <input type="text" class="form-control" [(ngModel)]="company.neighborhood" placeholder="砖">
              </div>
              <div class="form-group">
                <label>注专</label>
                <input type="text" class="form-control" [(ngModel)]="company.city" placeholder="注专">
              </div>
              <div class="form-group">
                <label>拽</label>
                <input type="text" class="form-control" [(ngModel)]="company.zipCode" placeholder="拽">
              </div>
              <div class="form-group">
                <label></label>
                <input type="text" class="form-control" [(ngModel)]="company.country" placeholder="">
              </div>
              <div class="form-group">
                <label>驻</label>
                <input type="tel" class="form-control" [(ngModel)]="company.phone" placeholder="驻 专/注转">
              </div>
              <div class="form-group">
                <label>"</label>
                <input type="email" class="form-control" [(ngModel)]="company.email" placeholder="状 专/注转">
              </div>
            </div>
          </div>
        </div>

        <!-- 拽专转 专转 -->
        <div class="section categories-levels">
          <h3>拽专转 专转</h3>
          
          <!-- Donor Level Card -->
          <div class="info-card donor-level-card">
            <div class="card-header">
              <mat-icon class="card-icon">star</mat-icon>
              <h4>专转 转专</h4>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>{{ (i18n.terms$ | async)?.level }}</label>
                <select class="form-control level-select" [(ngModel)]="donor.level">
                  <option value="">{{ (i18n.terms$ | async)?.selectOption }}</option>
                  <option value="platinum" class="platinum-option"> {{ (i18n.terms$ | async)?.platinum }}</option>
                  <option value="gold" class="gold-option"> {{ (i18n.terms$ | async)?.gold }}</option>
                  <option value="silver" class="silver-option"> {{ (i18n.terms$ | async)?.silver }}</option>
                  <option value="regular" class="regular-option"> {{ (i18n.terms$ | async)?.regular }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>{{ (i18n.terms$ | async)?.circle }}</label>
                <input type="text" class="form-control" [(ngModel)]="donor.circle" [placeholder]="(i18n.terms$ | async)?.circle">
              </div>
              <div class="form-group">
                <label>{{ (i18n.terms$ | async)?.preferredLanguage }}</label>
                <select class="form-control language-select" [(ngModel)]="donor.preferredLanguage">
                  <option value="he"> {{ (i18n.terms$ | async)?.hebrew }}</option>
                  <option value="en">吼 {{ (i18n.terms$ | async)?.english }}</option>
                  <option value="yi">★ {{ (i18n.terms$ | async)?.yiddish }}</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Donor Type Card -->
          <div class="info-card donor-type-card">
            <div class="card-header">
              <mat-icon class="card-icon">group</mat-icon>
              <h4>驻 转专</h4>
            </div>
            <div class="donor-type-grid">
              <div class="type-option" [class.active]="donor.isAnash">
                <label class="type-card">
                  <input type="checkbox" [(ngModel)]="donor.isAnash" class="type-checkbox">
                  <div class="type-content">
                    <mat-icon class="type-icon">synagogue</mat-icon>
                    <span class="type-label">"砖</span>
                    <small class="type-desc">专 拽</small>
                  </div>
                </label>
              </div>
              
              <div class="type-option" [class.active]="donor.isAlumni">
                <label class="type-card">
                  <input type="checkbox" [(ngModel)]="donor.isAlumni" class="type-checkbox">
                  <div class="type-content">
                    <mat-icon class="type-icon">school</mat-icon>
                    <span class="type-label">专</span>
                    <small class="type-desc">专 住</small>
                  </div>
                </label>
              </div>
              
              <div class="type-option" [class.active]="donor.isOtherConnection">
                <label class="type-card">
                  <input type="checkbox" [(ngModel)]="donor.isOtherConnection" (change)="onOtherConnectionChange()" class="type-checkbox">
                  <div class="type-content">
                    <mat-icon class="type-icon">people_alt</mat-icon>
                    <span class="type-label">拽砖专 专</span>
                    <small class="type-desc">拽砖专 砖驻转  专</small>
                  </div>
                </label>
              </div>
            </div>
            
            <!-- Show relationship fields only when "拽砖专 专" is checked -->
            <div class="relationship-details" *ngIf="donor.isOtherConnection">
              <div class="form-grid">
                <div class="form-group">
                  <label>住 拽砖专</label>
                  <input type="text" class="form-control" [(ngModel)]="donor.relationshipType" 
                         placeholder=" / 住 /  / 专...">
                </div>
                <div class="form-group">
                  <label>拽砖专 砖 </label>
                  <input type="text" class="form-control" [(ngModel)]="donor.relationshipOf" 
                         placeholder="砖  砖转专 拽砖专 ">
                </div>
              </div>
            </div>
          </div>
          
          <!-- Interests Card -->
          <div class="info-card interests-card">
            <div class="card-header">
              <mat-icon class="card-icon">interests</mat-icon>
              <h4>转 注</h4>
            </div>
            <div class="form-grid">
              <div class="form-group full-width">
                <label>专砖 砖 注</label>
                <textarea class="form-control interests-textarea" [(ngModel)]="donor.interests" 
                          placeholder="砖 砖注 转 转专: 转专, 住转, , 拽..." rows="3"></textarea>
              </div>
              <div class="form-group full-width">
                <label>转 驻注转</label>
                <textarea class="form-control hobbies-textarea" [(ngModel)]="donor.hobbies" 
                          placeholder="转 驻注转 驻: 住驻专, 住拽, 拽专, 住注转..." rows="3"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- 注驻转 爪专转 拽砖专 -->
        <div class="section contact-preferences">
          <h3>{{ (i18n.terms$ | async)?.contactPreferences }}</h3>
          
          <!-- Reception Hours Card -->
          <div class="info-card reception-card">
            <div class="card-header">
              <mat-icon class="card-icon">schedule</mat-icon>
              <h4>砖注转 拽</h4>
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.receptionHours }}</label>
              <input type="text" class="form-control modern-input" [(ngModel)]="donor.receptionHours" 
                     placeholder=": 09:00-17:00  砖注转 注专">
            </div>
          </div>
          
          <!-- Preferred Days Card -->
          <div class="info-card days-card">
            <div class="card-header">
              <mat-icon class="card-icon">calendar_month</mat-icon>
              <h4>{{ (i18n.terms$ | async)?.preferredDays }}</h4>
            </div>
            <div class="days-grid">
              <div class="day-option" [class.active]="donor.sundayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.sundayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.sunday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.mondayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.mondayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.monday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.tuesdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.tuesdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.tuesday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.wednesdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.wednesdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.wednesday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.thursdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.thursdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.thursday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.fridayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.fridayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.friday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
              
              <div class="day-option" [class.active]="donor.saturdayAvailable">
                <label class="day-card">
                  <input type="checkbox" [(ngModel)]="donor.saturdayAvailable" class="day-checkbox">
                  <div class="day-content">
                    <span class="day-name">{{ (i18n.terms$ | async)?.saturday }}</span>
                    <div class="day-indicator"></div>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Contact Methods Card -->
          <div class="info-card contact-methods-card">
            <div class="card-header">
              <mat-icon class="card-icon">contact_phone</mat-icon>
              <h4>{{ (i18n.terms$ | async)?.preferredContactMethods }}</h4>
            </div>
            <div class="contact-methods-grid">
              <div class="contact-method" [class.active]="donor.preferPhone">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferPhone" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">phone</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.phoneContact }}</span>
                    <small class="method-desc">砖转 驻</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferEmail">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferEmail" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">email</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.emailContact }}</span>
                    <small class="method-desc">注转 "</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferSMS">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferSMS" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">sms</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.smsContact }}</span>
                    <small class="method-desc">注转 拽住</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferHomeVisit">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferHomeVisit" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">home</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.homeVisit }}</span>
                    <small class="method-desc">拽专 转</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-method" [class.active]="donor.preferOfficeVisit">
                <label class="method-card">
                  <input type="checkbox" [(ngModel)]="donor.preferOfficeVisit" class="method-checkbox">
                  <div class="method-content">
                    <mat-icon class="method-icon">business</mat-icon>
                    <span class="method-label">{{ (i18n.terms$ | async)?.officeVisit }}</span>
                    <small class="method-desc">拽专 砖专</small>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Contact Style Card -->
          <div class="info-card contact-style-card">
            <div class="card-header">
              <mat-icon class="card-icon">psychology</mat-icon>
              <h4>驻 爪专转 拽砖专</h4>
            </div>
            <div class="contact-style-grid">
              <div class="contact-style" [class.active]="donor.requirePhoneCoordination">
                <label class="style-card">
                  <input type="checkbox" [(ngModel)]="donor.requirePhoneCoordination" class="style-checkbox">
                  <div class="style-content">
                    <mat-icon class="style-icon">phone_callback</mat-icon>
                    <span class="style-label">转 驻</span>
                    <small class="style-desc">转 专砖</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-style" [class.active]="donor.preferSpecialTimes">
                <label class="style-card">
                  <input type="checkbox" [(ngModel)]="donor.preferSpecialTimes" class="style-checkbox">
                  <div class="style-content">
                    <mat-icon class="style-icon">celebration</mat-icon>
                    <span class="style-label"> </span>
                    <small class="style-desc">驻住/住转</small>
                  </div>
                </label>
              </div>
              
              <div class="contact-style" [class.active]="donor.preferPublicReception">
                <label class="style-card">
                  <input type="checkbox" [(ngModel)]="donor.preferPublicReception" class="style-checkbox">
                  <div class="style-content">
                    <mat-icon class="style-icon">groups</mat-icon>
                    <span class="style-label">拽 转</span>
                    <small class="style-desc">拽转 拽</small>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Additional Preferences Card -->
          <div class="info-card additional-prefs-card">
            <div class="card-header">
              <mat-icon class="card-icon">tune</mat-icon>
              <h4>注驻转 住驻转</h4>
            </div>
            <div class="additional-prefs-grid">
              <div class="pref-option" [class.active]="donor.emailOnlyCorrespondence">
                <label class="pref-card">
                  <input type="checkbox" [(ngModel)]="donor.emailOnlyCorrespondence" class="pref-checkbox">
                  <div class="pref-content">
                    <mat-icon class="pref-icon">email</mat-icon>
                    <span class="pref-label">" </span>
                    <small class="pref-desc">砖转 转 </small>
                  </div>
                </label>
              </div>
              
              <div class="pref-option" [class.active]="donor.autoAddToLocationEvents">
                <label class="pref-card">
                  <input type="checkbox" [(ngModel)]="donor.autoAddToLocationEvents" class="pref-checkbox">
                  <div class="pref-content">
                    <mat-icon class="pref-icon">location_on</mat-icon>
                    <span class="pref-label">专注 </span>
                    <small class="pref-desc">住驻 驻 拽</small>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- 注驻转 转 -->
        <div class="section preferences">
          <h3>{{ (i18n.terms$ | async)?.generalPreferences }}</h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="donor.wantsUpdates">
                {{ (i18n.terms$ | async)?.wantsUpdates }}
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="donor.wantsTaxReceipts">
                {{ (i18n.terms$ | async)?.wantsTaxReceipts }}
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="donor.isActive">
                {{ (i18n.terms$ | async)?.active }}
              </label>
            </div>
            <div class="form-group full-width">
              <label>{{ (i18n.terms$ | async)?.generalNotes }}</label>
              <textarea class="form-control" rows="4" [(ngModel)]="donor.notes" [placeholder]="(i18n.terms$ | async)?.enterNotesPlaceholder"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="footer-actions-left">
        <!-- Quick Actions -->
        <button mat-stroked-button 
                class="quick-action-btn" 
                *ngIf="!isNewDonor"
                (click)="openGifts()" 
                title="转转">
          <mat-icon>redeem</mat-icon>
          转转
        </button>
        <button mat-stroked-button 
                class="quick-action-btn" 
                *ngIf="!isNewDonor"
                (click)="openDonations()" 
                title="转专转">
          <mat-icon>attach_money</mat-icon>
          转专转
        </button>
        <button mat-stroked-button 
                class="quick-action-btn" 
                *ngIf="!isNewDonor"
                (click)="openReceipts()" 
                title="爪转 拽转">
          <mat-icon>receipt_long</mat-icon>
          "拽
        </button>
        
        <!-- Divider -->
        <div class="footer-divider" *ngIf="!isNewDonor"></div>
        
        <!-- Admin Actions -->
        <button mat-stroked-button 
                color="warn" 
                *ngIf="!isNewDonor && donor?.isActive" 
                (click)="deactivateDonor()"
                class="action-button">
          <mat-icon>block</mat-icon>
          {{ (i18n.terms$ | async)?.deactivate }}
        </button>
        <button mat-stroked-button 
                color="primary" 
                *ngIf="!isNewDonor && !donor?.isActive" 
                (click)="activateDonor()"
                class="action-button">
          <mat-icon>check_circle</mat-icon>
          {{ (i18n.terms$ | async)?.activate }}
        </button>
        <button mat-stroked-button 
                color="warn" 
                *ngIf="!isNewDonor" 
                (click)="deleteDonor()"
                class="action-button">
          <mat-icon>delete</mat-icon>
          {{ (i18n.terms$ | async)?.delete }}
        </button>
      </div>
      <div class="footer-actions-right">
        <button mat-stroked-button 
                (click)="closeModal()"
                class="cancel-button">
          <mat-icon>close</mat-icon>
          {{ (i18n.terms$ | async)?.cancel }}
        </button>
        <button mat-raised-button 
                color="primary" 
                (click)="saveDonor()"
                class="save-button"
                [disabled]="loading">
          <mat-icon>save</mat-icon>
          {{ (i18n.terms$ | async)?.saveDonor }}
        </button>
      </div>
    </div>
  </div>
</div>
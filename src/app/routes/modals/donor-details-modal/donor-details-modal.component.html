<!-- Donor Details Modal -->
<div class="modal-overlay">
  <div class="modal-content donor-details-modal">
    <div class="modal-header">
      <h2>{{isNewDonor ? ((i18n.terms$ | async)?.addNewDonor) : ((i18n.terms$ | async)?.donorDetails)}}</h2>
      <button class="modal-close">&times;</button>
    </div>
    
    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="loading-spinner">{{ (i18n.terms$ | async)?.loadingData }}</div>
    </div>
    
    <div class="modal-body">
      <div class="details-grid" *ngIf="donor && !loading">
        <!-- פרטים אישיים -->
        <div class="section personal-details">
          <h3>{{ (i18n.terms$ | async)?.personalDetails }}</h3>
          <div class="form-grid">
            <!-- שורה ראשונה: תואר, שם פרטי, שם משפחה, סיומת -->
            <div class="form-group">
              <label>תואר</label>
              <input type="text" class="form-control" [(ngModel)]="donor.title" placeholder="תואר (כגון: רב, ד&quot;ר)">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.firstName }} *</label>
              <input type="text" class="form-control" [(ngModel)]="donor.firstName" [placeholder]="(i18n.terms$ | async)?.firstName">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.lastName }} *</label>
              <input type="text" class="form-control" [(ngModel)]="donor.lastName" [placeholder]="(i18n.terms$ | async)?.lastName">
            </div>
            <div class="form-group">
              <label>סיומת</label>
              <input type="text" class="form-control" [(ngModel)]="donor.suffix" placeholder="סיומת (כגון: הי&quot;ו)">
            </div>
            
            <!-- שורה שנייה: כינוי, שם באנגלית -->
            <div class="form-group">
              <label>כינוי</label>
              <input type="text" class="form-control" [(ngModel)]="donor.nickname" placeholder="כינוי">
            </div>
            <div class="form-group">
              <label>שם פרטי באנגלית</label>
              <input type="text" class="form-control" [(ngModel)]="donor.firstNameEnglish" placeholder="First Name">
            </div>
            <div class="form-group">
              <label>שם משפחה באנגלית</label>
              <input type="text" class="form-control" [(ngModel)]="donor.lastNameEnglish" placeholder="Last Name">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.idNumber }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.idNumber" [placeholder]="(i18n.terms$ | async)?.idNumber">
            </div>
            
            <!-- שורה שלישית: דוא&quot;ל, טלפונים -->
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.email }}</label>
              <input type="email" class="form-control" [(ngModel)]="donor.email" [placeholder]="(i18n.terms$ | async)?.email">
            </div>
            <div class="form-group">
              <label>קידומת בינלאומית</label>
              <select class="form-control" [(ngModel)]="donor.internationalPrefix">
                <option value="+972">+972 (ישראל)</option>
                <option value="+1">+1 (ארה&quot;ב/קנדה)</option>
                <option value="+44">+44 (בריטניה)</option>
                <option value="+33">+33 (צרפת)</option>
                <option value="+49">+49 (גרמניה)</option>
              </select>
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.phone }}</label>
              <input type="tel" class="form-control" [(ngModel)]="donor.phone" [placeholder]="(i18n.terms$ | async)?.phone">
            </div>
            <div class="form-group">
              <label>טלפון נוסף</label>
              <input type="tel" class="form-control" [(ngModel)]="donor.additionalPhone" placeholder="טלפון נוסף">
            </div>
            
            <!-- Birth Date with Modern Hebrew-Gregorian picker -->
            <div class="form-group full-width">
              <app-modern-dual-date-picker
                [(ngModel)]="donor.birthDate"
                [label]="(i18n.terms$ | async)?.birthDate || 'תאריך לידה'"
                (dateChange)="onDateChange('birthDate', $event)">
              </app-modern-dual-date-picker>
            </div>
          </div>
        </div>
        
        <!-- כתובת מגורים -->
        <div class="section address-section">
          <h3>כתובת מגורים</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>רחוב 1</label>
              <input type="text" class="form-control" [(ngModel)]="donor.street1" placeholder="רחוב ומספר">
            </div>
            <div class="form-group">
              <label>רחוב 2</label>
              <input type="text" class="form-control" [(ngModel)]="donor.street2" placeholder="כניסה/דירה">
            </div>
            <div class="form-group">
              <label>שכונה</label>
              <input type="text" class="form-control" [(ngModel)]="donor.neighborhood" placeholder="שכונה">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.city }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.city" [placeholder]="(i18n.terms$ | async)?.city">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.zipCode }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.zipCode" [placeholder]="(i18n.terms$ | async)?.zipCode">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.country }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.country" [placeholder]="(i18n.terms$ | async)?.country">
            </div>
          </div>
        </div>
        
        <!-- כתובת נופש -->
        <div class="section vacation-address-section">
          <h3>כתובת נופש</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <label>כתובת נופש</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationAddress" placeholder="כתובת מלאה">
            </div>
            <div class="form-group">
              <label>עיר נופש</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationCity" placeholder="עיר">
            </div>
            <div class="form-group">
              <label>מיקוד נופש</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationZipCode" placeholder="מיקוד">
            </div>
            <div class="form-group">
              <label>מדינה נופש</label>
              <input type="text" class="form-control" [(ngModel)]="donor.vacationCountry" placeholder="מדינה">
            </div>
          </div>
        </div>

        <!-- מידע משפחתי -->
        <div class="section family-info">
          <h3>{{ (i18n.terms$ | async)?.familyInformation }}</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>תואר האשה</label>
              <input type="text" class="form-control" [(ngModel)]="donor.wifeTitle" placeholder="תואר האשה">
            </div>
            <div class="form-group">
              <label>שם האשה</label>
              <input type="text" class="form-control" [(ngModel)]="donor.wifeName" placeholder="שם האשה">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.spouseName }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.spouseName" [placeholder]="(i18n.terms$ | async)?.spouseName">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.maritalStatus }}</label>
              <select class="form-control" [(ngModel)]="donor.maritalStatus">
                <option value="">{{ (i18n.terms$ | async)?.selectOption }}</option>
                <option value="married">{{ (i18n.terms$ | async)?.married }}</option>
                <option value="single">{{ (i18n.terms$ | async)?.single }}</option>
                <option value="widowed">{{ (i18n.terms$ | async)?.widowed }}</option>
                <option value="divorced">{{ (i18n.terms$ | async)?.divorced }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>שם האב</label>
              <input type="text" class="form-control" [(ngModel)]="donor.fatherName" placeholder="שם האב">
            </div>
            <div class="form-group">
              <label>שם החותן</label>
              <input type="text" class="form-control" [(ngModel)]="donor.fatherInLawName" placeholder="שם החותן">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.homePhone }}</label>
              <input type="tel" class="form-control" [(ngModel)]="donor.homePhone" [placeholder]="(i18n.terms$ | async)?.homePhone">
            </div>
            <div class="form-group full-width">
              <label>קישור משפחתי</label>
              <input type="text" class="form-control" [(ngModel)]="donor.familyConnection" placeholder="קישור משפחתי (אח של, דוד של, תלמיד בישיבה וכו')">
            </div>
            <div class="form-group full-width">
              <label>הערות קישור משפחתי</label>
              <textarea class="form-control" [(ngModel)]="donor.familyConnectionNotes" placeholder="הערות נוספות על הקישור המשפחתי" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.mobilePhone }}</label>
              <input type="tel" class="form-control" [(ngModel)]="donor.mobilePhone" [placeholder]="(i18n.terms$ | async)?.mobilePhone">
            </div>
          </div>
          
          <!-- תאריכים אישיים -->
          <div class="personal-dates-section">
            <div class="section-header">
              <h4>{{ (i18n.terms$ | async)?.personalDates || 'תאריכים אישיים' }}</h4>
              <button class="mat-fab-mini" (click)="openAddDateDialog()" title="הוסף תאריך מותאם אישית">
                <span class="fab-icon">+</span>
              </button>
            </div>
            
            <div class="dates-container" [class.scrollable]="(customPersonalDates.length + 3) > 5">
              <!-- Empty state message when no personal events exist -->
              <div *ngIf="donorEvents.length === 0 && customPersonalDates.length === 0" class="empty-events-message">
                <p>לא נמצאו אירועים אישיים לתורם זה, להוספת אירוע יש ללחוץ על +</p>
              </div>
              
              <!-- Donor Events displayed as date pickers -->
              <div *ngFor="let donorEvent of donorEvents; trackBy: trackDonorEventById" class="form-group full-width custom-date-item">
                <app-modern-dual-date-picker
                  [(ngModel)]="donorEvent.hebrewDate"
                  [label]="donorEvent.event?.description || 'אירוע'"
                  (dateChange)="onDonorEventDateChange(donorEvent, $event)">
                </app-modern-dual-date-picker>
                <button 
                  *ngIf="!donorEvent.event?.isRequired" 
                  class="remove-date-btn" 
                  (click)="removeDonorEvent(donorEvent)" 
                  title="הסר אירוע">
                  ×
                </button>
              </div>
              
              <!-- Custom Dates -->
              <div class="form-group full-width custom-date-item" *ngFor="let customDate of customPersonalDates; let i = index">
                <app-modern-dual-date-picker
                  [(ngModel)]="customDate.date"
                  [label]="customDate.name"
                  (dateChange)="onCustomDateChange(i, $event)">
                </app-modern-dual-date-picker>
                <button class="remove-date-btn" (click)="removeCustomDate(i)" title="הסר תאריך">
                  ×
                </button>
              </div>
            </div>
          </div>

          
          <!-- Dialog for adding event or custom date -->
          <div class="custom-date-dialog" *ngIf="showAddDateDialog">
            <div class="dialog-backdrop" (click)="closeAddDateDialog()"></div>
            <div class="dialog-content events-table-dialog">
              <h4>הוסף אירוע או תאריך מותאם אישית</h4>
              
              <!-- Search Section -->
              <div class="search-section">
                <div class="search-input-group">
                  <input 
                    type="text" 
                    class="form-control search-input" 
                    [(ngModel)]="eventSearchTerm"
                    placeholder="חפש אירוע...">
                  <button *ngIf="eventSearchTerm" class="clear-search-btn" (click)="clearSearch()">×</button>
                </div>
                <button class="btn btn-success add-new-btn" (click)="toggleCreateNewEvent()">
                  {{ showCreateNewEvent ? 'ביטול' : '+ יצירת אירוע חדש' }}
                </button>
              </div>

              <!-- Create New Event Section -->
              <div class="create-event-section" *ngIf="showCreateNewEvent">
                <h5>יצירת אירוע חדש:</h5>
                <div class="new-event-form">
                  <input 
                    type="text" 
                    class="form-control" 
                    [(ngModel)]="newEventDescription"
                    placeholder="תיאור האירוע החדש..."
                    (keyup.enter)="createNewEvent()">
                  <button class="btn btn-primary" (click)="createNewEvent()" [disabled]="!newEventDescription.trim()">
                    יצור ושמור
                  </button>
                </div>
              </div>

              <!-- Events Table -->
              <div class="events-table-section" *ngIf="!showCreateNewEvent">
                <div class="events-table-container">
                  <table class="events-table" *ngIf="getFilteredEvents().length > 0">
                    <thead>
                      <tr>
                        <th>תיאור האירוע</th>
                        <th>פעולות</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let event of getFilteredEvents()">
                        <td>{{ event.description }}</td>
                        <td>
                          <button class="btn btn-small btn-primary" (click)="addEventFromDialog(event)">
                            בחר
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  
                  <!-- Empty state when no events found -->
                  <div class="no-events-found" *ngIf="getFilteredEvents().length === 0">
                    <p *ngIf="eventSearchTerm">לא נמצאו אירועים התואמים לחיפוש "{{ eventSearchTerm }}"</p>
                    <p *ngIf="!eventSearchTerm">אין אירועים זמינים</p>
                    <button class="btn btn-primary" (click)="toggleCreateNewEvent()">יצור אירוע חדש</button>
                  </div>
                </div>
              </div>

              <!-- Legacy Custom Date Section -->
              <div class="custom-date-section" *ngIf="!showCreateNewEvent">
                <div class="divider">או</div>
                <h5>הוסף תאריך מותאם אישית:</h5>
                <input 
                  type="text" 
                  class="form-control" 
                  [(ngModel)]="newDateName" 
                  placeholder="שם האירוע (לדוגמה: יום הולדת בן)"
                  (keyup.enter)="addCustomDate()">
                <button class="btn btn-secondary" (click)="addCustomDate()" [disabled]="!newDateName.trim()">
                  הוסף תאריך מותאם
                </button>
              </div>
              
              <div class="dialog-actions">
                <button class="btn btn-secondary" (click)="closeAddDateDialog()">סגור</button>
              </div>
            </div>
          </div>
        </div>

        <!-- חברות ועמותות -->
        <div class="section company-organization">
          <div class="section-header">
            <h3>חברות ועמותות</h3>
            <button class="btn btn-success btn-sm" (click)="addCompany()" title="הוסף חברה/עמותה">
              + הוסף חברה/עמותה
            </button>
          </div>
          
          <!-- Empty state message when no companies exist -->
          <div *ngIf="!donor.companies || donor.companies.length === 0" class="empty-message">
            <p>לא נמצאו חברות או עמותות לתורם זה. להוספת חברה/עמותה יש ללחוץ על הכפתור למעלה.</p>
          </div>
          
          <!-- Companies list -->
          <div *ngFor="let company of donor.companies; let i = index; trackBy: trackByCompanyId" class="company-item">
            <div class="company-header">
              <h4>חברה/עמותה {{i + 1}}</h4>
              <button class="btn btn-danger btn-sm" (click)="removeCompany(i)" title="הסר חברה">
                × הסר
              </button>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label>שם החברה/עמותה</label>
                <input type="text" class="form-control" [(ngModel)]="company.name" placeholder="שם החברה או העמותה">
              </div>
              <div class="form-group">
                <label>מספר חברה/עמותה</label>
                <input type="text" class="form-control" [(ngModel)]="company.number" placeholder="מספר רישום">
              </div>
              <div class="form-group">
                <label>תפקיד</label>
                <input type="text" class="form-control" [(ngModel)]="company.role" placeholder="תפקיד בחברה/עמותה">
              </div>
              <div class="form-group">
                <label>אתר אינטרנט</label>
                <input type="text" class="form-control" [(ngModel)]="company.website" placeholder="כתובת אתר האינטרנט">
              </div>
            </div>
            
            <h5>כתובת החברה/עמותה</h5>
            <div class="form-grid">
              <div class="form-group">
                <label>רחוב 1</label>
                <input type="text" class="form-control" [(ngModel)]="company.street1" placeholder="רחוב ומספר">
              </div>
              <div class="form-group">
                <label>רחוב 2</label>
                <input type="text" class="form-control" [(ngModel)]="company.street2" placeholder="כניסה/קומה/משרד">
              </div>
              <div class="form-group">
                <label>שכונה</label>
                <input type="text" class="form-control" [(ngModel)]="company.neighborhood" placeholder="שכונה">
              </div>
              <div class="form-group">
                <label>עיר</label>
                <input type="text" class="form-control" [(ngModel)]="company.city" placeholder="עיר">
              </div>
              <div class="form-group">
                <label>מיקוד</label>
                <input type="text" class="form-control" [(ngModel)]="company.zipCode" placeholder="מיקוד">
              </div>
              <div class="form-group">
                <label>מדינה</label>
                <input type="text" class="form-control" [(ngModel)]="company.country" placeholder="מדינה">
              </div>
              <div class="form-group">
                <label>טלפון</label>
                <input type="tel" class="form-control" [(ngModel)]="company.phone" placeholder="טלפון החברה/עמותה">
              </div>
              <div class="form-group">
                <label>דוא"ל</label>
                <input type="email" class="form-control" [(ngModel)]="company.email" placeholder="דוא״ל החברה/עמותה">
              </div>
            </div>
          </div>
        </div>

        <!-- קטגוריות ורמות -->
        <div class="section categories-levels">
          <h3>קטגוריות ורמות</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.level }}</label>
              <select class="form-control" [(ngModel)]="donor.level">
                <option value="">{{ (i18n.terms$ | async)?.selectOption }}</option>
                <option value="platinum">{{ (i18n.terms$ | async)?.platinum }}</option>
                <option value="gold">{{ (i18n.terms$ | async)?.gold }}</option>
                <option value="silver">{{ (i18n.terms$ | async)?.silver }}</option>
                <option value="regular">{{ (i18n.terms$ | async)?.regular }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.circle }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.circle" [placeholder]="(i18n.terms$ | async)?.circle">
            </div>
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.preferredLanguage }}</label>
              <select class="form-control" [(ngModel)]="donor.preferredLanguage">
                <option value="he">{{ (i18n.terms$ | async)?.hebrew }}</option>
                <option value="en">{{ (i18n.terms$ | async)?.english }}</option>
                <option value="ar">{{ (i18n.terms$ | async)?.arabic }}</option>
              </select>
            </div>
          </div>
          
          <h4>אפיון תורם</h4>
          <div class="form-grid">
            <div class="form-group full-width">
              <label>סוג תורם</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.isAnash">
                  אנ"ש
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.isAlumni">
                  בוגר
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.isOtherConnection" (change)="onOtherConnectionChange()">
                  קשר אחר
                </label>
              </div>
            </div>
            
            <!-- Show relationship fields only when "קשר אחר" is checked -->
            <div class="form-group" *ngIf="donor.isOtherConnection">
              <label>סוג קשר</label>
              <input type="text" class="form-control" [(ngModel)]="donor.relationshipType" 
                     placeholder="אבא / סבא / ידיד / אחר...">
            </div>
            
            <div class="form-group" *ngIf="donor.isOtherConnection">
              <label>קשר של</label>
              <input type="text" class="form-control" [(ngModel)]="donor.relationshipOf" 
                     placeholder="שם האדם שהתורם קשור אליו">
            </div>
            
            <div class="form-group full-width">
              <label>ריגושים</label>
              <textarea class="form-control" [(ngModel)]="donor.interests" 
                        placeholder="נושאים שמעניינים את התורם" rows="2"></textarea>
            </div>
            
            <div class="form-group full-width">
              <label>תחביבים</label>
              <textarea class="form-control" [(ngModel)]="donor.hobbies" 
                        placeholder="תחביבים ופעילויות פנאי" rows="2"></textarea>
            </div>
          </div>
        </div>

        <!-- העדפות יצירת קשר -->
        <div class="section contact-preferences">
          <h3>{{ (i18n.terms$ | async)?.contactPreferences }}</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>{{ (i18n.terms$ | async)?.receptionHours }}</label>
              <input type="text" class="form-control" [(ngModel)]="donor.receptionHours" [placeholder]="(i18n.terms$ | async)?.receptionHours">
            </div>
            <div class="form-group full-width">
              <label>{{ (i18n.terms$ | async)?.preferredDays }}</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.sundayAvailable">
                  {{ (i18n.terms$ | async)?.sunday }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.mondayAvailable">
                  {{ (i18n.terms$ | async)?.monday }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.tuesdayAvailable">
                  {{ (i18n.terms$ | async)?.tuesday }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.wednesdayAvailable">
                  {{ (i18n.terms$ | async)?.wednesday }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.thursdayAvailable">
                  {{ (i18n.terms$ | async)?.thursday }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.fridayAvailable">
                  {{ (i18n.terms$ | async)?.friday }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.saturdayAvailable">
                  {{ (i18n.terms$ | async)?.saturday }}
                </label>
              </div>
            </div>
            <div class="form-group full-width">
              <label>{{ (i18n.terms$ | async)?.preferredContactMethods }}</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.preferPhone">
                  {{ (i18n.terms$ | async)?.phoneContact }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.preferEmail">
                  {{ (i18n.terms$ | async)?.emailContact }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.preferSMS">
                  {{ (i18n.terms$ | async)?.smsContact }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.preferHomeVisit">
                  {{ (i18n.terms$ | async)?.homeVisit }}
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.preferOfficeVisit">
                  {{ (i18n.terms$ | async)?.officeVisit }}
                </label>
              </div>
            </div>
            <div class="form-group full-width">
              <label>אופן יצירת הקשר</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.requirePhoneCoordination">
                  בתיאום טלפוני
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.preferSpecialTimes">
                  בזמנים מיוחדים: פסח/סוכות
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.preferPublicReception">
                  בקבלת קהל
                </label>
              </div>
            </div>
            
            <div class="form-group full-width">
              <label>העדפות נוספות</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.emailOnlyCorrespondence">
                  שליחת מכתבים באימייל בלבד
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="donor.autoAddToLocationEvents">
                  הוספה אוטומטית לאירועים (לפי מיקום)
                </label>
              </div>
            </div>
            
            <!-- Action buttons section -->
            <div class="form-group full-width">
              <label>פעולות מהירות</label>
              <div class="action-buttons">
                <button class="btn btn-outline-primary" (click)="openGifts()" title="מתנות">
                  🎁 מתנות
                </button>
                <button class="btn btn-outline-success" (click)="openDonations()" title="תרומות">
                  💰 תרומות
                </button>
                <button class="btn btn-outline-info" (click)="openReceipts()" title="הוצאת קבלות">
                  📄 הו"ק
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- העדפות כלליות -->
        <div class="section preferences">
          <h3>{{ (i18n.terms$ | async)?.generalPreferences }}</h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="donor.wantsUpdates">
                {{ (i18n.terms$ | async)?.wantsUpdates }}
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="donor.wantsTaxReceipts">
                {{ (i18n.terms$ | async)?.wantsTaxReceipts }}
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="donor.isActive">
                {{ (i18n.terms$ | async)?.active }}
              </label>
            </div>
            <div class="form-group full-width">
              <label>{{ (i18n.terms$ | async)?.generalNotes }}</label>
              <textarea class="form-control" rows="4" [(ngModel)]="donor.notes" [placeholder]="(i18n.terms$ | async)?.enterNotesPlaceholder"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary">{{ (i18n.terms$ | async)?.cancel }}</button>
      <button class="btn btn-danger" *ngIf="!isNewDonor && donor?.isActive" (click)="deactivateDonor()">{{ (i18n.terms$ | async)?.deactivate }}</button>
      <button class="btn btn-success" *ngIf="!isNewDonor && !donor?.isActive" (click)="activateDonor()">{{ (i18n.terms$ | async)?.activate }}</button>
      <button class="btn btn-danger" *ngIf="!isNewDonor" (click)="deleteDonor()">{{ (i18n.terms$ | async)?.delete }}</button>
      <button class="btn btn-primary" (click)="saveDonor()">{{ (i18n.terms$ | async)?.saveDonor }}</button>
    </div>
  </div>
</div>
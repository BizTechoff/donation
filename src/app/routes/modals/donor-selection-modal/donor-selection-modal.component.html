<div class="module-container">
  <div class="module-header">
    <div class="header-top">
      <h2>{{ args.title || ((i18n.terms$ | async)?.selectDonorTitle || 'בחר תורם') }}</h2>
      <div class="header-actions">
        <button *ngIf="args.multiSelect && selectedDonors.length > 0" class="btn-finish" (click)="finishMultiSelect()">{{ (i18n.terms$ | async)?.finishSelectionButton }} ({{ selectedDonors.length }})</button>
        <button class="btn-close" (click)="closeDialog()">✕</button>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-row">
        <div class="filter-group">
          <label>{{ (i18n.terms$ | async)?.searchLabel }}</label>
          <input #searchInput type="text" [(ngModel)]="filterText" (ngModelChange)="applyFilters()" [placeholder]="(i18n.terms$ | async)?.searchDonorPlaceholder || ''" autofocus cdkFocusInitial>
        </div>
        <button class="btn-create" (click)="createNewDonor()">{{ (i18n.terms$ | async)?.createNewDonorButton }}</button>
      </div>
    </div>
  </div>

  <div class="module-content">
    <div class="table-body">
      <table class="data-table">
        <thead>
          <tr>
            <th *ngIf="args.multiSelect" class="checkbox-col">
              <input type="checkbox" [checked]="areAllSelected()" (change)="toggleSelectAll()" title="בחר/בטל הכל">
            </th>
            <th class="sortable" [class.sorted]="isSorted('fullName')" (click)="toggleSort('fullName', $event)">
              {{ (i18n.terms$ | async)?.donorNameColumn }}
              <span class="sort-icon" *ngIf="getSortIcon('fullName')">{{getSortIcon('fullName')}}</span>
            </th>
            <th>{{ (i18n.terms$ | async)?.phoneColumn }}</th>
            <th>{{ (i18n.terms$ | async)?.emailColumn }}</th>
            <th>{{ (i18n.terms$ | async)?.addressColumn }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let donor of paginatedDonors" (click)="selectDonor(donor)" [class.selected]="isDonorSelected(donor)">
            <td *ngIf="args.multiSelect" class="checkbox-col">
              <input type="checkbox" [checked]="isDonorSelected(donor)" (click)="toggleDonorSelection(donor); $event.stopPropagation()">
            </td>
            <td class="donor-name-cell">{{ donor.lastAndFirstName }}</td>
            <td>{{ getDonorPhone(donor.id) }}</td>
            <td>{{ getDonorEmail(donor.id) }}</td>
            <td class="donor-address-cell">{{ getDonorPlace(donor.id)?.fullAddress }}</td>
          </tr>
          <tr *ngIf="paginatedDonors.length === 0">
            <td [attr.colspan]="args.multiSelect ? 5 : 4" class="no-data">{{ (i18n.terms$ | async)?.noDonorsFound }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-footer">
      <div class="pagination-controls">
        <button (click)="firstPage()" [disabled]="currentPage === 1">⏮ {{ (i18n.terms$ | async)?.firstButton }}</button>
        <button (click)="previousPage()" [disabled]="currentPage === 1">← {{ (i18n.terms$ | async)?.previousButton }}</button>
        <div class="page-numbers">
          <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)" [class.active]="page === currentPage">{{page}}</button>
        </div>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">{{ (i18n.terms$ | async)?.nextButton }} →</button>
        <button (click)="lastPage()" [disabled]="currentPage === totalPages">{{ (i18n.terms$ | async)?.lastButton }} ⏭</button>
      </div>
      <div class="pagination-info">
        <span>{{ (i18n.terms$ | async)?.showingText }} {{(currentPage - 1) * pageSize + 1}} - {{Math.min(currentPage * pageSize, totalCount)}} {{ (i18n.terms$ | async)?.ofText }} {{totalCount}}</span>
      </div>
    </div>
  </div>
</div>

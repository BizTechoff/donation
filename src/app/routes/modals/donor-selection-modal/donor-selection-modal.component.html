<div class="module-container">
  <div class="module-header">
    <div class="header-top">
      <h2>{{ args.title || 'בחר תורם' }}</h2>
      <div class="header-actions">
        <button *ngIf="args.multiSelect && selectedDonors.length > 0" class="btn-finish" (click)="finishMultiSelect()">סיים בחירה ({{ selectedDonors.length }})</button>
        <button class="btn-close" (click)="closeDialog()">✕</button>
      </div>
    </div>

    <div class="filters-section">
      <div class="filter-row">
        <div class="filter-group">
          <label>חיפוש</label>
          <input type="text" [(ngModel)]="filterText" (ngModelChange)="applyFilters()" placeholder="חפש תורם...">
        </div>
        <button class="btn-create" (click)="createNewDonor()">יצירת תורם חדש</button>
      </div>
    </div>
  </div>

  <div class="module-content">
    <div class="table-body">
      <table class="data-table">
        <thead>
          <tr>
            <th *ngIf="args.multiSelect" class="checkbox-col">בחירה</th>
            <th class="sortable" [class.sorted]="isSorted('fullName')" (click)="toggleSort('fullName', $event)">
              שם תורם
              <span class="sort-icon" *ngIf="getSortIcon('fullName')">{{getSortIcon('fullName')}}</span>
            </th>
            <th>טלפון</th>
            <th>אימייל</th>
            <th>כתובת</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let donor of paginatedDonors" (click)="selectDonor(donor)" [class.selected]="isDonorSelected(donor)">
            <td *ngIf="args.multiSelect" class="checkbox-col">
              <input type="checkbox" [checked]="isDonorSelected(donor)" (click)="$event.stopPropagation()">
            </td>
            <td>{{ donor.fullName }}</td>
            <td>{{ getDonorPhone(donor.id) }}</td>
            <td>{{ getDonorEmail(donor.id) }}</td>
            <td>{{ getDonorPlace(donor.id)?.fullAddress }}</td>
          </tr>
          <tr *ngIf="paginatedDonors.length === 0">
            <td [attr.colspan]="args.multiSelect ? 5 : 4" class="no-data">לא נמצאו תורמים</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-footer">
      <div class="pagination-controls">
        <button (click)="firstPage()" [disabled]="currentPage === 1">⏮ ראשון</button>
        <button (click)="previousPage()" [disabled]="currentPage === 1">← הקודם</button>
        <div class="page-numbers">
          <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)" [class.active]="page === currentPage">{{page}}</button>
        </div>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">הבא →</button>
        <button (click)="lastPage()" [disabled]="currentPage === totalPages">אחרון ⏭</button>
      </div>
      <div class="pagination-info">
        <span>מציג {{(currentPage - 1) * pageSize + 1}} - {{Math.min(currentPage * pageSize, totalCount)}} מתוך {{totalCount}}</span>
      </div>
    </div>
  </div>
</div>

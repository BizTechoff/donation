<!-- Organization Details Modal -->
<div class="organization-details-modal">

    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>{{isNew ? 'business_center' : 'business'}}</mat-icon>
        </div>
        <div class="header-text">
          <h2>{{isNew ? ((i18n.terms$ | async)?.newOrganization || 'עמותה חדשה') : ((i18n.terms$ | async)?.editOrganization || 'עריכת עמותה')}}</h2>
          <p class="header-subtitle" *ngIf="!isNew && organization">
            {{organization.name}}
          </p>
        </div>
      </div>
      <button class="modal-close" (click)="closeModal()" [matTooltip]="(i18n.terms$ | async)?.close || 'סגור'" [dir]="i18n.lang.RTL ? 'rtl' : 'ltr'">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="loading-spinner">{{ (i18n.terms$ | async)?.loadingData || 'טוען נתונים...' }}</div>
    </div>

    <div class="modal-body">
      <div class="details-grid" *ngIf="organization && !loading">

        <!-- פרטי עמותה בסיסיים -->
        <div class="section basic-info">
          <h3>{{ (i18n.terms$ | async)?.basicOrganizationDetails || 'פרטי עמותה בסיסיים' }}</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">business</mat-icon>
                <label>{{ (i18n.terms$ | async)?.organizationName || 'שם העמותה' }} *</label>
              </div>
              <input type="text"
                     class="form-control"
                     [(ngModel)]="organization.name"
                     (ngModelChange)="onFieldChange()"
                     [placeholder]="(i18n.terms$ | async)?.organizationName || 'שם העמותה'"
                     required>
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">badge</mat-icon>
                <label>{{ (i18n.terms$ | async)?.organizationNumber || 'מספר עמותה (ח"פ)' }}</label>
              </div>
              <input type="text"
                     class="form-control"
                     [(ngModel)]="organization.registrationNumber"
                     (ngModelChange)="onFieldChange()"
                     [placeholder]="(i18n.terms$ | async)?.registrationNumber || 'מספר רישום'">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">fingerprint</mat-icon>
                <label>מזהה משלם</label>
              </div>
              <input type="text"
                     class="form-control"
                     [(ngModel)]="organization.payerIdentifier"
                     (ngModelChange)="onFieldChange()"
                     placeholder="מזהה משלם">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">account_balance</mat-icon>
                <label>{{ (i18n.terms$ | async)?.accountNumber || 'מספר חשבון' }}</label>
              </div>
              <input type="text"
                     class="form-control"
                     [(ngModel)]="organization.accountNumber"
                     (ngModelChange)="onFieldChange()"
                     [placeholder]="(i18n.terms$ | async)?.accountNumberPlaceholder || 'מספר חשבון בנק'">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">attach_money</mat-icon>
                <label>{{ (i18n.terms$ | async)?.currency || 'מטבע' }}</label>
              </div>
              <select class="form-control"
                      [(ngModel)]="organization.currency"
                      (ngModelChange)="onFieldChange()">
                <option *ngFor="let curr of currencyOptions" [value]="curr.value">
                  {{curr.label}}
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- פרטי כתובת -->
        <div class="section address-info">
          <h3>
            <mat-icon class="section-icon">location_on</mat-icon>
            {{ (i18n.terms$ | async)?.addressDetails || 'פרטי כתובת' }}
          </h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <app-osm-address-input
                [label]="(i18n.terms$ | async)?.organizationAddress || 'כתובת העמותה'"
                [placeholder]="(i18n.terms$ | async)?.enterAddress || 'הקלד כתובת...'"
                countryCode="il"
                [(place)]="organization.place"
                (placeChange)="onPlaceSelected($event)">
              </app-osm-address-input>
            </div>
          </div>
        </div>

        <!-- פרטי קשר -->
        <div class="section contact-info">
          <h3>
            <mat-icon class="section-icon">contacts</mat-icon>
            {{ (i18n.terms$ | async)?.contactDetails || 'פרטי קשר' }}
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">phone</mat-icon>
                <label>{{ (i18n.terms$ | async)?.phone || 'טלפון' }}</label>
              </div>
              <input type="tel"
                     class="form-control"
                     [(ngModel)]="organization.phone"
                     (ngModelChange)="onFieldChange()"
                     [placeholder]="(i18n.terms$ | async)?.phoneNumber || 'מספר טלפון'">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">email</mat-icon>
                <label>{{ (i18n.terms$ | async)?.email || 'אימייל' }}</label>
              </div>
              <input type="email"
                     class="form-control"
                     [(ngModel)]="organization.email"
                     (ngModelChange)="onFieldChange()"
                     [placeholder]="(i18n.terms$ | async)?.emailAddress || 'כתובת דואר אלקטרוני'">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">person</mat-icon>
                <label>שם משלם</label>
              </div>
              <input type="text"
                     class="form-control"
                     [(ngModel)]="organization.payerName"
                     (ngModelChange)="onFieldChange()"
                     placeholder="שם משלם">
            </div>

            <div class="form-group">
              <div class="field-title">
                <mat-icon class="field-icon">receipt</mat-icon>
                <label>אסמכתא</label>
              </div>
              <input type="text"
                     class="form-control"
                     [(ngModel)]="organization.reference"
                     (ngModelChange)="onFieldChange()"
                     placeholder="אסמכתא">
            </div>
          </div>
        </div>

        <!-- אחר -->
        <div class="section other-info">
          <h3>
            <mat-icon class="section-icon">note</mat-icon>
            {{ (i18n.terms$ | async)?.other || 'אחר' }}
          </h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <div class="field-title">
                <mat-icon class="field-icon">notes</mat-icon>
                <label>{{ (i18n.terms$ | async)?.notes || 'הערות' }}</label>
              </div>
              <textarea class="form-control"
                        rows="4"
                        [(ngModel)]="organization.notes"
                        (ngModelChange)="onFieldChange()"
                        [placeholder]="(i18n.terms$ | async)?.additionalNotes || 'הערות והשתהות נוספות'"></textarea>
            </div>

            <div class="form-group full-width">
              <div class="checkbox-wrapper">
                <label class="checkbox-label">
                  <input type="checkbox"
                         [(ngModel)]="organization.isActive"
                         (ngModelChange)="onFieldChange()">
                  <span class="checkbox-text">
                    <mat-icon class="checkbox-icon">{{organization.isActive ? 'check_circle' : 'cancel'}}</mat-icon>
                    {{ (i18n.terms$ | async)?.active || 'פעיל' }}
                  </span>
                </label>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="modal-footer">
      <div class="footer-actions-left">
        <!-- Empty for future actions -->
      </div>
      <div class="footer-actions-right">
        <button mat-stroked-button
                (click)="closeModal()"
                class="cancel-button">
          <mat-icon>close</mat-icon>
          {{ (i18n.terms$ | async)?.cancel || 'ביטול' }}
        </button>
        <button mat-raised-button
                color="primary"
                (click)="save()"
                class="save-button"
                [disabled]="loading">
          <mat-icon>save</mat-icon>
          {{ isNew ? ((i18n.terms$ | async)?.saveOrganization || 'שמור עמותה') : ((i18n.terms$ | async)?.updateOrganization || 'עדכן עמותה') }}
        </button>
      </div>
    </div>
</div>

<div class="modal-overlay">
  <div class="modal-content payment-details-modal">
    <div class="modal-header">
      <div class="header-content">
        <h2>{{isNewPayment ? 'הוספת תנועה חדשה' : 'עריכת תנועה'}}</h2>
      </div>
      <button class="modal-close" (click)="onClose()">&times;</button>
    </div>

    <div class="modal-body" *ngIf="!loading">
      <!-- Commitment Info - only for commitment donations -->
      <div class="commitment-info" *ngIf="donation && donation.donationType === 'commitment'">
        <div class="info-row">
          <span class="info-label">סה"כ התחייבות:</span>
          <span class="info-value">{{ donation.amount | number }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">שולם עד כה:</span>
          <span class="info-value">{{ totalPaidSoFar | number }}</span>
        </div>
        <div class="info-row remaining">
          <span class="info-label">יתרה לתשלום:</span>
          <span class="info-value" [class.warning]="remainingAmount <= 0">{{ remainingAmount | number }}</span>
        </div>
      </div>

      <!-- Transaction Type Info -->
      <div class="commitment-info" *ngIf="getTransactionTypeLabel()">
        <div class="info-row">
          <span class="info-label">סוג תנועה:</span>
          <span class="info-value">{{ getTransactionTypeLabel() }}</span>
        </div>
      </div>

      <div class="form-container">

        <!-- Payment Date -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>event</mat-icon>
            תאריך תשלום <span class="required">*</span>
          </label>
          <input type="date"
                 class="form-input"
                 [(ngModel)]="payment.paymentDate"
                 required>
        </div>

        <!-- Amount -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>attach_money</mat-icon>
            סכום <span class="required">*</span>
          </label>
          <input type="number"
                 class="form-input"
                 [(ngModel)]="payment.amount"
                 placeholder="0.00"
                 min="0"
                 step="0.01"
                 required
                 #amountInput
                 (focus)="amountInput.select()">
        </div>

        <!-- Currency -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>currency_exchange</mat-icon>
            מטבע
          </label>
          <select class="form-input" [(ngModel)]="payment.currencyId">
            <option *ngFor="let currency of currencies" [value]="currency.id">
              {{ currency.symbol }} - {{ currency.label }}
            </option>
          </select>
        </div>

        <!-- Reference -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>receipt</mat-icon>
            אסמכתא
          </label>
          <input type="text"
                 class="form-input"
                 [(ngModel)]="payment.reference"
                 placeholder="מספר אסמכתא">
        </div>

        <!-- Payment Identifier -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>confirmation_number</mat-icon>
            מזהה תשלום
          </label>
          <input type="text"
                 class="form-input"
                 [(ngModel)]="payment.paymentIdentifier"
                 placeholder="מזהה תשלום">
        </div>

        <!-- Notes -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>notes</mat-icon>
            הערות
          </label>
          <textarea class="form-textarea"
                    [(ngModel)]="payment.notes"
                    placeholder="הערות נוספות..."
                    rows="3"></textarea>
        </div>

      </div>
    </div>

    <div class="loading-overlay" *ngIf="loading">
      <div class="loading-spinner">טוען...</div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()">ביטול</button>
      <button class="btn btn-primary" (click)="save()" [disabled]="loading">
        {{isNewPayment ? 'הוסף תשלום' : 'שמור שינויים'}}
      </button>
    </div>
  </div>
</div>

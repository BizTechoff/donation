<div class="modern-dual-date-picker" [class.compact]="compact" [class.horizontal]="horizontal">
  <label class="field-label" *ngIf="label && !compact">{{ label }}</label>

  <div class="date-inputs-container">
    <!-- Date triggers wrapper with unified background -->
    <div class="date-triggers-wrapper">
      <!-- Hebrew Date Input -->
      <div class="date-input-group" *ngIf="!showOnlyGregorian">
        <div class="date-input hebrew-trigger" #hebrewTrigger (click)="toggleHebrewPopup($event)" [class.disabled]="disabled" [class.has-popup-open]="showHebrewPopup">
          <span class="date-value" [class.placeholder]="!hebrewDateDisplay">
            {{ hebrewDateDisplay || (compact ? ((i18n.terms$ | async)?.hebrewShort) : ((i18n.terms$ | async)?.selectHebrewDate)) }}
          </span>
          <svg class="calendar-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
      </div>

      <!-- Separator DIV (20px) -->
      <div class="date-separator" *ngIf="!showOnlyHebrew && !showOnlyGregorian"></div>

      <!-- Gregorian Date Input -->
      <div class="date-input-group" *ngIf="!showOnlyHebrew">
        <div class="date-input gregorian-trigger" #gregorianTrigger (click)="toggleGregorianPopup($event)" [class.disabled]="disabled" [class.has-popup-open]="showGregorianPopup">
        <span class="date-value" [class.placeholder]="!gregorianDateDisplay">
          {{ gregorianDateDisplay || (compact ? ((i18n.terms$ | async)?.gregorianShort) : ((i18n.terms$ | async)?.selectGregorianDate)) }}
        </span>
        <svg class="calendar-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </div>
    </div>
    </div>

    <!-- Clear Button -->
    <button class="clear-button" *ngIf="currentDate && !disabled" (click)="clearDate()" [title]="(i18n.terms$ | async)?.clearDate">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>
</div>

<!-- Calendar Overlay Template - rendered outside modal via CDK Overlay -->
<ng-template #calendarOverlayTemplate>
  <div class="calendar-overlay-container" [class.parallel-mode]="calendar_open_heb_and_eng_parallel && showHebrewPopup && showGregorianPopup">

    <!-- Hebrew Calendar Popup -->
    <div class="calendar-popup hebrew-popup" *ngIf="showHebrewPopup && !showOnlyGregorian">
      <div class="calendar-header">
        <button class="nav-button" (click)="changeHebrewMonth(-1)">â€¹</button>

        <div class="dropdowns-container">
          <select class="month-dropdown" [(ngModel)]="hebrewSelectedMonth" (change)="onHebrewMonthChange($event)">
            <option *ngFor="let month of hebrewMonths" [value]="month.value">
              {{ month.name }}
            </option>
          </select>

          <select class="year-dropdown" [(ngModel)]="hebrewSelectedYear" (change)="onHebrewYearChange($event)">
            <option *ngFor="let year of hebrewYearsList" [value]="year">
              {{ getHebrewYearString(year) }}
            </option>
          </select>
        </div>

        <div class="today-button"
             (click)="goToToday()"
             [class.clickable]="!isCurrentMonth()"
             [title]="isCurrentMonth() ? ((i18n.terms$ | async)?.currentMonth) : ((i18n.terms$ | async)?.goToCurrentMonth)">
          ðŸ“…
        </div>

        <button class="nav-button" (click)="changeHebrewMonth(1)">â€º</button>
      </div>

      <!-- Toggle for holidays -->
      <div *ngIf="false" class="holidays-toggle">
        <label class="toggle-label">
          <input type="checkbox" [(ngModel)]="isCalendarJewEnabled" class="toggle-checkbox">
          <span class="toggle-text">{{ (i18n.terms$ | async)?.showHolidays }}</span>
        </label>
      </div>

      <div class="calendar-body">
        <div class="weekdays">
          <div class="weekday" *ngFor="let day of hebrewDaysOfWeek">{{ day }}</div>
        </div>
        <div class="days-grid">
          <div class="week" *ngFor="let week of hebrewDaysInMonth">
            <div class="day"
                 *ngFor="let day of week"
                 [class.empty]="day === 0"
                 [class.selected]="isSelectedHebrewDay(day)"
                 [class.today]="isTodayHebrew(day)"
                 [class.has-holiday]="getHolidayForDay(day) !== null"
                 (click)="selectHebrewDay(day)">
              <span class="day-number">{{ day !== 0 ? getHebrewDayString(day) : '' }}</span>
              <span class="holiday-name" *ngIf="isCalendarJewEnabled && getHolidayForDay(day)">
                {{ getHolidayForDay(day) }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gregorian Calendar Popup -->
    <div class="calendar-popup gregorian-popup" *ngIf="showGregorianPopup && !showOnlyHebrew">
      <div class="calendar-header">
        <button class="nav-button" (click)="changeGregorianMonth(-1)">â€¹</button>

        <div class="dropdowns-container">
          <select class="month-dropdown" [(ngModel)]="gregorianMonth" (change)="onGregorianMonthChange($event)">
            <option *ngFor="let month of gregorianMonths; let i = index" [value]="i">
              {{ month }}
            </option>
          </select>

          <select class="year-dropdown" [(ngModel)]="gregorianYear" (change)="onGregorianYearChange($event)">
            <option *ngFor="let year of gregorianYearsList" [value]="year">
              {{ year }}
            </option>
          </select>
        </div>

        <button class="nav-button" (click)="changeGregorianMonth(1)">â€º</button>
      </div>

      <div class="calendar-body">
        <div class="weekdays">
          <div class="weekday" *ngFor="let day of gregorianDaysOfWeek">{{ day }}</div>
        </div>
        <div class="days-grid">
          <div class="week" *ngFor="let week of gregorianDaysInMonth">
            <div class="day"
                 *ngFor="let day of week"
                 [class.empty]="day === null"
                 [class.selected]="isSelectedGregorianDay(day)"
                 [class.today]="isToday(day)"
                 (click)="selectGregorianDay(day)">
              {{ day !== null ? day : '' }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
